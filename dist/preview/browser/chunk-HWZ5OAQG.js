import{a as re}from"./chunk-C7LS3LED.js";import{a as ne}from"./chunk-55ZRRGER.js";import{a as y}from"./chunk-IORNA22M.js";import{a as Z,n as oe}from"./chunk-ZNKMRUWH.js";import{a as ee,b as te,c as ie}from"./chunk-XG7TRELF.js";import"./chunk-B56AIWNQ.js";import{r as W}from"./chunk-3DATYCE5.js";import{b as X,d as Y}from"./chunk-EMEDTLE5.js";import{c as U,e as s,g as $,h as z,m as R,n as H,p as B,q as Q,w as J,y as K}from"./chunk-XRHNCSTF.js";import{$c as T,Ib as I,Lc as L,Mc as D,Qa as d,Ra as u,Tc as O,Wb as a,Wc as q,Yb as E,_b as x,cc as V,db as m,dc as w,ea as C,ha as F,id as A,jb as c,kd as G,la as N,nc as P,od as M,pc as j,r as _,wb as n,xb as i,yb as S}from"./chunk-AZAYKVK3.js";import"./chunk-REZWHGN7.js";var le=(()=>{let e=class e{constructor(o){this.http=o,this.apiUrl=`${y.apiUrl}/v1/lotes`}getLotes(){return this.http.get(this.apiUrl).pipe(_(o=>o.data.data||[]))}};e.\u0275fac=function(l){return new(l||e)(F(T))},e.\u0275prov=C({token:e,factory:e.\u0275fac,providedIn:"root"});let t=e;return t})();var de=(()=>{let e=class e{constructor(o){this.http=o,this.apiUrl=`${y.apiUrl}/v1/productos`}getProductos(){return this.http.get(this.apiUrl).pipe(_(o=>o.data.data||[]))}};e.\u0275fac=function(l){return new(l||e)(F(T))},e.\u0275prov=C({token:e,factory:e.\u0275fac,providedIn:"root"});let t=e;return t})();function pe(t,e){if(t&1&&(n(0,"ng-option",26),a(1),P(2,"number"),i()),t&2){let p=e.$implicit;c("value",p.id),d(),x(" Venta #",p.id," - Cliente #",p.idCliente," - Q",j(2,4,p.total,"1.2-2")," ")}}function ue(t,e){t&1&&(n(0,"div",27)(1,"small"),a(2,"Debe seleccionar una venta"),i()())}function ve(t,e){if(t&1&&(n(0,"ng-option",26),a(1),i()),t&2){let p=e.$implicit;c("value",p.id),d(),E(" ",p.galera," ")}}function fe(t,e){t&1&&(n(0,"div",27)(1,"small"),a(2,"Debe seleccionar un lote"),i()())}function ge(t,e){if(t&1&&(n(0,"ng-option",26),a(1),i()),t&2){let p=e.$implicit;c("value",p.id),d(),E(" ",p.nombre," ")}}function he(t,e){t&1&&(n(0,"div",27)(1,"small"),a(2,"Debe seleccionar un producto"),i()())}function be(t,e){t&1&&(n(0,"div",27)(1,"small"),a(2,"La cantidad es requerida"),i()())}function Se(t,e){t&1&&(n(0,"div",27)(1,"small"),a(2,"La fecha es requerida"),i()())}function ke(t,e){t&1&&(n(0,"div",27)(1,"small"),a(2,"El estado es requerido"),i()())}function _e(t,e){t&1&&S(0,"span",28)}var Ue=(()=>{let e=class e{constructor(o,l,r,v,f,g,h,b){this.fb=o,this.ticketService=l,this.ventaService=r,this.loteService=v,this.productoService=f,this.router=g,this.route=h,this.toastr=b,this.loading=!1,this.ventas=[],this.lotes=[],this.productos=[],this.ticketForm=this.fb.group({idVenta:["",[s.required,s.min(1)]],idLote:["",[s.required,s.min(1)]],idProducto:["",[s.required,s.min(1)]],fecha:["",s.required],cantidad:["",[s.required,s.min(1)]],estado:["Pendiente",s.required],codigoAutorizacion:[""]})}ngOnInit(){let o=new Date().toISOString().split("T")[0];this.ticketForm.patchValue({fecha:o}),this.loadVentas(),this.loadLotes(),this.loadProductos(),this.ticketForm.get("idVenta")?.valueChanges.subscribe(l=>{l&&this.onVentaSelected(l)}),this.route.queryParams.subscribe(l=>{l.ventaId&&this.ticketForm.patchValue({idVenta:+l.ventaId})})}loadVentas(){this.ventaService.getVentas().subscribe({next:o=>{this.ventas=o||[]},error:o=>{console.error("Error loading ventas:",o),this.ventas=[]}})}loadLotes(){this.loteService.getLotes().subscribe({next:o=>{this.lotes=o||[]},error:o=>{console.error("Error loading lotes:",o),this.lotes=[]}})}loadProductos(){this.productoService.getProductos().subscribe({next:o=>{this.productos=o||[]},error:o=>{console.error("Error loading productos:",o),this.productos=[]}})}onSubmit(){if(this.ticketForm.valid){this.loading=!0;let o=this.ticketForm.value;this.ticketService.createTicket(o).subscribe({next:()=>{this.toastr.success("Ticket creado exitosamente","\xC9xito",{timeOut:3e3,positionClass:"toast-top-right"}),this.router.navigate(["/dashboard/business-dashboard/ticket-list"])},error:l=>{this.toastr.error("Error al crear el ticket: "+(l.error?.message||"Error desconocido"),"Error",{timeOut:3e3,positionClass:"toast-top-right"}),this.loading=!1}})}else this.toastr.warning("Por favor, complete todos los campos requeridos","Advertencia",{timeOut:3e3,positionClass:"toast-top-right"}),this.markFormGroupTouched()}onCancel(){this.router.navigate(["/dashboard/business-dashboard/ticket-list"])}onVentaSelected(o){}markFormGroupTouched(){Object.keys(this.ticketForm.controls).forEach(o=>{this.ticketForm.get(o)?.markAsTouched()})}};e.\u0275fac=function(l){return new(l||e)(u(J),u(ne),u(re),u(le),u(de),u(G),u(A),u(W))},e.\u0275cmp=N({type:e,selectors:[["app-new-ticket"]],standalone:!0,features:[V([X]),w],decls:68,vars:15,consts:[[3,"title"],[3,"ngSubmit","formGroup"],[1,"row"],[1,"col-xl-12","col-md-12","col-lg-12"],[1,"card"],[1,"card-body"],[1,"mb-5","fw-semibold"],[1,"col-md-6"],[1,"form-group"],[1,"form-label"],["name","idVenta","placeholder","Seleccione una venta","formControlName","idVenta","bindLabel","displayText","bindValue","id",1,"form-control","p-0","custom-select"],[3,"value",4,"ngFor","ngForOf"],["class","text-danger",4,"ngIf"],["name","idLote","placeholder","Seleccione un lote","formControlName","idLote","bindLabel","galera","bindValue","id",1,"form-control","p-0","custom-select"],["name","idProducto","placeholder","Seleccione un producto","formControlName","idProducto","bindLabel","nombre","bindValue","id",1,"form-control","p-0","custom-select"],["type","number","placeholder","Ingrese la cantidad","formControlName","cantidad",1,"form-control"],["type","date","formControlName","fecha",1,"form-control"],["name","estado","placeholder","Seleccione el estado","formControlName","estado",1,"form-control","p-0","custom-select"],["value","Pendiente"],["value","Completado"],["value","Cancelado"],["type","text","placeholder","Ingrese el c\xF3digo de autorizaci\xF3n (opcional)","formControlName","codigoAutorizacion",1,"form-control"],[1,"card-footer","text-end"],["type","button",1,"btn","btn-danger","btn-lg","me-2",3,"click","disabled"],["type","submit",1,"btn","btn-success","btn-lg",3,"disabled"],["class","spinner-border spinner-border-sm me-2",4,"ngIf"],[3,"value"],[1,"text-danger"],[1,"spinner-border","spinner-border-sm","me-2"]],template:function(l,r){if(l&1&&(S(0,"app-page-header",0),n(1,"form",1),I("ngSubmit",function(){return r.onSubmit()}),n(2,"div",2)(3,"div",3)(4,"div",4)(5,"div",5)(6,"h4",6),a(7,"Detalles del Ticket:"),i(),n(8,"div",2)(9,"div",7)(10,"div",8)(11,"label",9),a(12,"Seleccionar Venta *"),i(),n(13,"ng-select",10),m(14,pe,3,7,"ng-option",11),i(),m(15,ue,3,0,"div",12),i()(),n(16,"div",7)(17,"div",8)(18,"label",9),a(19,"Lote *"),i(),n(20,"ng-select",13),m(21,ve,2,2,"ng-option",11),i(),m(22,fe,3,0,"div",12),i()()(),n(23,"div",2)(24,"div",7)(25,"div",8)(26,"label",9),a(27,"Producto *"),i(),n(28,"ng-select",14),m(29,ge,2,2,"ng-option",11),i(),m(30,he,3,0,"div",12),i()(),n(31,"div",7)(32,"div",8)(33,"label",9),a(34,"Cantidad *"),i(),S(35,"input",15),m(36,be,3,0,"div",12),i()()(),n(37,"div",2)(38,"div",7)(39,"div",8)(40,"label",9),a(41,"Fecha *"),i(),S(42,"input",16),m(43,Se,3,0,"div",12),i()()(),n(44,"div",2)(45,"div",7)(46,"div",8)(47,"label",9),a(48,"Estado *"),i(),n(49,"ng-select",17)(50,"ng-option",18),a(51,"Pendiente"),i(),n(52,"ng-option",19),a(53,"Completado"),i(),n(54,"ng-option",20),a(55,"Cancelado"),i()(),m(56,ke,3,0,"div",12),i()(),n(57,"div",7)(58,"div",8)(59,"label",9),a(60,"C\xF3digo de Autorizaci\xF3n"),i(),S(61,"input",21),i()()()(),n(62,"div",22)(63,"button",23),I("click",function(){return r.onCancel()}),a(64,"Cerrar"),i(),n(65,"button",24),m(66,_e,1,0,"span",25),a(67),i()()()()()()),l&2){let v,f,g,h,b,k;c("title","Nuevo Ticket"),d(),c("formGroup",r.ticketForm),d(13),c("ngForOf",r.ventas),d(),c("ngIf",((v=r.ticketForm.get("idVenta"))==null?null:v.invalid)&&((v=r.ticketForm.get("idVenta"))==null?null:v.touched)),d(6),c("ngForOf",r.lotes),d(),c("ngIf",((f=r.ticketForm.get("idLote"))==null?null:f.invalid)&&((f=r.ticketForm.get("idLote"))==null?null:f.touched)),d(7),c("ngForOf",r.productos),d(),c("ngIf",((g=r.ticketForm.get("idProducto"))==null?null:g.invalid)&&((g=r.ticketForm.get("idProducto"))==null?null:g.touched)),d(6),c("ngIf",((h=r.ticketForm.get("cantidad"))==null?null:h.invalid)&&((h=r.ticketForm.get("cantidad"))==null?null:h.touched)),d(7),c("ngIf",((b=r.ticketForm.get("fecha"))==null?null:b.invalid)&&((b=r.ticketForm.get("fecha"))==null?null:b.touched)),d(13),c("ngIf",((k=r.ticketForm.get("estado"))==null?null:k.invalid)&&((k=r.ticketForm.get("estado"))==null?null:k.touched)),d(7),c("disabled",r.loading),d(2),c("disabled",r.loading),d(),c("ngIf",r.loading),d(),E(" ",r.loading?"Guardando...":"Guardar"," ")}},dependencies:[q,L,D,O,oe,Z,ie,te,ee,Y,M,K,R,U,H,$,z,B,Q]});let t=e;return t})();export{Ue as NewTicketComponent};
