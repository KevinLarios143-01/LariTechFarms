import{a as ae}from"./chunk-KLA3X4DQ.js";import"./chunk-IORNA22M.js";import{c as Z,n as ne}from"./chunk-XLGDB24R.js";import{a as ee,b as te,c as ie}from"./chunk-SNUM6ZIL.js";import"./chunk-HC3PXDFB.js";import{r as Y}from"./chunk-GNT7AIZA.js";import"./chunk-5ILM3463.js";import{M as W,c as q,ca as X,e as E,g as j,h as G,m as R,n as H,p as U,q as J,w as K,y as Q}from"./chunk-MN5F6KP3.js";import{Cb as S,Ib as h,Kb as f,Lc as D,Mc as z,Qa as o,Qc as M,Ra as x,Tc as O,Vb as w,Wb as i,Wc as B,Xb as p,Yb as I,db as _,dc as A,jb as u,la as F,lb as T,nb as k,nc as y,oc as V,od as $,qc as L,rc as N,ua as g,va as v,wb as t,xb as e,yb as m,yc as P}from"./chunk-W3KPMJ6O.js";import"./chunk-REZWHGN7.js";function re(d,c){d&1&&(t(0,"tr")(1,"td",49)(2,"div",50)(3,"span",51),i(4,"Cargando..."),e()(),t(5,"div",52),i(6,"Cargando tickets..."),e()()())}function oe(d,c){d&1&&(t(0,"tr")(1,"td",53),i(2," No se encontraron tickets "),e()())}function le(d,c){if(d&1){let r=S();t(0,"tr",39)(1,"th",54),i(2),e(),t(3,"td")(4,"div",27)(5,"div",55),m(6,"i",56),e(),t(7,"div")(8,"div",57)(9,"h6",58),i(10),e()(),t(11,"div",57)(12,"span",59),i(13),e()()()()(),t(14,"td")(15,"div",27)(16,"div",60),m(17,"i",61),e(),t(18,"div")(19,"div",57)(20,"h6",58),i(21),e()(),t(22,"div",57)(23,"span",59),i(24),e()()()()(),t(25,"td")(26,"span",62),i(27),e(),t(28,"small",63),i(29),e()(),t(30,"td"),i(31),y(32,"date"),e(),t(33,"td")(34,"span",62),i(35),y(36,"number"),e(),t(37,"small",63),i(38,"unidades"),e()(),t(39,"td")(40,"span",64),i(41),e()(),t(42,"td")(43,"div",65)(44,"a",66),h("click",function(){let a=g(r).$implicit,l=f(),s=w(124);return v(l.edit(s,a))}),m(45,"i",67),e(),t(46,"a",68),h("click",function(){let a=g(r).$implicit,l=f();return v(l.toggleTicketStatus(a))}),m(47,"i"),e(),t(48,"a",69),h("click",function(){let a=g(r).$implicit,l=f();return v(l.deleteTicket(a.id))}),m(49,"i",70),e()()()()}if(d&2){let r=c.$implicit,n=f();o(2),p(r.id),o(8),I("Venta #",r.idVenta,""),o(3),p((r.venta==null||r.venta.cliente==null?null:r.venta.cliente.nombre)||"Cliente N/A"),o(8),p((r.lote==null?null:r.lote.galera)||"Lote #"+r.idLote),o(3),p((r.lote==null?null:r.lote.tipo)||"N/A"),o(3),p((r.producto==null?null:r.producto.nombre)||"Producto #"+r.idProducto),o(2),p((r.producto==null?null:r.producto.tamanio)||"N/A"),o(2),p(L(32,17,r.fecha,"dd/MM/yyyy","UTC")),o(4),p(V(36,21,r.cantidad)),o(5),k(n.getEstadoBadgeClass(r.estado)),o(),p(r.estado),o(5),k(r.estado==="Pendiente"?"btn-warning":"btn-success"),u("title",r.estado==="Pendiente"?"Cancelar":"Activar"),o(),k(r.estado==="Pendiente"?"fe fe-x-circle":"fe fe-check-circle")}}function de(d,c){d&1&&(t(0,"div",91),i(1," El estado es requerido "),e())}function se(d,c){d&1&&(t(0,"span"),i(1,"La cantidad es requerida"),e())}function ce(d,c){d&1&&(t(0,"span"),i(1,"La cantidad debe ser mayor a 0"),e())}function me(d,c){if(d&1&&(t(0,"div",91),_(1,se,2,0,"span",41)(2,ce,2,0,"span",41),e()),d&2){let r,n,a=f(2);o(),u("ngIf",(r=a.editForm.get("cantidad"))==null||r.errors==null?null:r.errors.required),o(),u("ngIf",(n=a.editForm.get("cantidad"))==null||n.errors==null?null:n.errors.min)}}function pe(d,c){d&1&&m(0,"span",92)}function ue(d,c){if(d&1){let r=S();t(0,"form",71),h("ngSubmit",function(){g(r);let a=f();return v(a.onUpdateTicket())}),t(1,"div",72)(2,"h5",73),i(3,"Editar Ticket"),e(),t(4,"button",74),h("click",function(){let a=g(r).$implicit;return v(a.dismiss("Cross click"))}),e()(),t(5,"div",75)(6,"div",2)(7,"div",76)(8,"div",77)(9,"label",78),i(10,"Estado *"),e(),t(11,"ng-select",79)(12,"ng-option",80),i(13,"Pendiente"),e(),t(14,"ng-option",81),i(15,"Autorizado"),e(),t(16,"ng-option",82),i(17,"Despachado"),e(),t(18,"ng-option",83),i(19,"Cancelado"),e()(),_(20,de,2,0,"div",84),e()(),t(21,"div",76)(22,"div",77)(23,"label",78),i(24,"Cantidad *"),e(),m(25,"input",85),_(26,me,3,2,"div",84),e()(),t(27,"div",22)(28,"div",77)(29,"label",78),i(30,"C\xF3digo de Autorizaci\xF3n"),e(),m(31,"input",86),e()()()(),t(32,"div",87)(33,"button",88),h("click",function(){let a=g(r).$implicit;return v(a.dismiss("cancel"))}),i(34,"Cancelar"),e(),t(35,"button",89),_(36,pe,1,0,"span",90),i(37," Actualizar "),e()()()}if(d&2){let r,n,a,l,s=f();u("formGroup",s.editForm),o(11),T("is-invalid",((r=s.editForm.get("estado"))==null?null:r.invalid)&&((r=s.editForm.get("estado"))==null?null:r.touched)),o(9),u("ngIf",((n=s.editForm.get("estado"))==null?null:n.invalid)&&((n=s.editForm.get("estado"))==null?null:n.touched)),o(5),T("is-invalid",((a=s.editForm.get("cantidad"))==null?null:a.invalid)&&((a=s.editForm.get("cantidad"))==null?null:a.touched)),o(),u("ngIf",((l=s.editForm.get("cantidad"))==null?null:l.invalid)&&((l=s.editForm.get("cantidad"))==null?null:l.touched)),o(9),u("disabled",s.loading),o(),u("ngIf",s.loading)}}var we=(()=>{let c=class c{constructor(n,a,l,s,b){this.modalService=n,this.ticketService=a,this.fb=l,this.toastr=s,this.cdr=b,this.tickets=[],this.loading=!1,this.selectedTicket=null,this.totalTickets=0,this.ticketsPendientes=0,this.ticketsAutorizados=0,this.ticketsDespachados=0,this.editForm=this.fb.group({estado:["",E.required],codigoAutorizacion:[""],cantidad:["",[E.required,E.min(1)]]}),this.filterForm=this.fb.group({fechaDesde:[""],fechaHasta:[""],estado:[""]})}ngOnInit(){this.loadTickets()}applyFilter(n){let a=n.target.value.toLowerCase()}edit(n,a){this.selectedTicket=a,this.editForm.patchValue({estado:a.estado,codigoAutorizacion:a.codigoAutorizacion||"",cantidad:a.cantidad}),this.modalService.open(n,{windowClass:"modalCusSty modal-lg"})}onUpdateTicket(){if(this.editForm.valid&&this.selectedTicket){this.loading=!0;let n=this.editForm.value;this.ticketService.updateTicket(this.selectedTicket.id,n).subscribe({next:()=>{this.toastr.success("Ticket actualizado exitosamente","\xC9xito",{timeOut:3e3,positionClass:"toast-top-right"}),this.loadTickets(),this.modalService.dismissAll(),this.loading=!1,this.cdr.detectChanges()},error:a=>{this.toastr.error("Error al actualizar el ticket: "+(a.error?.message||"Error desconocido"),"Error",{timeOut:3e3,positionClass:"toast-top-right"}),this.loading=!1,this.cdr.detectChanges()}})}else this.toastr.warning("Por favor, complete todos los campos requeridos","Advertencia",{timeOut:3e3,positionClass:"toast-top-right"}),this.markFormGroupTouched()}toggleTicketStatus(n){let a=n.estado==="Pendiente",l=a?"Cancelado":"Pendiente",s=a?"cancelar":"activar";if(confirm(`\xBFEst\xE1 seguro de que desea ${s} este ticket?`)){let b={estado:l};this.ticketService.updateTicket(n.id,b).subscribe({next:()=>{this.toastr.success(`Ticket ${s}do exitosamente`,"\xC9xito",{timeOut:3e3,positionClass:"toast-top-right"}),this.loadTickets(),this.cdr.detectChanges()},error:C=>{this.toastr.error(`Error al ${s} el ticket: ${C.error?.message||"Error desconocido"}`,"Error",{timeOut:3e3,positionClass:"toast-top-right"}),this.cdr.detectChanges()}})}}markFormGroupTouched(){Object.keys(this.editForm.controls).forEach(n=>{this.editForm.get(n)?.markAsTouched()})}loadTickets(){this.loading=!0,this.ticketService.getTickets().subscribe({next:n=>{n?.data?.data?this.tickets=n.data.data:n?.data?.items?this.tickets=n.data.items:n?.data&&Array.isArray(n.data)?this.tickets=n.data:Array.isArray(n)?this.tickets=n:this.tickets=[],this.calculateStats(),this.loading=!1,this.cdr.detectChanges()},error:n=>{this.tickets=[],this.loading=!1,this.cdr.detectChanges()}})}calculateStats(){this.totalTickets=this.tickets.length,this.ticketsPendientes=this.tickets.filter(n=>n.estado==="Pendiente").length,this.ticketsAutorizados=this.tickets.filter(n=>n.estado==="Autorizado").length,this.ticketsDespachados=this.tickets.filter(n=>n.estado==="Despachado").length}open(n){this.modalService.open(n,{windowClass:"modalCusSty",size:"lg"})}applyFilters(){console.log("Aplicando filtros:",this.filterForm.value)}clearFilters(){this.filterForm.reset()}deleteTicket(n){confirm("\xBFEst\xE1 seguro de que desea eliminar este ticket?")&&this.ticketService.deleteTicket(n).subscribe({next:()=>{this.toastr.success("Ticket eliminado exitosamente","\xC9xito",{timeOut:3e3,positionClass:"toast-top-right"}),this.loadTickets(),this.cdr.detectChanges()},error:a=>{this.toastr.error("Error al eliminar el ticket: "+(a.error?.message||"Error desconocido"),"Error",{timeOut:3e3,positionClass:"toast-top-right"}),this.cdr.detectChanges()}})}getEstadoBadgeClass(n){switch(n){case"Autorizado":return"bg-success";case"Pendiente":return"bg-warning";case"Despachado":return"bg-primary";case"Cancelado":return"bg-danger";default:return"bg-secondary"}}trackByTicketId(n,a){return a.id}};c.\u0275fac=function(a){return new(a||c)(x(W),x(ae),x(K),x(Y),x(P))},c.\u0275cmp=F({type:c,selectors:[["app-ticket-list"]],standalone:!0,features:[A],decls:125,vars:14,consts:[["editContent",""],[3,"title","title2","class1","path"],[1,"row"],[1,"col-xl-3","col-lg-6","col-md-6"],[1,"card","custom-card"],[1,"card-body"],[1,"col-7"],[1,"mt-0","text-start"],[1,"fw-medium"],[1,"mb-0","mt-1","text-success"],[1,"col-5"],[1,"icon1","bg-success-transparent","my-auto","float-end"],[1,"las","la-ticket-alt"],[1,"mb-0","mt-1","text-warning"],[1,"icon1","bg-warning-transparent","my-auto","float-end"],[1,"las","la-clock"],[1,"mb-0","mt-1","text-primary"],[1,"icon1","bg-primary-transparent","my-auto","float-end"],[1,"las","la-check-circle"],[1,"mb-0","mt-1","text-info"],[1,"icon1","bg-info-transparent","my-auto","float-end"],[1,"las","la-shipping-fast"],[1,"col-md-12"],[1,"card-header"],[1,"card-title"],[1,"row","mb-2","gap-2","gap-lg-0"],[1,"col-lg-6"],[1,"d-flex","align-items-center"],[1,"d-flex","ms-2","mx-2"],[1,"form-group","mb-0"],["name","quantity","placeholder","10",1,"form-control","wd-150","p-0"],["value","10","selected",""],["value","25"],["value","50"],["value","100"],[1,"float-end"],["type","text","placeholder","Buscar",1,"form-control",3,"keyup"],[1,"table-responsive"],[1,"table","mb-0","text-nowrap","text-md-nowrap","table-bordered","border"],[1,"border-bottom"],["scope","col"],[4,"ngIf"],["class","border-bottom",4,"ngFor","ngForOf","ngForTrackBy"],[1,"mt-4"],[1,"pagination","justify-content-end","mb-0"],[1,"page-item","disabled"],["href","javascript:void(0);",1,"page-link"],[1,"page-item","active"],[1,"page-item"],["colspan","8",1,"text-center","py-4"],["role","status",1,"spinner-border","text-primary"],[1,"visually-hidden"],[1,"mt-2"],["colspan","8",1,"text-center","py-4","text-muted"],["scope","row"],[1,"avatar","me-2","avatar-rounded","bg-primary-transparent"],[1,"fe","fe-shopping-cart","fs-16"],[1,"lh-1"],[1,"mb-1"],[1,"fs-12","text-muted"],[1,"avatar","me-2","avatar-rounded","bg-secondary-transparent"],[1,"fe","fe-layers","fs-16"],[1,"fw-semibold"],[1,"d-block","text-muted"],[1,"badge"],[1,"d-flex","gap-2"],["data-bs-toggle","tooltip","title","Editar",1,"btn","btn-success","btn-icon",3,"click"],[1,"fe","fe-edit-2"],["data-bs-toggle","tooltip",1,"btn","btn-icon",3,"click","title"],["data-bs-toggle","tooltip","title","Eliminar",1,"btn","btn-danger","btn-icon",3,"click"],[1,"fe","fe-trash-2"],[3,"ngSubmit","formGroup"],[1,"modal-header"],[1,"modal-title"],["type","button","data-bs-dismiss","modal","aria-label","Close",1,"btn-close",3,"click"],[1,"modal-body"],[1,"col-md-6"],[1,"form-group"],[1,"form-label"],["formControlName","estado","placeholder","Seleccione un estado",1,"form-control","p-0"],["value","Pendiente"],["value","Autorizado"],["value","Despachado"],["value","Cancelado"],["class","invalid-feedback",4,"ngIf"],["formControlName","cantidad","type","number","placeholder","Cantidad",1,"form-control"],["formControlName","codigoAutorizacion","placeholder","C\xF3digo de autorizaci\xF3n (opcional)",1,"form-control"],[1,"modal-footer"],["type","button",1,"btn","btn-outline-primary",3,"click"],["type","submit",1,"btn","btn-success",3,"disabled"],["class","spinner-border spinner-border-sm me-2","role","status",4,"ngIf"],[1,"invalid-feedback"],["role","status",1,"spinner-border","spinner-border-sm","me-2"]],template:function(a,l){if(a&1){let s=S();m(0,"app-hr-dashboard-page-header",1),t(1,"div",2)(2,"div",3)(3,"div",4)(4,"div",5)(5,"div",2)(6,"div",6)(7,"div",7)(8,"span",8),i(9,"Total Tickets"),e(),t(10,"h3",9),i(11),e()()(),t(12,"div",10)(13,"div",11),m(14,"i",12),e()()()()()(),t(15,"div",3)(16,"div",4)(17,"div",5)(18,"div",2)(19,"div",6)(20,"div",7)(21,"span",8),i(22,"Pendientes"),e(),t(23,"h3",13),i(24),e()()(),t(25,"div",10)(26,"div",14),m(27,"i",15),e()()()()()(),t(28,"div",3)(29,"div",4)(30,"div",5)(31,"div",2)(32,"div",6)(33,"div",7)(34,"span",8),i(35,"Autorizados"),e(),t(36,"h3",16),i(37),e()()(),t(38,"div",10)(39,"div",17),m(40,"i",18),e()()()()()(),t(41,"div",3)(42,"div",4)(43,"div",5)(44,"div",2)(45,"div",6)(46,"div",7)(47,"span",8),i(48,"Despachados"),e(),t(49,"h3",19),i(50),e()()(),t(51,"div",10)(52,"div",20),m(53,"i",21),e()()()()()()(),t(54,"div",2)(55,"div",22)(56,"div",4)(57,"div",23)(58,"h3",24),i(59,"Lista de tickets"),e()(),t(60,"div",5)(61,"div",25)(62,"div",26)(63,"div",27)(64,"span"),i(65,"Mostrar"),e(),t(66,"div",28)(67,"div",29)(68,"ng-select",30)(69,"ng-option",31),i(70,"10"),e(),t(71,"ng-option",32),i(72,"25"),e(),t(73,"ng-option",33),i(74,"50"),e(),t(75,"ng-option",34),i(76,"100"),e()()()(),t(77,"span"),i(78,"registros"),e()()(),t(79,"div",26)(80,"div",35)(81,"input",36),h("keyup",function(C){return g(s),v(l.applyFilter(C))}),e()()()(),t(82,"div",37)(83,"table",38)(84,"thead")(85,"tr",39)(86,"th",40),i(87,"No"),e(),t(88,"th",40),i(89,"Venta"),e(),t(90,"th",40),i(91,"Lote"),e(),t(92,"th",40),i(93,"Producto"),e(),t(94,"th",40),i(95,"Fecha"),e(),t(96,"th",40),i(97,"Cantidad"),e(),t(98,"th",40),i(99,"Estado"),e(),t(100,"th",40),i(101,"Acciones"),e()()(),t(102,"tbody"),_(103,re,7,0,"tr",41)(104,oe,3,0,"tr",41)(105,le,50,23,"tr",42),e()()(),t(106,"nav",43)(107,"ul",44)(108,"li",45)(109,"a",46),i(110,"Prev"),e()(),t(111,"li",47)(112,"a",46),i(113,"1"),e()(),t(114,"li",48)(115,"a",46),i(116,"2"),e()(),t(117,"li",48)(118,"a",46),i(119,"3"),e()(),t(120,"li",48)(121,"a",46),i(122,"Next"),e()()()()()()()(),_(123,ue,38,9,"ng-template",null,0,N)}a&2&&(k("btn btn-primary"),u("title","Tickets")("title2","Agregar Nuevo Ticket")("class1","")("path","/dashboard/business-dashboard/new-ticket"),o(11),p(l.totalTickets),o(13),p(l.ticketsPendientes),o(13),p(l.ticketsAutorizados),o(13),p(l.ticketsDespachados),o(53),u("ngIf",l.loading),o(),u("ngIf",!l.loading&&l.tickets.length===0),o(),u("ngForOf",l.tickets)("ngForTrackBy",l.trackByTicketId))},dependencies:[B,D,z,O,M,ne,Z,ie,te,ee,$,Q,R,q,H,j,G,U,J,X]});let d=c;return d})();export{we as TicketListComponent};
