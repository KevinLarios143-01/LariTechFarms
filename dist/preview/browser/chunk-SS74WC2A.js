import{a as S,b as ge,c as pe,d as w,e as k}from"./chunk-SHSKYEHM.js";import"./chunk-S3V36EJ5.js";import{a as ue}from"./chunk-DFR7G4ST.js";import{a as de,r as _,s as ce}from"./chunk-3DATYCE5.js";import{N as ie,O as re,P as ne,Q as oe,R as ae,T as se,U as le,c as J,ca as me,e as f,g as X,h as Z,m as H,p as K,q as Q,v as Y,w as $,x as ee,y as te}from"./chunk-XRHNCSTF.js";import{$b as j,Cb as E,Fa as T,Hc as W,Ib as b,Kb as g,Qa as d,Ra as u,Vb as P,Wa as O,Wb as m,Yb as N,ac as B,bc as D,cc as R,db as C,dc as G,ea as V,fd as q,jb as p,kd as U,la as A,lb as y,ob as L,od as z,rb as I,ua as h,va as v,wb as t,xb as e,yb as a}from"./chunk-AZAYKVK3.js";import"./chunk-REZWHGN7.js";var F=(()=>{let l=class l{constructor(){S.initializeApp(ue.firebase)}getFirestore(){return w}getDatabase(){return k}getAuth(){return ge}};l.\u0275fac=function(i){return new(i||l)},l.\u0275prov=V({token:l,factory:l.\u0275fac,providedIn:"root"});let s=l;return s})();function Ce(s,l){if(s&1&&(t(0,"p",19),m(1),e()),s&2){let n=g(2);d(),N(" ",n.errorMessage,"")}}function Ee(s,l){if(s&1&&(t(0,"p",19),m(1),e()),s&2){let n=g(2);d(),N(" ",n._error.message," ")}}function Se(s,l){if(s&1){let n=E();t(0,"div",15)(1,"h2",16),m(2,"Login"),e(),t(3,"p",17),m(4,"Inicia sesi\xF3n en tu cuenta"),e()(),t(5,"form",18),b("ngSubmit",function(){h(n);let i=g();return v(i.loginWithFirebase())}),C(6,Ce,2,1,"p",19)(7,Ee,2,1,"p",19),t(8,"div",20)(9,"label",21),m(10,"Email"),e(),t(11,"div",22)(12,"div",23)(13,"a",24),a(14,"i",25),e(),a(15,"input",26),e()()(),t(16,"div",20)(17,"label",21),m(18,"Contrase\xF1a"),e(),t(19,"div",22)(20,"div",23)(21,"span",27),b("click",function(){h(n);let i=g();return v(i.togglePassword())}),a(22,"i"),e(),a(23,"input",28),e()()(),t(24,"div",29),a(25,"input",30),t(26,"label",31),m(27," Remember me"),e()(),t(28,"div",32)(29,"button",33),m(30,"Login"),e(),t(31,"div",34)(32,"p",35),m(33,"O inicia sesi\xF3n con:"),e(),t(34,"button",36),b("click",function(){h(n);let i=g();return v(i.loginWithGoogle())}),a(35,"i",37),m(36," Google "),e()()(),a(37,"div",34),e(),t(38,"div",38)(39,"div",39)(40,"span",40),a(41,"i",41),e(),t(42,"span",40),a(43,"i",42),e(),t(44,"span",43),a(45,"i",44),e()()()}if(s&2){let n=g();d(5),p("formGroup",n.firebaseForm),d(),I(n.errorMessage.length>0?6:-1),d(),I(n._error.message.length>0?7:-1),d(15),L("fe fe-",n.toggleClass," align-middle"),d(),p("type",n.showPassword?"text":"password"),d(6),y("loader--text",n.authservice.showLoader),p("disabled",!n.firebaseForm.valid||n.authservice.showLoader)}}function we(s,l){if(s&1){let n=E();t(0,"div",15)(1,"h2",16),m(2,"Login"),e(),t(3,"p",17),m(4,"Inicia sesi\xF3n en tu cuenta"),e()(),t(5,"form",45),b("ngSubmit",function(){h(n);let i=g();return v(i.submitBackend())}),t(6,"div",20)(7,"label",21),m(8,"Email"),e(),t(9,"div",22)(10,"div",23)(11,"a",24),a(12,"i",25),e(),a(13,"input",46),e()()(),t(14,"div",20)(15,"label",21),m(16,"Contrase\xF1a"),e(),t(17,"div",22)(18,"div",23)(19,"span",27),b("click",function(){h(n);let i=g();return v(i.togglePassword())}),a(20,"i"),e(),a(21,"input",28),e()()(),t(22,"div",29),a(23,"input",47),t(24,"label",48),m(25," Remember me"),e()(),t(26,"div",49)(27,"button",33),m(28," Login "),e()(),a(29,"div",34),e(),t(30,"div",38)(31,"div",39)(32,"span",40),a(33,"i",41),e(),t(34,"span",40),a(35,"i",42),e(),t(36,"span",43),a(37,"i",44),e()()()}if(s&2){let n=g();d(5),p("formGroup",n.loginForm),d(15),L("fe fe-",n.toggleClass," align-middle"),d(),p("type",n.showPassword?"text":"password"),d(6),y("loader--text",n.authservice.showLoader),p("disabled",!n.loginForm.valid||n.authservice.showLoader)}}var Xe=(()=>{let l=class l{togglePassword(){this.showPassword=!this.showPassword,this.toggleClass==="eye"?this.toggleClass="eye-off":this.toggleClass="eye"}constructor(o,i,r,c,M,x,he,ve,fe,be){this.document=o,this.elementRef=i,this.sanitizer=r,this.authservice=c,this.router=M,this.formBuilder=x,this.renderer=he,this.firebaseService=ve,this.toastr=fe,this.appStateService=be,this.showPassword=!1,this.toggleClass="eye-off",this.active="Angular",this.disabled="",this.localdata=this.appStateService,this.errorMessage="",this._error={name:"",message:""},this.error="",o.body.classList.add("error-1");let ke=this.elementRef.nativeElement.ownerDocument.documentElement}ngOnInit(){this.loginForm=this.formBuilder.group({username:["",[f.required,f.email]],password:["",f.required]}),this.firebaseForm=this.formBuilder.group({email:["",[f.required,f.email]],password:["",f.required]}),console.log("Auth State:",this.authservice.authState)}ngOnDestroy(){let o=this.elementRef.nativeElement.ownerDocument.documentElement;document.body.classList.remove("error-1")}clearErrorMessage(){this.errorMessage="",this._error={name:"",message:""}}loginWithFirebase(){this.clearErrorMessage();let o=this.firebaseForm.controls.email.value,i=this.firebaseForm.controls.password.value;console.log("Email:",o),console.log("Password length:",i.length),this.validateForm(o,i)?this.authservice.loginWithEmail(o,i).then(r=>{console.log("Usuario Firebase:",r.user),this.validateBackendUser(r.user)}).catch(r=>{this._error=r;let c="Error de autenticaci\xF3n";r.code==="auth/user-not-found"?c="Usuario no encontrado. Verifica el email.":r.code==="auth/wrong-password"||r.code==="auth/invalid-credential"?c="Email o contrase\xF1a incorrectos.":r.code==="auth/invalid-email"?c="Email inv\xE1lido.":r.message==="INVALID_LOGIN_CREDENTIALS"&&(c="Credenciales inv\xE1lidas. Verifica email y contrase\xF1a."),this.toastr.error(c,"Firebase",{timeOut:3e3,positionClass:"toast-top-right"})}):this.toastr.error("Detalles inv\xE1lidos","Firebase",{timeOut:3e3,positionClass:"toast-top-right"})}loginWithGoogle(){this.authservice.loginWithGoogle().then(o=>{this.validateBackendUser(o.user)}).catch(o=>{this.toastr.error(o.message||"Error de autenticaci\xF3n con Google","Google",{timeOut:3e3,positionClass:"toast-top-right"})})}validateForm(o,i){return o.length===0?(this.errorMessage="Por favor ingresa el email",!1):i.length===0?(this.errorMessage="Por favor ingresa la contrase\xF1a",!1):i.length<6?(this.errorMessage="La contrase\xF1a debe tener al menos 6 caracteres",!1):(this.errorMessage="",!0)}get form(){return this.loginForm.controls}loginWithBackend(){let o=this.loginForm.controls.username.value,i=this.loginForm.controls.password.value;this.authservice.backendLogin(o,i).subscribe({next:r=>{r&&r.data&&r.data.token?(this.authservice.saveToken(r.data.token),this.router.navigate(["/dashboard/hrmdashboards/dashboard"]),this.toastr.success(r.message||"Login exitoso","Backend",{timeOut:3e3,positionClass:"toast-top-right"})):this.toastr.error("Respuesta inv\xE1lida del servidor","Backend",{timeOut:3e3,positionClass:"toast-top-right"})},error:r=>{this.toastr.error("Credenciales incorrectas o error de servidor","Backend",{timeOut:3e3,positionClass:"toast-top-right"})}})}submitBackend(){this.loginWithBackend()}validateBackendUser(o){o.getIdToken().then(i=>{this.authservice.exchangeFirebaseToken(i).subscribe({next:r=>{r&&r.data&&r.data.token&&(this.authservice.saveToken(r.data.token),this.router.navigate(["/dashboard/hrmdashboards/dashboard"]),this.toastr.success("Login exitoso","Acceso Autorizado",{timeOut:3e3,positionClass:"toast-top-right"}))},error:r=>{this.authservice.singout(),this.toastr.error("Usuario no autorizado en el sistema","Acceso Denegado",{timeOut:5e3,positionClass:"toast-top-right"})}})})}logout(){this.authservice.singout(),this.authservice.removeToken(),this.router.navigate(["/"]),this.toastr.info("Sesi\xF3n cerrada","Logout",{timeOut:3e3,positionClass:"toast-top-right"})}};l.\u0275fac=function(i){return new(i||l)(u(W),u(T),u(q),u(pe),u(U),u($),u(O),u(F),u(_),u(de))},l.\u0275cmp=A({type:l,selectors:[["app-login"]],standalone:!0,features:[R([F,{provide:_,useClass:_}]),G],decls:17,vars:2,consts:[["nav","ngbNav"],[1,"page","responsive-log","login-bg"],[1,"page-single"],[1,"container"],[1,"row","justify-content-center"],[1,"col-md-9","col-lg-7","col-xl-4","col-xxl-4"],[1,"card","custom-card","my-4"],["ngbNav","",1,"nav-tabs","justify-content-center","border-bottom-0","mb-2","mt-4",3,"activeIdChange","activeId"],["ngbNavItem","Firebase"],["ngbNavLink","",1,"firebase-img"],["src","./assets/images/firebase.svg","alt","",1,"firebase"],["ngbNavContent","",1,"border-0"],["ngbNavItem","Angular"],["src","./assets/images/favicon.svg","alt","",1,"firebase"],[3,"ngbNavOutlet"],[1,"p-4","pt-0","text-center"],[1,"mb-2"],[1,"text-muted","mb-0"],["id","firebaseLogin","name","firebaseLogin",1,"card-body","pb-3",3,"ngSubmit","formGroup"],[1,"text-danger"],[1,"form-group"],[1,"form-label"],[1,"input-group","mb-3"],[1,"input-group"],["href","",1,"input-group-text"],["aria-hidden","true",1,"fe","fe-mail"],["autocomplete","","formControlName","email","required","","placeholder","Email",1,"form-control"],[1,"input-group-text",3,"click"],["required","","formControlName","password","autocomplete","","placeholder","Password",1,"form-control",3,"type"],[1,"form-check","mb-3"],["type","checkbox","value","","id","firebaseCheck",1,"form-check-input"],["for","firebaseCheck",1,"form-check-label"],[1,"submit","d-grid","gap-2"],["autofocus","",1,"btn","btn-primary","me-0",3,"disabled"],[1,"text-center","mt-3"],[1,"text-muted","mb-2"],["type","button",1,"btn","btn-outline-danger",3,"click"],[1,"ri-google-line","me-1"],[1,"card-body","border-top-0","pt-1"],[1,"text-center","mb-1"],[1,"avatar","avatar-rounded","me-2","bg-primary-transparent","text-primary"],[1,"ri-facebook-line","fs-17"],[1,"ri-instagram-line","fs-17"],[1,"avatar","avatar-rounded","bg-primary-transparent","text-primary"],[1,"ri-twitter-x-line","fs-17"],["id","backendLogin","name","backendLogin",1,"card-body","pb-3",3,"ngSubmit","formGroup"],["autocomplete","","formControlName","username","required","","placeholder","Email",1,"form-control"],["type","checkbox","value","","id","backendCheck",1,"form-check-input"],["for","backendCheck",1,"form-check-label"],[1,"submit","d-grid"]],template:function(i,r){if(i&1){let c=E();t(0,"div",1)(1,"div",2)(2,"div",3)(3,"div",4)(4,"div",5)(5,"div",6)(6,"ul",7,0),D("activeIdChange",function(x){return h(c),B(r.active,x)||(r.active=x),v(x)}),t(8,"li",8)(9,"a",9),a(10,"img",10),e(),C(11,Se,46,10,"ng-template",11),e(),t(12,"li",12)(13,"a",9),a(14,"img",13),e(),C(15,we,38,8,"ng-template",11),e()(),a(16,"div",14),e()()()()()()}if(i&2){let c=P(7);d(6),j("activeId",r.active),d(10),p("ngbNavOutlet",c)}},dependencies:[z,me,ie,oe,ne,re,se,ae,le,ee,H,J,X,Z,Y,te,K,Q,S,k,w,ce],styles:['[_nghost-%COMP%]{display:block;min-height:100vh;background-image:url("./media/11-ZXJF7C3W.jpg");background-size:cover;background-position:center;background-repeat:no-repeat}  .firebase{width:30px;height:30px}  .nav-tabs{border-color:none!important}']});let s=l;return s})();export{Xe as LoginComponent};
