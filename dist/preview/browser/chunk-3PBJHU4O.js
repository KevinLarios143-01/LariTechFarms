import{a as se}from"./chunk-5G2KFST2.js";import"./chunk-IORNA22M.js";import{c as oe,n as de}from"./chunk-FG6B37U2.js";import{a as ae,b as re,c as le}from"./chunk-S5Y45Y7X.js";import"./chunk-35J6RYA3.js";import{r as ne}from"./chunk-P6RHK3TE.js";import"./chunk-LAI4YRFV.js";import{M as te,c as H,ca as ie,e as L,g as J,h as K,m as Q,n as W,p as X,q as Y,w as Z,y as ee}from"./chunk-I6FKYEZO.js";import{Cb as I,Ib as C,Kb as b,Lc as q,Mc as B,Qa as r,Qc as $,Ra as S,Tc as z,Vb as O,Wb as i,Wc as G,Xb as v,Yb as k,Zb as T,db as _,dc as A,fc as N,jb as p,la as P,lb as F,ld as R,nb as y,nc as w,oc as V,od as U,qc as M,rc as D,ua as x,va as E,wb as t,xb as e,yb as u,yc as j}from"./chunk-W3KPMJ6O.js";import"./chunk-REZWHGN7.js";var me=l=>["/dashboard/business-dashboard/lotes/view-lote",l];function ce(l,m){l&1&&(t(0,"tr")(1,"td",49)(2,"div",50)(3,"span",51),i(4,"Cargando..."),e()(),t(5,"div",52),i(6,"Cargando lotes..."),e()()())}function pe(l,m){if(l&1&&(t(0,"tr")(1,"td",53),i(2),e()()),l&2){let a=b();r(2),k(" No se encontraron lotes (Total: ",a.lotes.length,") ")}}function ue(l,m){if(l&1){let a=I();t(0,"tr",39)(1,"th",54),i(2),e(),t(3,"td")(4,"div",27)(5,"div",55),u(6,"i",56),e(),t(7,"div")(8,"div",57)(9,"h6",58),i(10),e()(),t(11,"div",57)(12,"span",59),i(13),e()()()()(),t(14,"td")(15,"span",60),i(16),e()(),t(17,"td")(18,"span",61),i(19),w(20,"number"),e(),t(21,"small",62),i(22),e()(),t(23,"td"),i(24),w(25,"date"),e(),t(26,"td"),i(27),w(28,"date"),e(),t(29,"td")(30,"span",60),i(31),e()(),t(32,"td")(33,"div",63)(34,"a",64),u(35,"i",65),e(),t(36,"a",66),C("click",function(){let o=x(a).$implicit,d=b(),g=O(124);return E(d.edit(g,o))}),u(37,"i",67),e(),t(38,"a",68),C("click",function(){let o=x(a).$implicit,d=b();return E(d.toggleLoteStatus(o))}),u(39,"i"),e()()()()}if(l&2){let a=m.$implicit,n=b();r(2),v(a.id),r(8),v(a.galera),r(3),v(a.tipo),r(2),y(a.tipo==="Ponedoras"?"bg-info":"bg-primary"),r(),v(a.tipo),r(3),v(V(20,20,a.cantidad)),r(3),T("",(a._count==null?null:a._count.movAvesLote)||0," mov. | ",(a._count==null?null:a._count.tickets)||0," tickets"),r(2),v(M(25,22,a.fechaInicio,"dd/MM/yyyy","UTC")),r(3),v(a.fechaFin?M(28,26,a.fechaFin,"dd/MM/yyyy","UTC"):"N/A"),r(3),y(n.getEstadoBadgeClass(a.estado)),r(),v(a.estado),r(3),p("routerLink",N(30,me,a.id)),r(4),y(a.estado==="Activo"?"btn-warning":"btn-success"),p("title",a.estado==="Activo"?"Desactivar":"Activar"),r(),y(a.estado==="Activo"?"fe fe-pause-circle":"fe fe-play-circle")}}function ge(l,m){l&1&&(t(0,"div",94),i(1," El tipo es requerido "),e())}function ve(l,m){l&1&&(t(0,"div",94),i(1," La galera es requerida "),e())}function fe(l,m){l&1&&(t(0,"span"),i(1,"La cantidad es requerida"),e())}function he(l,m){l&1&&(t(0,"span"),i(1,"La cantidad debe ser mayor a 0"),e())}function _e(l,m){if(l&1&&(t(0,"div",94),_(1,fe,2,0,"span",41)(2,he,2,0,"span",41),e()),l&2){let a,n,o=b(2);r(),p("ngIf",(a=o.editForm.get("cantidad"))==null||a.errors==null?null:a.errors.required),r(),p("ngIf",(n=o.editForm.get("cantidad"))==null||n.errors==null?null:n.errors.min)}}function be(l,m){l&1&&(t(0,"div",94),i(1," La fecha de inicio es requerida "),e())}function xe(l,m){l&1&&u(0,"span",95)}function Ee(l,m){if(l&1){let a=I();t(0,"form",69),C("ngSubmit",function(){x(a);let o=b();return E(o.onUpdateLote())}),t(1,"div",70)(2,"h5",71),i(3,"Editar Lote"),e(),t(4,"button",72),C("click",function(){let o=x(a).$implicit;return E(o.dismiss("Cross click"))}),e()(),t(5,"div",73)(6,"div",2)(7,"div",74)(8,"div",75)(9,"label",76),i(10,"Tipo *"),e(),t(11,"ng-select",77)(12,"ng-option",78),i(13,"Ponedoras"),e(),t(14,"ng-option",79),i(15,"Engorde"),e()(),_(16,ge,2,0,"div",80),e()(),t(17,"div",74)(18,"div",75)(19,"label",76),i(20,"Galera *"),e(),u(21,"input",81),_(22,ve,2,0,"div",80),e()(),t(23,"div",74)(24,"div",75)(25,"label",76),i(26,"Cantidad *"),e(),u(27,"input",82),_(28,_e,3,2,"div",80),e()(),t(29,"div",74)(30,"div",75)(31,"label",76),i(32,"Estado *"),e(),t(33,"ng-select",83)(34,"ng-option",84),i(35,"Activo"),e(),t(36,"ng-option",85),i(37,"Inactivo"),e(),t(38,"ng-option",86),i(39,"Desalojado"),e()()()(),t(40,"div",74)(41,"div",75)(42,"label",76),i(43,"Fecha Inicio *"),e(),u(44,"input",87),_(45,be,2,0,"div",80),e()(),t(46,"div",74)(47,"div",75)(48,"label",76),i(49,"Fecha Fin"),e(),u(50,"input",88),e()(),t(51,"div",22)(52,"div",75)(53,"label",76),i(54,"Observaciones"),e(),u(55,"textarea",89),e()()()(),t(56,"div",90)(57,"button",91),C("click",function(){let o=x(a).$implicit;return E(o.dismiss("cancel"))}),i(58,"Cancelar"),e(),t(59,"button",92),_(60,xe,1,0,"span",93),i(61," Actualizar "),e()()()}if(l&2){let a,n,o,d,g,h,c,f,s=b();p("formGroup",s.editForm),r(11),F("is-invalid",((a=s.editForm.get("tipo"))==null?null:a.invalid)&&((a=s.editForm.get("tipo"))==null?null:a.touched)),r(5),p("ngIf",((n=s.editForm.get("tipo"))==null?null:n.invalid)&&((n=s.editForm.get("tipo"))==null?null:n.touched)),r(5),F("is-invalid",((o=s.editForm.get("galera"))==null?null:o.invalid)&&((o=s.editForm.get("galera"))==null?null:o.touched)),r(),p("ngIf",((d=s.editForm.get("galera"))==null?null:d.invalid)&&((d=s.editForm.get("galera"))==null?null:d.touched)),r(5),F("is-invalid",((g=s.editForm.get("cantidad"))==null?null:g.invalid)&&((g=s.editForm.get("cantidad"))==null?null:g.touched)),r(),p("ngIf",((h=s.editForm.get("cantidad"))==null?null:h.invalid)&&((h=s.editForm.get("cantidad"))==null?null:h.touched)),r(16),F("is-invalid",((c=s.editForm.get("fechaInicio"))==null?null:c.invalid)&&((c=s.editForm.get("fechaInicio"))==null?null:c.touched)),r(),p("ngIf",((f=s.editForm.get("fechaInicio"))==null?null:f.invalid)&&((f=s.editForm.get("fechaInicio"))==null?null:f.touched)),r(14),p("disabled",s.loading),r(),p("ngIf",s.loading)}}var De=(()=>{let m=class m{constructor(n,o,d,g,h){this.modalService=n,this.lotesService=o,this.fb=d,this.toastr=g,this.cdr=h,this.lotes=[],this.loading=!1,this.selectedLote=null,this.totalLotes=0,this.lotesActivos=0,this.lotesPonedoras=0,this.lotesEngorde=0,this.editForm=this.fb.group({tipo:["",L.required],galera:["",L.required],cantidad:["",[L.required,L.min(1)]],fechaInicio:["",L.required],fechaFin:[""],estado:["Activo"],observaciones:[""]})}applyFilter(n){let o=n.target.value.toLowerCase()}toggleLoteStatus(n){let o=n.estado==="Activo",d=o?"Inactivo":"Activo",g=o?"desactivar":"activar";if(confirm(`\xBFEst\xE1 seguro de que desea ${g} este lote?`)){let h={estado:d};this.lotesService.updateLote(n.id,h).subscribe({next:()=>{this.toastr.success(`Lote ${g}do exitosamente`,"\xC9xito",{timeOut:3e3,positionClass:"toast-top-right"}),this.loadLotes(),this.cdr.detectChanges()},error:c=>{console.error("Error response:",c);let f="Error desconocido";c.error?.message?f=c.error.message:c.error?.error?f=c.error.error:c.message?f=c.message:typeof c.error=="string"&&(f=c.error),this.toastr.error(`Error al ${g} el lote: ${f}`,"Error",{timeOut:3e3,positionClass:"toast-top-right"}),this.cdr.detectChanges()}})}}edit(n,o){this.selectedLote=o,this.editForm.patchValue({tipo:o.tipo,galera:o.galera,cantidad:o.cantidad,fechaInicio:this.formatDateForInput(o.fechaInicio),fechaFin:this.formatDateForInput(o.fechaFin||""),estado:o.estado,observaciones:o.observaciones}),this.modalService.open(n,{windowClass:"modalCusSty modal-lg"})}onUpdateLote(){if(this.editForm.valid&&this.selectedLote){this.loading=!0;let n=this.editForm.value;this.lotesService.updateLote(this.selectedLote.id,n).subscribe({next:o=>{this.toastr.success("Lote actualizado exitosamente","\xC9xito",{timeOut:3e3,positionClass:"toast-top-right"}),this.loadLotes(),this.modalService.dismissAll(),this.loading=!1,this.cdr.detectChanges()},error:o=>{this.toastr.error("Error al actualizar el lote: "+(o.error?.message||"Error desconocido"),"Error",{timeOut:3e3,positionClass:"toast-top-right"}),this.loading=!1,this.cdr.detectChanges()}})}else this.toastr.warning("Por favor, complete todos los campos requeridos","Advertencia",{timeOut:3e3,positionClass:"toast-top-right"}),this.markFormGroupTouched()}markFormGroupTouched(){Object.keys(this.editForm.controls).forEach(n=>{this.editForm.get(n)?.markAsTouched()})}open(n){this.modalService.open(n,{windowClass:"modalCusSty",size:"lg"})}ngOnInit(){this.loadLotes()}loadLotes(){this.loading=!0,this.lotesService.getLotes().subscribe({next:n=>{n?.data?.data?this.lotes=n.data.data:n?.data?.items?this.lotes=n.data.items:n?.data&&Array.isArray(n.data)?this.lotes=n.data:Array.isArray(n)?this.lotes=n:this.lotes=[],this.calculateStats(),this.loading=!1,this.cdr.detectChanges()},error:n=>{this.lotes=[],this.loading=!1,this.cdr.detectChanges()}})}calculateStats(){this.totalLotes=this.lotes.length,this.lotesActivos=this.lotes.filter(n=>n.estado==="Activo").length,this.lotesPonedoras=this.lotes.filter(n=>n.tipo==="Ponedoras").length,this.lotesEngorde=this.lotes.filter(n=>n.tipo==="Engorde").length}getEstadoBadgeClass(n){switch(n){case"Activo":return"bg-success";case"Inactivo":return"bg-warning";case"Desalojado":return"bg-danger";default:return"bg-secondary"}}trackByLoteId(n,o){return o.id}formatDateForInput(n){if(!n)return"";if(/^\d{4}-\d{2}-\d{2}$/.test(n))return n;if(n.includes("T"))return n.split("T")[0];let o=new Date(n);return isNaN(o.getTime())?"":o.toISOString().split("T")[0]}};m.\u0275fac=function(o){return new(o||m)(S(te),S(se),S(Z),S(ne),S(j))},m.\u0275cmp=P({type:m,selectors:[["app-lote-list"]],standalone:!0,features:[A],decls:125,vars:14,consts:[["editContent",""],[3,"title","title2","class1","path"],[1,"row"],[1,"col-xl-3","col-lg-6","col-md-6"],[1,"card","custom-card"],[1,"card-body"],[1,"col-7"],[1,"mt-0","text-start"],[1,"fw-medium"],[1,"mb-0","mt-1","text-success"],[1,"col-5"],[1,"icon1","bg-success-transparent","my-auto","float-end"],[1,"las","la-layer-group"],[1,"mb-0","mt-1","text-primary"],[1,"icon1","bg-primary-transparent","my-auto","float-end"],[1,"las","la-check-circle"],[1,"mb-0","mt-1","text-secondary"],[1,"icon1","bg-secondary-transparent","my-auto","float-end"],[1,"las","la-egg"],[1,"mb-0","mt-1","text-danger"],[1,"icon1","bg-danger-transparent","my-auto","float-end"],[1,"las","la-drumstick-bite"],[1,"col-md-12"],[1,"card-header"],[1,"card-title"],[1,"row","mb-2","gap-2","gap-lg-0"],[1,"col-lg-6"],[1,"d-flex","align-items-center"],[1,"d-flex","ms-2","mx-2"],[1,"form-group","mb-0"],["name","quantity","placeholder","10",1,"form-control","wd-150","p-0"],["value","10","selected",""],["value","25"],["value","50"],["value","100"],[1,"float-end"],["type","text","placeholder","Buscar",1,"form-control",3,"keyup"],[1,"table-responsive"],[1,"table","mb-0","text-nowrap","text-md-nowrap","table-bordered","border"],[1,"border-bottom"],["scope","col"],[4,"ngIf"],["class","border-bottom",4,"ngFor","ngForOf","ngForTrackBy"],[1,"mt-4"],[1,"pagination","justify-content-end","mb-0"],[1,"page-item","disabled"],["href","javascript:void(0);",1,"page-link"],[1,"page-item","active"],[1,"page-item"],["colspan","8",1,"text-center","py-4"],["role","status",1,"spinner-border","text-primary"],[1,"visually-hidden"],[1,"mt-2"],["colspan","8",1,"text-center","py-4","text-muted"],["scope","row"],[1,"avatar","me-2","avatar-rounded","bg-primary-transparent"],[1,"fe","fe-layers","fs-16"],[1,"lh-1"],[1,"mb-1"],[1,"fs-12","text-muted"],[1,"badge"],[1,"fw-semibold"],[1,"d-block","text-muted"],[1,"d-flex","gap-2"],["data-bs-toggle","tooltip","title","Ver Lote",1,"btn","btn-primary","btn-icon",3,"routerLink"],[1,"fe","fe-eye"],["data-bs-toggle","tooltip","title","Editar",1,"btn","btn-success","btn-icon",3,"click"],[1,"fe","fe-edit-2"],["data-bs-toggle","tooltip",1,"btn","btn-icon",3,"click","title"],[3,"ngSubmit","formGroup"],[1,"modal-header"],[1,"modal-title"],["type","button","data-bs-dismiss","modal","aria-label","Close",1,"btn-close",3,"click"],[1,"modal-body"],[1,"col-md-6"],[1,"form-group"],[1,"form-label"],["formControlName","tipo","placeholder","Seleccione un tipo",1,"form-control","p-0"],["value","Ponedoras"],["value","Engorde"],["class","invalid-feedback",4,"ngIf"],["formControlName","galera","placeholder","Nombre de la galera",1,"form-control"],["formControlName","cantidad","type","number","placeholder","Cantidad de aves",1,"form-control"],["formControlName","estado","placeholder","Seleccione el estado",1,"form-control","p-0"],["value","Activo"],["value","Inactivo"],["value","Desalojado"],["formControlName","fechaInicio","type","date",1,"form-control"],["formControlName","fechaFin","type","date",1,"form-control"],["formControlName","observaciones","rows","3","placeholder","Observaciones adicionales",1,"form-control"],[1,"modal-footer"],["type","button",1,"btn","btn-outline-primary",3,"click"],["type","submit",1,"btn","btn-success",3,"disabled"],["class","spinner-border spinner-border-sm me-2","role","status",4,"ngIf"],[1,"invalid-feedback"],["role","status",1,"spinner-border","spinner-border-sm","me-2"]],template:function(o,d){if(o&1){let g=I();u(0,"app-hr-dashboard-page-header",1),t(1,"div",2)(2,"div",3)(3,"div",4)(4,"div",5)(5,"div",2)(6,"div",6)(7,"div",7)(8,"span",8),i(9,"Total Lotes"),e(),t(10,"h3",9),i(11),e()()(),t(12,"div",10)(13,"div",11),u(14,"i",12),e()()()()()(),t(15,"div",3)(16,"div",4)(17,"div",5)(18,"div",2)(19,"div",6)(20,"div",7)(21,"span",8),i(22,"Lotes Activos"),e(),t(23,"h3",13),i(24),e()()(),t(25,"div",10)(26,"div",14),u(27,"i",15),e()()()()()(),t(28,"div",3)(29,"div",4)(30,"div",5)(31,"div",2)(32,"div",6)(33,"div",7)(34,"span",8),i(35,"Ponedoras"),e(),t(36,"h3",16),i(37),e()()(),t(38,"div",10)(39,"div",17),u(40,"i",18),e()()()()()(),t(41,"div",3)(42,"div",4)(43,"div",5)(44,"div",2)(45,"div",6)(46,"div",7)(47,"span",8),i(48,"Engorde"),e(),t(49,"h3",19),i(50),e()()(),t(51,"div",10)(52,"div",20),u(53,"i",21),e()()()()()()(),t(54,"div",2)(55,"div",22)(56,"div",4)(57,"div",23)(58,"h3",24),i(59,"Lista de lotes"),e()(),t(60,"div",5)(61,"div",25)(62,"div",26)(63,"div",27)(64,"span"),i(65,"Mostrar"),e(),t(66,"div",28)(67,"div",29)(68,"ng-select",30)(69,"ng-option",31),i(70,"10"),e(),t(71,"ng-option",32),i(72,"25"),e(),t(73,"ng-option",33),i(74,"50"),e(),t(75,"ng-option",34),i(76,"100"),e()()()(),t(77,"span"),i(78,"registros"),e()()(),t(79,"div",26)(80,"div",35)(81,"input",36),C("keyup",function(c){return x(g),E(d.applyFilter(c))}),e()()()(),t(82,"div",37)(83,"table",38)(84,"thead")(85,"tr",39)(86,"th",40),i(87,"No"),e(),t(88,"th",40),i(89,"Galera"),e(),t(90,"th",40),i(91,"Tipo"),e(),t(92,"th",40),i(93,"Cantidad"),e(),t(94,"th",40),i(95,"Fecha Inicio"),e(),t(96,"th",40),i(97,"Fecha Fin"),e(),t(98,"th",40),i(99,"Estado"),e(),t(100,"th",40),i(101,"Acciones"),e()()(),t(102,"tbody"),_(103,ce,7,0,"tr",41)(104,pe,3,1,"tr",41)(105,ue,40,32,"tr",42),e()()(),t(106,"nav",43)(107,"ul",44)(108,"li",45)(109,"a",46),i(110,"Prev"),e()(),t(111,"li",47)(112,"a",46),i(113,"1"),e()(),t(114,"li",48)(115,"a",46),i(116,"2"),e()(),t(117,"li",48)(118,"a",46),i(119,"3"),e()(),t(120,"li",48)(121,"a",46),i(122,"Next"),e()()()()()()()(),_(123,Ee,62,15,"ng-template",null,0,D)}o&2&&(y("btn btn-primary"),p("title","Lotes")("title2","Agregar Nuevo Lote")("class1","")("path","/dashboard/business-dashboard/lotes/new-lote"),r(11),v(d.totalLotes),r(13),v(d.lotesActivos),r(13),v(d.lotesPonedoras),r(13),v(d.lotesEngorde),r(53),p("ngIf",d.loading),r(),p("ngIf",!d.loading&&d.lotes.length===0),r(),p("ngForOf",d.lotes)("ngForTrackBy",d.trackByLoteId))},dependencies:[G,q,B,z,$,de,oe,le,re,ae,U,R,ee,Q,H,W,J,K,X,Y,ie],styles:[".action-btns1[_ngcontent-%COMP%]{margin-right:8px;padding:4px 8px;border-radius:4px;transition:all .3s ease}.action-btns1[_ngcontent-%COMP%]:hover{background-color:#0000000d}.avatar[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center}.badge[_ngcontent-%COMP%]{font-size:.75rem;font-weight:500}.fw-semibold[_ngcontent-%COMP%]{font-weight:600}.text-muted[_ngcontent-%COMP%]{color:#6c757d!important;font-size:.875rem}.custom-card[_ngcontent-%COMP%]{box-shadow:0 .125rem .25rem #00000013;border:1px solid rgba(0,0,0,.125)}.page-header[_ngcontent-%COMP%]{margin-bottom:1.5rem}.page-title[_ngcontent-%COMP%]{font-size:1.5rem;font-weight:600;color:#495057}.btn-list[_ngcontent-%COMP%]{gap:.5rem}.table-responsive[_ngcontent-%COMP%]{border-radius:.375rem}.mat-mdc-table[_ngcontent-%COMP%]{width:100%}.mat-mdc-header-cell[_ngcontent-%COMP%]{font-weight:600;color:#495057}.mat-mdc-cell[_ngcontent-%COMP%]{padding:12px 8px}.form-control[_ngcontent-%COMP%]{border-radius:.375rem;border:1px solid #ced4da}.form-control[_ngcontent-%COMP%]:focus{border-color:#86b7fe;box-shadow:0 0 0 .25rem #0d6efd40}.form-control.is-invalid[_ngcontent-%COMP%]{border-color:#dc3545}.form-control.is-invalid[_ngcontent-%COMP%]:focus{border-color:#dc3545;box-shadow:0 0 0 .25rem #dc354540}.invalid-feedback[_ngcontent-%COMP%]{display:block;width:100%;margin-top:.25rem;font-size:.875rem;color:#dc3545}.modal-header[_ngcontent-%COMP%]{border-bottom:1px solid #dee2e6;padding:1rem 1.5rem}.modal-body[_ngcontent-%COMP%]{padding:1.5rem}.modal-footer[_ngcontent-%COMP%]{border-top:1px solid #dee2e6;padding:1rem 1.5rem}.spinner-border-sm[_ngcontent-%COMP%]{width:1rem;height:1rem}@media (max-width: 768px){.page-header[_ngcontent-%COMP%]{flex-direction:column;gap:1rem}.btn-list[_ngcontent-%COMP%]{justify-content:center}.table-responsive[_ngcontent-%COMP%]{font-size:.875rem}}"]});let l=m;return l})();export{De as LoteListComponent};
