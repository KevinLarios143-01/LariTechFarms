import{a as Ft}from"./chunk-HQWWZMP5.js";import"./chunk-DFR7G4ST.js";import{f as pt,g as F,h as L,i as ut,j as wt,n as yt}from"./chunk-ZNKMRUWH.js";import{a as mt,b as ct,c as st}from"./chunk-XG7TRELF.js";import{Aa as Et,oa as _t,pa as ft,qa as gt,ra as Ct,sa as ht,ta as vt,ua as xt,va as St,wa as Tt,xa as bt,ya as kt}from"./chunk-B56AIWNQ.js";import{r as at}from"./chunk-3DATYCE5.js";import{b as lt,c as rt,d as dt}from"./chunk-EMEDTLE5.js";import{M as it,_ as nt,c as B,ca as ot,e as E,g as U,h as K,m as J,n as W,p as X,q as Z,w as tt,y as et}from"./chunk-XRHNCSTF.js";import{Ab as x,Cb as y,Ib as S,Kb as f,Ob as z,Qa as d,Qb as D,Qc as G,Ra as k,Rb as M,Sb as V,Vb as A,Wb as o,Xb as T,Yb as I,cc as q,db as u,dc as P,ec as $,jb as h,la as N,lb as w,ld as Q,nc as H,ob as R,od as Y,pc as O,rb as _,rc as j,ua as g,va as C,wb as e,xb as t,yb as m,zb as v}from"./chunk-AZAYKVK3.js";import"./chunk-REZWHGN7.js";var Lt=()=>[8,10,25,100];function Dt(i,l){i&1&&(e(0,"div",50)(1,"div",53)(2,"span",54),o(3,"Cargando..."),t()(),e(4,"p",55),o(5,"Cargando tickets..."),t()())}function Mt(i,l){i&1&&(e(0,"th",68),o(1,"#ID"),t())}function Vt(i,l){if(i&1&&(e(0,"td",69),o(1),t()),i&2){let r=l.$implicit;d(),T(r.No)}}function At(i,l){i&1&&(e(0,"th",68),o(1,"C\xF3digo"),t())}function It(i,l){if(i&1&&(e(0,"td",69)(1,"div",41)(2,"span",70),m(3,"i",71),t(),e(4,"div")(5,"h6",72),o(6),t(),e(7,"span",73),o(8),t()()()()),i&2){let r=l.$implicit;d(6),T(r.codigo),d(2),I("Ticket #",r.id,"")}}function Nt(i,l){i&1&&(e(0,"th",68),o(1,"Fecha"),t())}function Rt(i,l){if(i&1&&(e(0,"td",69),o(1),H(2,"date"),t()),i&2){let r=l.$implicit;d(),T(O(2,1,r.fecha,"dd/MM/yyyy"))}}function zt(i,l){i&1&&(e(0,"th",68),o(1,"Cantidad"),t())}function qt(i,l){if(i&1&&(e(0,"td",69),o(1),t()),i&2){let r=l.$implicit;d(),T(r.cantidad)}}function Pt(i,l){i&1&&(e(0,"th",68),o(1,"Estado"),t())}function $t(i,l){if(i&1&&(e(0,"td",69)(1,"span"),o(2),t()()),i&2){let r=l.$implicit;d(),R("badge bg-",r.status,"-transparent"),d(),T(r.statusText)}}function Ht(i,l){i&1&&(e(0,"th",74),o(1,"Acciones"),t())}function Ot(i,l){if(i&1){let r=y();e(0,"td",69)(1,"div",75)(2,"a",76),m(3,"i",77),t(),e(4,"a",78),S("click",function(){let n=g(r).$implicit,c=f(2),p=A(89);return C(c.edit(p,n))}),m(5,"i",79),t(),e(6,"a",80),S("click",function(){let n=g(r).$implicit,c=f(2);return C(c.deleteTicket(n.id))}),m(7,"i",81),t()()()}if(i&2){let r=l.$implicit;d(2),z("routerLink","/dashboard/business-dashboard/view-ticket/",r.id,"")}}function jt(i,l){i&1&&m(0,"tr",82)}function Gt(i,l){i&1&&m(0,"tr",83)}function Qt(i,l){if(i&1&&(e(0,"tr",84)(1,"td",85),o(2),t()()),i&2){f(2);let r=A(83);d(2),I('No hay datos que coincidan con el filtro "',r.value,'"')}}function Yt(i,l){if(i&1&&(e(0,"table",51),v(1,56),u(2,Mt,2,0,"th",57)(3,Vt,2,1,"td",58),x(),v(4,59),u(5,At,2,0,"th",57)(6,It,9,2,"td",58),x(),v(7,60),u(8,Nt,2,0,"th",57)(9,Rt,3,4,"td",58),x(),v(10,61),u(11,zt,2,0,"th",57)(12,qt,2,1,"td",58),x(),v(13,62),u(14,Pt,2,0,"th",57)(15,$t,3,4,"td",58),x(),v(16,63),u(17,Ht,2,0,"th",64)(18,Ot,8,2,"td",58),x(),u(19,jt,1,0,"tr",65)(20,Gt,1,0,"tr",66)(21,Qt,3,1,"tr",67),t()),i&2){let r=f();h("dataSource",r.dataSource),d(19),h("matHeaderRowDef",r.displayedColumns),d(),h("matRowDefColumns",r.displayedColumns)}}function Bt(i,l){i&1&&(e(0,"div",95),o(1," El estado es requerido "),t())}function Ut(i,l){i&1&&(e(0,"span"),o(1,"La cantidad es requerida"),t())}function Kt(i,l){i&1&&(e(0,"span"),o(1,"La cantidad debe ser mayor a 0"),t())}function Jt(i,l){if(i&1&&(e(0,"div",95),u(1,Ut,2,0,"span")(2,Kt,2,0,"span"),t()),i&2){let r,a,n=f(2);d(),_(!((r=n.editForm.get("cantidad"))==null||r.errors==null)&&r.errors.required?1:-1),d(),_(!((a=n.editForm.get("cantidad"))==null||a.errors==null)&&a.errors.min?2:-1)}}function Wt(i,l){i&1&&(e(0,"div",95),o(1," El c\xF3digo de autorizaci\xF3n es requerido "),t())}function Xt(i,l){i&1&&m(0,"span",102)}function Zt(i,l){if(i&1){let r=y();e(0,"form",86),S("ngSubmit",function(){g(r);let n=f();return C(n.onUpdateTicket())}),e(1,"div",87)(2,"h5",88),o(3,"Editar Ticket"),t(),e(4,"button",89),S("click",function(){let n=g(r).$implicit;return C(n.dismiss("Cross click"))}),t()(),e(5,"div",90)(6,"div",15)(7,"div",24)(8,"div",25)(9,"label",26),o(10,"Estado *"),t(),e(11,"ng-select",91)(12,"ng-option",92),o(13,"Pendiente"),t(),e(14,"ng-option",93),o(15,"Completado"),t(),e(16,"ng-option",94),o(17,"Cancelado"),t()(),u(18,Bt,2,0,"div",95),t()(),e(19,"div",24)(20,"div",25)(21,"label",26),o(22,"Cantidad *"),t(),m(23,"input",96),u(24,Jt,3,2,"div",95),t()(),e(25,"div",97)(26,"div",25)(27,"label",26),o(28,"C\xF3digo de Autorizaci\xF3n *"),t(),m(29,"input",98),u(30,Wt,2,0,"div",95),t()()()(),e(31,"div",99)(32,"button",100),S("click",function(){let n=g(r).$implicit;return C(n.dismiss("cancel"))}),o(33,"Cancelar"),t(),e(34,"button",101),u(35,Xt,1,0,"span",102),o(36," Actualizar "),t()()()}if(i&2){let r,a,n,c,p,b,s=f();h("formGroup",s.editForm),d(11),w("is-invalid",((r=s.editForm.get("estado"))==null?null:r.invalid)&&((r=s.editForm.get("estado"))==null?null:r.touched)),d(7),_((a=s.editForm.get("estado"))!=null&&a.invalid&&((a=s.editForm.get("estado"))!=null&&a.touched)?18:-1),d(5),w("is-invalid",((n=s.editForm.get("cantidad"))==null?null:n.invalid)&&((n=s.editForm.get("cantidad"))==null?null:n.touched)),d(),_((c=s.editForm.get("cantidad"))!=null&&c.invalid&&((c=s.editForm.get("cantidad"))!=null&&c.touched)?24:-1),d(5),w("is-invalid",((p=s.editForm.get("codigoAutorizacion"))==null?null:p.invalid)&&((p=s.editForm.get("codigoAutorizacion"))==null?null:p.touched)),d(),_((b=s.editForm.get("codigoAutorizacion"))!=null&&b.invalid&&((b=s.editForm.get("codigoAutorizacion"))!=null&&b.touched)?30:-1),d(4),h("disabled",s.loading),d(),_(s.loading?35:-1)}}var be=(()=>{let l=class l{constructor(a,n,c,p){this.modalService=a,this.ticketService=n,this.fb=c,this.toastr=p,this.displayedColumns=["ID","Codigo","Fecha","Cantidad","Estado","Action"],this.tickets=[],this.loading=!1,this.selectedTicket=null,this.dataSource=new Et([]),this.editForm=this.fb.group({estado:["",E.required],codigoAutorizacion:["",E.required],cantidad:["",[E.required,E.min(1)]]})}ngOnInit(){this.loadTickets()}ngAfterViewInit(){this.dataSource.paginator=this.paginator,this.dataSource.sort=this.sort}applyFilter(a){let n=a.target.value;this.dataSource.filter=n.trim().toLowerCase(),this.dataSource.paginator&&this.dataSource.paginator.firstPage()}edit(a,n){this.selectedTicket=this.tickets.find(c=>c.id===n.id)||null,this.selectedTicket&&this.editForm.patchValue({estado:this.selectedTicket.estado,codigoAutorizacion:this.selectedTicket.codigoAutorizacion,cantidad:this.selectedTicket.cantidad}),this.modalService.open(a,{windowClass:"modalCusSty modal-lg"})}onUpdateTicket(){if(this.editForm.valid&&this.selectedTicket){this.loading=!0;let a=this.editForm.value;this.ticketService.updateTicket(this.selectedTicket.id,a).subscribe({next:()=>{this.toastr.success("Ticket actualizado exitosamente","\xC9xito",{timeOut:3e3,positionClass:"toast-top-right"}),this.loadTickets(),this.modalService.dismissAll(),this.loading=!1},error:n=>{this.toastr.error("Error al actualizar el ticket: "+(n.error?.message||"Error desconocido"),"Error",{timeOut:3e3,positionClass:"toast-top-right"}),this.loading=!1}})}else this.toastr.warning("Por favor, complete todos los campos requeridos","Advertencia",{timeOut:3e3,positionClass:"toast-top-right"}),this.markFormGroupTouched()}deleteTicket(a){confirm("\xBFEst\xE1 seguro de que desea eliminar este ticket?")&&this.ticketService.deleteTicket(a).subscribe({next:()=>{this.toastr.success("Ticket eliminado exitosamente","\xC9xito",{timeOut:3e3,positionClass:"toast-top-right"}),this.loadTickets()},error:n=>{this.toastr.error("Error al eliminar el ticket: "+(n.error?.message||"Error desconocido"),"Error",{timeOut:3e3,positionClass:"toast-top-right"})}})}markFormGroupTouched(){Object.keys(this.editForm.controls).forEach(a=>{this.editForm.get(a)?.markAsTouched()})}loadTickets(){this.loading=!0,this.ticketService.getTickets().subscribe({next:a=>{console.log("Tickets loaded:",a),this.tickets=a||[],this.dataSource.data=this.mapTicketsToDisplay(this.tickets),this.loading=!1},error:a=>{console.error("Error loading tickets:",a),this.toastr.error("Error al cargar los tickets","Error"),this.tickets=[],this.dataSource.data=[],this.loading=!1}})}mapTicketsToDisplay(a){return!a||!Array.isArray(a)?[]:a.map(n=>({id:n.id,No:`#TK-${String(n.id).padStart(3,"0")}`,codigo:n.codigoAutorizacion,fecha:n.fecha,cantidad:n.cantidad,estado:n.estado,statusText:n.estado,status:this.getStatusClass(n.estado)}))}getStatusClass(a){switch(a.toLowerCase()){case"completado":return"success";case"pendiente":return"warning";case"cancelado":return"danger";default:return"secondary"}}};l.\u0275fac=function(n){return new(n||l)(k(it),k(Ft),k(tt),k(at))},l.\u0275cmp=N({type:l,selectors:[["app-ticket-list"]],viewQuery:function(n,c){if(n&1&&(D(F,5),D(L,5)),n&2){let p;M(p=V())&&(c.paginator=p.first),M(p=V())&&(c.sort=p.first)}},standalone:!0,features:[q([lt]),P],decls:90,vars:3,consts:[["input",""],["editContent",""],[1,"page-header","d-lg-flex","d-block"],[1,"page-leftheader"],[1,"page-title"],[1,"page-rightheader"],[1,"btn-list","d-flex","gap-1"],["routerLink","/dashboard/business-dashboard/new-ticket",1,"btn","btn-primary"],[1,"fe","fe-plus","fs-12","my-auto","me-2"],["data-bs-toggle","tooltip","data-bs-placement","top","title","E-mail",1,"btn","btn-light3"],[1,"fe","fe-mail"],["data-bs-placement","top","data-bs-toggle","tooltip","title","Contact",1,"btn","btn-light3"],[1,"fe","fe-phone-call"],["data-bs-placement","top","data-bs-toggle","tooltip","title","Info",1,"btn","btn-primary"],[1,"fe","fe-info"],[1,"row"],[1,"col-xl-12","col-md-12","col-lg-12"],[1,"card","custom-card"],[1,"card-header","d-flex","justify-content-between","border-bottom-0"],[1,"card-title"],[1,"float-end"],["type","text","placeholder","buscar",1,"form-control"],[1,"card-body"],[1,"col-md-12","col-lg-7"],[1,"col-md-6"],[1,"form-group"],[1,"form-label"],[1,"input-group"],[1,"input-group-text","text-muted"],[1,"ri-calendar-line"],["mwlFlatpickr","","type","text","placeholder","DD-MM-YYYY",1,"form-control","choose-date"],[1,"col-md-3"],["data-trigger","","placeholder","Seleccionar Estado",1,"form-control","custom-select","p-0"],["value","pendiente"],["value","completado"],["value","cancelado"],[1,"col-md-2"],[1,"form-group","mt-2"],["href","javascript:void(0);",1,"btn","btn-primary","d-grid"],[1,"card-body","border-top"],[1,"col-sm-6","mb-1"],[1,"d-flex","align-items-center"],[1,"d-flex","ms-2","mx-2"],["name","quantity","placeholder","10","data-trigger","",1,"form-control","wd-150","p-0"],["value","10","selected",""],["value","25"],["value","50"],["value","100"],["type","text","matInput","","placeholder","buscar",1,"form-control",3,"keyup"],[1,"table-responsive"],[1,"text-center","p-4"],["mat-table","","matSort","",1,"table","table-vcenter","text-nowrap","table-bordered","border-bottom",3,"dataSource"],["aria-label","Select page of tickets",3,"pageSizeOptions"],["role","status",1,"spinner-border"],[1,"visually-hidden"],[1,"mt-2"],["matColumnDef","ID"],["mat-header-cell","","mat-sort-header","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","Codigo"],["matColumnDef","Fecha"],["matColumnDef","Cantidad"],["matColumnDef","Estado"],["matColumnDef","Action"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["class","mat-row",4,"matNoDataRow"],["mat-header-cell","","mat-sort-header",""],["mat-cell",""],[1,"avatar","avatar-md","me-2","avatar-rounded","bg-primary-transparent"],[1,"fe","fe-file-text"],[1,"mb-1","fs-14"],[1,"fs-12","text-muted"],["mat-header-cell",""],[1,"d-flex"],["placement","top","ngbTooltip","Ver Ticket",1,"action-btns1",3,"routerLink"],[1,"fe","fe-eye","text-primary"],["placement","top","ngbTooltip","Editar",1,"action-btns1",3,"click"],[1,"fe","fe-edit-2","text-success"],["placement","top","ngbTooltip","Eliminar",1,"action-btns1",3,"click"],[1,"fe","fe-trash-2","text-danger"],["mat-header-row",""],["mat-row",""],[1,"mat-row"],["colspan","6",1,"mat-cell"],[3,"ngSubmit","formGroup"],[1,"modal-header"],[1,"modal-title"],["type","button","data-bs-dismiss","modal","aria-label","Close",1,"btn-close",3,"click"],[1,"modal-body"],["formControlName","estado","placeholder","Seleccionar estado",1,"form-control"],["value","Pendiente"],["value","Completado"],["value","Cancelado"],[1,"invalid-feedback"],["formControlName","cantidad","type","number","placeholder","Cantidad",1,"form-control"],[1,"col-md-12"],["formControlName","codigoAutorizacion","placeholder","C\xF3digo de autorizaci\xF3n",1,"form-control"],[1,"modal-footer"],["type","button",1,"btn","btn-outline-primary",3,"click"],["type","submit",1,"btn","btn-success",3,"disabled"],["role","status",1,"spinner-border","spinner-border-sm","me-2"]],template:function(n,c){if(n&1){let p=y();e(0,"div",2)(1,"div",3)(2,"div",4),o(3,"Lista de Tickets"),t()(),e(4,"div",5)(5,"div",6)(6,"a",7),m(7,"i",8),o(8,"Agregar Ticket "),t(),e(9,"button",9),m(10,"i",10),t(),e(11,"button",11),m(12,"i",12),t(),e(13,"button",13),m(14,"i",14),t()()()(),e(15,"div",15)(16,"div",16)(17,"div",17)(18,"div",18)(19,"h4",19),o(20,"Resumen de Tickets"),t(),e(21,"div",20),m(22,"input",21),t()(),e(23,"div",22)(24,"div",15)(25,"div",23)(26,"div",15)(27,"div",24)(28,"div",25)(29,"label",26),o(30,"Desde:"),t(),e(31,"div",25)(32,"div",27)(33,"div",28),m(34,"i",29),t(),m(35,"input",30),t()()()(),e(36,"div",24)(37,"div",25)(38,"label",26),o(39,"Hasta:"),t(),e(40,"div",25)(41,"div",27)(42,"div",28),m(43,"i",29),t(),m(44,"input",30),t()()()()()(),e(45,"div",31)(46,"div",25)(47,"label",26),o(48,"Seleccionar Estado:"),t(),e(49,"ng-select",32)(50,"ng-option",33),o(51,"Pendiente"),t(),e(52,"ng-option",34),o(53,"Completado"),t(),e(54,"ng-option",35),o(55,"Cancelado"),t()()()(),e(56,"div",36)(57,"div",37),m(58,"label",26),e(59,"a",38),o(60,"Buscar"),t()()()()(),e(61,"div",39)(62,"div",15)(63,"div",40)(64,"div",41)(65,"span"),o(66,"Mostrar"),t(),e(67,"div",42)(68,"div",25)(69,"ng-select",43)(70,"ng-option",44),o(71,"10"),t(),e(72,"ng-option",45),o(73,"25"),t(),e(74,"ng-option",46),o(75,"50"),t(),e(76,"ng-option",47),o(77,"100"),t()()()(),e(78,"span"),o(79,"entradas"),t()()(),e(80,"div",40)(81,"div",20)(82,"input",48,0),S("keyup",function(s){return g(p),C(c.applyFilter(s))}),t()()()(),e(84,"div",49),u(85,Dt,6,0,"div",50)(86,Yt,22,3,"table",51),t(),m(87,"mat-paginator",52),t()()()(),u(88,Zt,37,12,"ng-template",null,1,j)}n&2&&(d(85),_(c.loading?85:86),d(2),h("pageSizeOptions",$(2,Lt)))},dependencies:[yt,st,ct,mt,wt,pt,F,L,ut,_t,gt,xt,Ct,ft,St,ht,vt,Tt,bt,kt,dt,rt,Y,Q,et,J,B,W,U,K,X,Z,ot,nt,G]});let i=l;return i})();export{be as TicketListComponent};
