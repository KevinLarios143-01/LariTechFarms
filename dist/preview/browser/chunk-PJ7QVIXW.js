import{a as De}from"./chunk-C7LS3LED.js";import"./chunk-IORNA22M.js";import{f as pe,g as V,h as T,i as ue,j as Ve,n as Te}from"./chunk-ZNKMRUWH.js";import{a as me,b as se,c as ce}from"./chunk-XG7TRELF.js";import{Aa as ye,oa as fe,pa as _e,qa as he,ra as ve,sa as Se,ta as ge,ua as Ce,va as be,wa as xe,xa as Ee,ya as we}from"./chunk-B56AIWNQ.js";import{r as le}from"./chunk-3DATYCE5.js";import{b as oe,c as re,d as de}from"./chunk-EMEDTLE5.js";import{M as ie,_ as ne,c as Y,ca as ae,e as C,g as U,h as J,m as K,n as W,p as X,q as Z,w as ee,y as te}from"./chunk-XRHNCSTF.js";import{Ab as S,Cb as w,Ib as _,Kb as g,Ob as A,Qa as c,Qb as D,Qc as j,Ra as b,Rb as L,Sb as k,Tc as G,Vb as M,Wb as a,Xb as E,Yb as y,cc as $,db as p,dc as P,ec as H,jb as h,kd as Q,la as R,ld as z,nc as F,ob as q,od as B,pc as I,rb as x,rc as O,ua as u,va as f,wb as t,xb as e,yb as d,zb as v}from"./chunk-AZAYKVK3.js";import"./chunk-REZWHGN7.js";var ke=()=>[8,10,25,100];function Me(i,o){i&1&&(t(0,"th",64),a(1,"#ID"),e())}function Fe(i,o){if(i&1&&(t(0,"td",65),a(1),e()),i&2){let r=o.$implicit;c(),E(r.No)}}function Ie(i,o){i&1&&(t(0,"th",64),a(1,"Cliente"),e())}function Ne(i,o){if(i&1&&(t(0,"td",65)(1,"div",41)(2,"span",66),d(3,"i",67),e(),t(4,"div")(5,"h6",68),a(6),e(),t(7,"span",69),a(8),e()()()()),i&2){let r=o.$implicit;c(6),E(r.cliente),c(2),y("Venta #",r.id,"")}}function Re(i,o){i&1&&(t(0,"th",64),a(1,"Fecha"),e())}function qe(i,o){if(i&1&&(t(0,"td",65),a(1),F(2,"date"),e()),i&2){let r=o.$implicit;c(),E(I(2,1,r.fecha,"dd/MM/yyyy"))}}function Ae(i,o){i&1&&(t(0,"th",64),a(1,"Total"),e())}function $e(i,o){if(i&1&&(t(0,"td",65),a(1),F(2,"number"),e()),i&2){let r=o.$implicit;c(),y("Q",I(2,1,r.total,"1.2-2"),"")}}function Pe(i,o){i&1&&(t(0,"th",64),a(1,"Estado"),e())}function He(i,o){if(i&1&&(t(0,"td",65)(1,"span"),a(2),e()()),i&2){let r=o.$implicit;c(),q("badge bg-",r.status,"-transparent"),c(),E(r.statusText)}}function Oe(i,o){i&1&&(t(0,"th",70),a(1,"Acciones"),e())}function je(i,o){if(i&1){let r=w();t(0,"td",65)(1,"div",71)(2,"a",72),d(3,"i",73),e(),t(4,"a",74),_("click",function(){let n=u(r).$implicit,m=g();return f(m.generateTicket(n.id))}),d(5,"i",75),e(),t(6,"a",76),_("click",function(){let n=u(r).$implicit,m=g(),s=M(109);return f(m.edit(s,n))}),d(7,"i",77),e(),t(8,"a",78),_("click",function(){let n=u(r).$implicit,m=g();return f(m.deleteVenta(n.id))}),d(9,"i",79),e()()()}if(i&2){let r=o.$implicit;c(2),A("routerLink","/dashboard/business-dashboard/view-sell/",r.id,"")}}function Ge(i,o){i&1&&d(0,"tr",80)}function Qe(i,o){i&1&&d(0,"tr",81)}function ze(i,o){if(i&1&&(t(0,"tr",82)(1,"td",83),a(2),e()()),i&2){g();let r=M(83);c(2),y('No hay datos que coincidan con el filtro "',r.value,'"')}}function Be(i,o){i&1&&(t(0,"div",90)(1,"small"),a(2,"El ID del cliente es requerido"),e()())}function Ye(i,o){i&1&&(t(0,"div",90)(1,"small"),a(2,"La fecha es requerida"),e()())}function Ue(i,o){i&1&&(t(0,"div",90)(1,"small"),a(2,"El total es requerido"),e()())}function Je(i,o){i&1&&(t(0,"div",90)(1,"small"),a(2,"El estado es requerido"),e()())}function Ke(i,o){i&1&&d(0,"span",100)}function We(i,o){if(i&1){let r=w();t(0,"form",84),_("ngSubmit",function(){u(r);let n=g();return f(n.onUpdateVenta())}),t(1,"div",85)(2,"h5",86),a(3,"Editar Venta"),e(),t(4,"button",87),_("click",function(){let n=u(r).$implicit;return f(n.dismiss("Cross click"))}),e()(),t(5,"div",88)(6,"div",15)(7,"div",24)(8,"div",25)(9,"label",26),a(10,"ID Cliente *"),e(),d(11,"input",89),p(12,Be,3,0,"div",90),e()(),t(13,"div",24)(14,"div",25)(15,"label",26),a(16,"Fecha *"),e(),d(17,"input",91),p(18,Ye,3,0,"div",90),e()(),t(19,"div",24)(20,"div",25)(21,"label",26),a(22,"Total *"),e(),d(23,"input",92),p(24,Ue,3,0,"div",90),e()(),t(25,"div",24)(26,"div",25)(27,"label",26),a(28,"Estado *"),e(),t(29,"ng-select",93)(30,"ng-option",94),a(31,"Pendiente"),e(),t(32,"ng-option",95),a(33,"Completada"),e(),t(34,"ng-option",96),a(35,"Cancelada"),e()(),p(36,Je,3,0,"div",90),e()()()(),t(37,"div",97)(38,"button",98),_("click",function(){let n=u(r).$implicit;return f(n.dismiss("cancel"))}),a(39,"Cancelar"),e(),t(40,"button",99),p(41,Ke,1,0,"span",100),a(42," Actualizar "),e()()()}if(i&2){let r,l,n,m,s=g();h("formGroup",s.editForm),c(12),x((r=s.editForm.get("idCliente"))!=null&&r.invalid&&((r=s.editForm.get("idCliente"))!=null&&r.touched)?12:-1),c(6),x((l=s.editForm.get("fecha"))!=null&&l.invalid&&((l=s.editForm.get("fecha"))!=null&&l.touched)?18:-1),c(6),x((n=s.editForm.get("total"))!=null&&n.invalid&&((n=s.editForm.get("total"))!=null&&n.touched)?24:-1),c(12),x((m=s.editForm.get("estado"))!=null&&m.invalid&&((m=s.editForm.get("estado"))!=null&&m.touched)?36:-1),c(4),h("disabled",s.loading),c(),x(s.loading?41:-1)}}var bt=(()=>{let o=class o{constructor(l,n,m,s,N){this.modalService=l,this.ventaService=n,this.fb=m,this.toastr=s,this.router=N,this.displayedColumns=["ID","Cliente","Fecha","Total","Estado","Action"],this.ventas=[],this.loading=!1,this.selectedVenta=null,this.dataSource=new ye([]),this.editForm=this.fb.group({idCliente:["",[C.required,C.min(1)]],fecha:["",C.required],total:["",[C.required,C.min(0)]],estado:["",C.required]})}ngOnInit(){this.loadVentas()}ngAfterViewInit(){this.dataSource.paginator=this.paginator,this.dataSource.sort=this.sort}applyFilter(l){let n=l.target.value;this.dataSource.filter=n.trim().toLowerCase(),this.dataSource.paginator&&this.dataSource.paginator.firstPage()}edit(l,n){this.selectedVenta=this.ventas.find(m=>m.id===n.id)||null,this.selectedVenta&&this.editForm.patchValue({idCliente:this.selectedVenta.idCliente,fecha:this.selectedVenta.fecha.split("T")[0],total:this.selectedVenta.total,estado:this.selectedVenta.estado}),this.modalService.open(l,{windowClass:"modalCusSty modal-lg"})}onUpdateVenta(){if(this.editForm.valid&&this.selectedVenta){this.loading=!0;let l=this.editForm.value;this.ventaService.updateVenta(this.selectedVenta.id,l).subscribe({next:()=>{this.toastr.success("Venta actualizada exitosamente","\xC9xito",{timeOut:3e3,positionClass:"toast-top-right"}),this.loadVentas(),this.modalService.dismissAll(),this.loading=!1},error:n=>{this.toastr.error("Error al actualizar la venta: "+(n.error?.message||"Error desconocido"),"Error",{timeOut:3e3,positionClass:"toast-top-right"}),this.loading=!1}})}else this.toastr.warning("Por favor, complete todos los campos requeridos","Advertencia",{timeOut:3e3,positionClass:"toast-top-right"}),this.markFormGroupTouched()}deleteVenta(l){confirm("\xBFEst\xE1 seguro de que desea eliminar esta venta?")&&this.ventaService.deleteVenta(l).subscribe({next:()=>{this.toastr.success("Venta eliminada exitosamente","\xC9xito",{timeOut:3e3,positionClass:"toast-top-right"}),this.loadVentas()},error:n=>{this.toastr.error("Error al eliminar la venta: "+(n.error?.message||"Error desconocido"),"Error",{timeOut:3e3,positionClass:"toast-top-right"})}})}markFormGroupTouched(){Object.keys(this.editForm.controls).forEach(l=>{this.editForm.get(l)?.markAsTouched()})}loadVentas(){this.loading=!0,this.ventaService.getVentas().subscribe({next:l=>{this.ventas=l||[],this.dataSource.data=this.mapVentasToDisplay(this.ventas),this.loading=!1},error:l=>{console.error("Error loading ventas:",l),this.ventas=[],this.dataSource.data=[],this.loading=!1}})}mapVentasToDisplay(l){return!l||!Array.isArray(l)?[]:l.map(n=>({id:n.id,No:`#VT-${String(n.id).padStart(3,"0")}`,cliente:`Cliente #${n.idCliente}`,fecha:n.fecha,total:n.total,estado:n.estado,statusText:n.estado,status:this.getStatusClass(n.estado)}))}generateTicket(l){this.router.navigate(["/dashboard/business-dashboard/new-ticket"],{queryParams:{ventaId:l}})}getStatusClass(l){switch(l.toLowerCase()){case"completada":return"success";case"pendiente":return"warning";case"cancelada":return"danger";default:return"secondary"}}};o.\u0275fac=function(n){return new(n||o)(b(ie),b(De),b(ee),b(le),b(Q))},o.\u0275cmp=R({type:o,selectors:[["app-sell-list"]],viewQuery:function(n,m){if(n&1&&(D(V,5),D(T,5)),n&2){let s;L(s=k())&&(m.paginator=s.first),L(s=k())&&(m.sort=s.first)}},standalone:!0,features:[$([oe]),P],decls:110,vars:5,consts:[["input",""],["editContent",""],[1,"page-header","d-lg-flex","d-block"],[1,"page-leftheader"],[1,"page-title"],[1,"page-rightheader"],[1,"btn-list","d-flex","gap-1"],["routerLink","/dashboard/business-dashboard/new-sell",1,"btn","btn-primary"],[1,"fe","fe-plus","fs-12","my-auto","me-2"],["data-bs-toggle","tooltip","data-bs-placement","top","title","E-mail",1,"btn","btn-light3"],[1,"fe","fe-mail"],["data-bs-placement","top","data-bs-toggle","tooltip","title","Contact",1,"btn","btn-light3"],[1,"fe","fe-phone-call"],["data-bs-placement","top","data-bs-toggle","tooltip","title","Info",1,"btn","btn-primary"],[1,"fe","fe-info"],[1,"row"],[1,"col-xl-12","col-md-12","col-lg-12"],[1,"card","custom-card"],[1,"card-header","d-flex","justify-content-between","border-bottom-0"],[1,"card-title"],[1,"float-end"],["type","text","placeholder","buscar",1,"form-control"],[1,"card-body"],[1,"col-md-12","col-lg-7"],[1,"col-md-6"],[1,"form-group"],[1,"form-label"],[1,"input-group"],[1,"input-group-text","text-muted"],[1,"ri-calendar-line"],["mwlFlatpickr","","type","text","placeholder","DD-MM-YYYY",1,"form-control","choose-date"],[1,"col-md-3"],["data-trigger","","placeholder","Seleccionar Estado",1,"form-control","custom-select","p-0"],["value","pendiente"],["value","completada"],["value","cancelada"],[1,"col-md-2"],[1,"form-group","mt-2"],["href","javascript:void(0);",1,"btn","btn-primary","d-grid"],[1,"card-body","border-top"],[1,"col-sm-6","mb-1"],[1,"d-flex","align-items-center"],[1,"d-flex","ms-2","mx-2"],["name","quantity","placeholder","10","data-trigger","",1,"form-control","wd-150","p-0"],["value","10","selected",""],["value","25"],["value","50"],["value","100"],["type","text","matInput","","placeholder","buscar",1,"form-control",3,"keyup"],[1,"table-responsive"],["mat-table","","matSort","",1,"table","table-vcenter","text-nowrap","table-bordered","border-bottom",3,"dataSource"],["matColumnDef","ID"],["mat-header-cell","","mat-sort-header","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","Cliente"],["matColumnDef","Fecha"],["matColumnDef","Total"],["matColumnDef","Estado"],["matColumnDef","Action"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["class","mat-row",4,"matNoDataRow"],["aria-label","Select page of sells",3,"pageSizeOptions"],["mat-header-cell","","mat-sort-header",""],["mat-cell",""],[1,"avatar","avatar-md","me-2","avatar-rounded","bg-success-transparent"],[1,"fe","fe-user"],[1,"mb-1","fs-14"],[1,"fs-12","text-muted"],["mat-header-cell",""],[1,"d-flex"],["placement","top","ngbTooltip","Ver Venta",1,"action-btns1",3,"routerLink"],[1,"fe","fe-eye","text-primary"],["placement","top","ngbTooltip","Generar Ticket",1,"action-btns1",3,"click"],[1,"fe","fe-file-plus","text-info"],["placement","top","ngbTooltip","Editar",1,"action-btns1",3,"click"],[1,"fe","fe-edit-2","text-success"],["placement","top","ngbTooltip","Eliminar",1,"action-btns1",3,"click"],[1,"fe","fe-trash-2","text-danger"],["mat-header-row",""],["mat-row",""],[1,"mat-row"],["colspan","6",1,"mat-cell"],[3,"ngSubmit","formGroup"],[1,"modal-header"],[1,"modal-title"],["type","button","data-bs-dismiss","modal","aria-label","Close",1,"btn-close",3,"click"],[1,"modal-body"],["formControlName","idCliente","type","number","placeholder","ID del cliente",1,"form-control"],[1,"text-danger"],["formControlName","fecha","type","date",1,"form-control"],["formControlName","total","type","number","step","0.01","placeholder","Total de la venta",1,"form-control"],["formControlName","estado","placeholder","Seleccionar estado",1,"form-control"],["value","Pendiente"],["value","Completada"],["value","Cancelada"],[1,"modal-footer"],["type","button",1,"btn","btn-outline-primary",3,"click"],["type","submit",1,"btn","btn-success",3,"disabled"],[1,"spinner-border","spinner-border-sm","me-2"]],template:function(n,m){if(n&1){let s=w();t(0,"div",2)(1,"div",3)(2,"div",4),a(3,"Lista de Ventas"),e()(),t(4,"div",5)(5,"div",6)(6,"a",7),d(7,"i",8),a(8,"Agregar Venta "),e(),t(9,"button",9),d(10,"i",10),e(),t(11,"button",11),d(12,"i",12),e(),t(13,"button",13),d(14,"i",14),e()()()(),t(15,"div",15)(16,"div",16)(17,"div",17)(18,"div",18)(19,"h4",19),a(20,"Resumen de Ventas"),e(),t(21,"div",20),d(22,"input",21),e()(),t(23,"div",22)(24,"div",15)(25,"div",23)(26,"div",15)(27,"div",24)(28,"div",25)(29,"label",26),a(30,"Desde:"),e(),t(31,"div",25)(32,"div",27)(33,"div",28),d(34,"i",29),e(),d(35,"input",30),e()()()(),t(36,"div",24)(37,"div",25)(38,"label",26),a(39,"Hasta:"),e(),t(40,"div",25)(41,"div",27)(42,"div",28),d(43,"i",29),e(),d(44,"input",30),e()()()()()(),t(45,"div",31)(46,"div",25)(47,"label",26),a(48,"Seleccionar Estado:"),e(),t(49,"ng-select",32)(50,"ng-option",33),a(51,"Pendiente"),e(),t(52,"ng-option",34),a(53,"Completada"),e(),t(54,"ng-option",35),a(55,"Cancelada"),e()()()(),t(56,"div",36)(57,"div",37),d(58,"label",26),t(59,"a",38),a(60,"Buscar"),e()()()()(),t(61,"div",39)(62,"div",15)(63,"div",40)(64,"div",41)(65,"span"),a(66,"Mostrar"),e(),t(67,"div",42)(68,"div",25)(69,"ng-select",43)(70,"ng-option",44),a(71,"10"),e(),t(72,"ng-option",45),a(73,"25"),e(),t(74,"ng-option",46),a(75,"50"),e(),t(76,"ng-option",47),a(77,"100"),e()()()(),t(78,"span"),a(79,"entradas"),e()()(),t(80,"div",40)(81,"div",20)(82,"input",48,0),_("keyup",function(Le){return u(s),f(m.applyFilter(Le))}),e()()()(),t(84,"div",49)(85,"table",50),v(86,51),p(87,Me,2,0,"th",52)(88,Fe,2,1,"td",53),S(),v(89,54),p(90,Ie,2,0,"th",52)(91,Ne,9,2,"td",53),S(),v(92,55),p(93,Re,2,0,"th",52)(94,qe,3,4,"td",53),S(),v(95,56),p(96,Ae,2,0,"th",52)(97,$e,3,4,"td",53),S(),v(98,57),p(99,Pe,2,0,"th",52)(100,He,3,4,"td",53),S(),v(101,58),p(102,Oe,2,0,"th",59)(103,je,10,2,"td",53),S(),p(104,Ge,1,0,"tr",60)(105,Qe,1,0,"tr",61)(106,ze,3,1,"tr",62),e()(),d(107,"mat-paginator",63),e()()()(),p(108,We,43,7,"ng-template",null,1,O)}n&2&&(c(85),h("dataSource",m.dataSource),c(19),h("matHeaderRowDef",m.displayedColumns),c(),h("matRowDefColumns",m.displayedColumns),c(2),h("pageSizeOptions",H(4,ke)))},dependencies:[Te,ce,se,me,Ve,pe,V,T,ue,fe,he,Ce,ve,_e,be,Se,ge,xe,Ee,we,de,re,B,z,te,K,Y,W,U,J,X,Z,ae,ne,j,G]});let i=o;return i})();export{bt as SellListComponent};
