import{a as Le}from"./chunk-UHNWU3KV.js";import"./chunk-IORNA22M.js";import{f as fe,g as N,h as I,i as _e,j as De,n as ke}from"./chunk-ZNKMRUWH.js";import{a as ce,b as pe,c as ue}from"./chunk-XG7TRELF.js";import{Aa as Fe,oa as Ce,pa as ve,qa as ge,ra as he,sa as be,ta as Se,ua as xe,va as Ee,wa as we,xa as ye,ya as Te}from"./chunk-B56AIWNQ.js";import{r as re}from"./chunk-3DATYCE5.js";import{a as O,b as me,c as de,d as se}from"./chunk-EMEDTLE5.js";import{M as le,_ as oe,c as K,ca as ae,e as w,g as W,h as X,m as Z,p as ee,q as te,w as ie,y as ne}from"./chunk-XRHNCSTF.js";import{Ab as S,Cb as M,Ib as x,Kb as E,Na as P,Qa as m,Qb as V,Ra as D,Rb as R,Sb as q,Vb as A,Wb as l,Xb as z,Yb as F,cc as G,db as f,dc as Q,ec as Y,jb as C,la as $,lb as T,ld as B,nb as j,ob as H,od as J,rb as v,rc as U,ua as g,va as h,wb as i,xb as e,yb as s,zb as b}from"./chunk-AZAYKVK3.js";import"./chunk-REZWHGN7.js";var Me=()=>[8,10,25,100];function Ne(t,a){t&1&&(i(0,"th",63),l(1," #ID "),e())}function Ie(t,a){if(t&1&&(i(0,"td",64),l(1),e()),t&2){let r=a.$implicit;m(),F(" ",r.No," ")}}function Ve(t,a){t&1&&(i(0,"th",63),l(1," Nombre "),e())}function Re(t,a){if(t&1&&(i(0,"td",64)(1,"a",65)(2,"span",66),s(3,"img",67),e(),i(4,"div",68)(5,"h6",69),l(6),e()()()()),t&2){let r=a.$implicit;m(3),C("src",r.img,P),m(3),z(r.name)}}function qe(t,a){t&1&&(i(0,"th",63),l(1," Correo "),e())}function Ae(t,a){if(t&1&&(i(0,"td",64),l(1),e()),t&2){let r=a.$implicit;m(),F(" ",r.email," ")}}function Oe(t,a){t&1&&(i(0,"th",63),l(1," Proyectos "),e())}function $e(t,a){if(t&1&&(i(0,"td",64),l(1),e()),t&2){let r=a.$implicit;m(),F(" ",r.project," ")}}function Pe(t,a){t&1&&(i(0,"th",63),l(1," Estado "),e())}function je(t,a){if(t&1&&(i(0,"td",64)(1,"span"),l(2),e()()),t&2){let r=a.$implicit;m(),H("badge bg-",r.status,"-transparent"),m(),F(" ",r.statusText,"")}}function He(t,a){t&1&&(i(0,"th",70),l(1," Acciones "),e())}function ze(t,a){if(t&1){let r=M();i(0,"td",64)(1,"div",71)(2,"a",72),s(3,"i",73),e(),i(4,"a",74),x("click",function(){let n=g(r).$implicit,d=E(),p=A(107);return h(d.edit(p,n))}),s(5,"i",75),e(),i(6,"a",76),x("click",function(){let n=g(r).$implicit,d=E();return h(d.toggleClienteStatus(n.No))}),s(7,"i"),e()()()}if(t&2){let r=a.$implicit;m(6),C("ngbTooltip",r.status==="success"?"Desactivar":"Activar"),m(),j(r.status==="success"?"fe fe-user-x text-warning":"fe fe-user-check text-success")}}function Ge(t,a){t&1&&s(0,"tr",77)}function Qe(t,a){t&1&&s(0,"tr",78)}function Ye(t,a){if(t&1&&(i(0,"tr",79)(1,"td",80),l(2),e()()),t&2){E();let r=A(81);m(2),F('No hay datos que coincidan con el filtro "',r.value,'"')}}function Ue(t,a){t&1&&(i(0,"div",87),l(1," El nombre es requerido "),e())}function Be(t,a){t&1&&(i(0,"div",87),l(1," El tel\xE9fono es requerido "),e())}function Je(t,a){t&1&&(i(0,"span"),l(1,"El correo es requerido"),e())}function Ke(t,a){t&1&&(i(0,"span"),l(1,"Ingrese un correo v\xE1lido"),e())}function We(t,a){if(t&1&&(i(0,"div",87),f(1,Je,2,0,"span")(2,Ke,2,0,"span"),e()),t&2){let r,o,n=E(2);m(),v(!((r=n.editForm.get("correo"))==null||r.errors==null)&&r.errors.required?1:-1),m(),v(!((o=n.editForm.get("correo"))==null||o.errors==null)&&o.errors.email?2:-1)}}function Xe(t,a){t&1&&(i(0,"div",87),l(1," El NIT es requerido "),e())}function Ze(t,a){t&1&&(i(0,"div",87),l(1," La direcci\xF3n es requerida "),e())}function et(t,a){t&1&&s(0,"span",96)}function tt(t,a){if(t&1){let r=M();i(0,"form",81),x("ngSubmit",function(){g(r);let n=E();return h(n.onUpdateCliente())}),i(1,"div",82)(2,"h5",83),l(3,"Editar Cliente"),e(),i(4,"button",84),x("click",function(){let n=g(r).$implicit;return h(n.dismiss("Cross click"))}),e()(),i(5,"div",85)(6,"div",15)(7,"div",24)(8,"div",25)(9,"label",26),l(10,"Nombre *"),e(),s(11,"input",86),f(12,Ue,2,0,"div",87),e()(),i(13,"div",24)(14,"div",25)(15,"label",26),l(16,"Tel\xE9fono *"),e(),s(17,"input",88),f(18,Be,2,0,"div",87),e()(),i(19,"div",24)(20,"div",25)(21,"label",26),l(22,"Correo Electr\xF3nico *"),e(),s(23,"input",89),f(24,We,3,2,"div",87),e()(),i(25,"div",24)(26,"div",25)(27,"label",26),l(28,"NIT *"),e(),s(29,"input",90),f(30,Xe,2,0,"div",87),e()(),i(31,"div",91)(32,"div",25)(33,"label",26),l(34,"Direcci\xF3n *"),e(),s(35,"textarea",92),f(36,Ze,2,0,"div",87),e()()()(),i(37,"div",93)(38,"button",94),x("click",function(){let n=g(r).$implicit;return h(n.dismiss("cancel"))}),l(39,"Cancelar"),e(),i(40,"button",95),f(41,et,1,0,"span",96),l(42," Actualizar "),e()()()}if(t&2){let r,o,n,d,p,y,u,_,k,L,c=E();C("formGroup",c.editForm),m(11),T("is-invalid",((r=c.editForm.get("nombre"))==null?null:r.invalid)&&((r=c.editForm.get("nombre"))==null?null:r.touched)),m(),v((o=c.editForm.get("nombre"))!=null&&o.invalid&&((o=c.editForm.get("nombre"))!=null&&o.touched)?12:-1),m(5),T("is-invalid",((n=c.editForm.get("telefono"))==null?null:n.invalid)&&((n=c.editForm.get("telefono"))==null?null:n.touched)),m(),v((d=c.editForm.get("telefono"))!=null&&d.invalid&&((d=c.editForm.get("telefono"))!=null&&d.touched)?18:-1),m(5),T("is-invalid",((p=c.editForm.get("correo"))==null?null:p.invalid)&&((p=c.editForm.get("correo"))==null?null:p.touched)),m(),v((y=c.editForm.get("correo"))!=null&&y.invalid&&((y=c.editForm.get("correo"))!=null&&y.touched)?24:-1),m(5),T("is-invalid",((u=c.editForm.get("nit"))==null?null:u.invalid)&&((u=c.editForm.get("nit"))==null?null:u.touched)),m(),v((_=c.editForm.get("nit"))!=null&&_.invalid&&((_=c.editForm.get("nit"))!=null&&_.touched)?30:-1),m(5),T("is-invalid",((k=c.editForm.get("direccion"))==null?null:k.invalid)&&((k=c.editForm.get("direccion"))==null?null:k.touched)),m(),v((L=c.editForm.get("direccion"))!=null&&L.invalid&&((L=c.editForm.get("direccion"))!=null&&L.touched)?36:-1),m(4),C("disabled",c.loading),m(),v(c.loading?41:-1)}}var yt=(()=>{let a=class a{constructor(o,n,d,p){this.modalService=o,this.clienteService=n,this.fb=d,this.toastr=p,this.displayedColumns=["ID","Name","Email","Projects","Status","Action"],this.clientes=[],this.loading=!1,this.selectedCliente=null,this.inlineDatePicker=!1,this.flatpickrOptions={inline:!0},this.dataSource=new Fe([]),this.editForm=this.fb.group({nombre:["",w.required],telefono:["",w.required],correo:["",[w.required,w.email]],direccion:["",w.required],nit:["",w.required]})}ngAfterViewInit(){this.dataSource.paginator=this.paginator,this.dataSource.sort=this.sort}applyFilter(o){let n=o.target.value;this.dataSource.filter=n.trim().toLowerCase(),this.dataSource.paginator&&this.dataSource.paginator.firstPage()}toggleClienteStatus(o){let n=this.dataSource.data.find(d=>d.No===o);if(n){let d=n.status==="success",p=d?"desactivar":"activar";confirm(`\xBFEst\xE1 seguro de que desea ${p} este cliente?`)&&(d?this.clienteService.deactivateCliente(n.id):this.clienteService.activateCliente(n.id)).subscribe({next:()=>{this.toastr.success(`Cliente ${p}do exitosamente`,"\xC9xito",{timeOut:3e3,positionClass:"toast-top-right"}),this.loadClientes()},error:u=>{console.error("Error response:",u);let _="Error desconocido";u.error?.message?_=u.error.message:u.error?.error?_=u.error.error:u.message?_=u.message:typeof u.error=="string"&&(_=u.error),this.toastr.error(`Error al ${p} el cliente: ${_}`,"Error",{timeOut:3e3,positionClass:"toast-top-right"})}})}}edit(o,n){this.selectedCliente=this.clientes.find(d=>d.id===n.id)||null,this.selectedCliente&&this.editForm.patchValue({nombre:this.selectedCliente.nombre,telefono:this.selectedCliente.telefono,correo:this.selectedCliente.correo,direccion:this.selectedCliente.direccion,nit:this.selectedCliente.nit}),this.modalService.open(o,{windowClass:"modalCusSty modal-lg"})}onUpdateCliente(){if(this.editForm.valid&&this.selectedCliente){this.loading=!0;let o=this.editForm.value;this.clienteService.updateCliente(this.selectedCliente.id,o).subscribe({next:n=>{this.toastr.success("Cliente actualizado exitosamente","\xC9xito",{timeOut:3e3,positionClass:"toast-top-right"}),this.loadClientes(),this.modalService.dismissAll(),this.loading=!1},error:n=>{this.toastr.error("Error al actualizar el cliente: "+(n.error?.message||"Error desconocido"),"Error",{timeOut:3e3,positionClass:"toast-top-right"}),this.loading=!1}})}else this.toastr.warning("Por favor, complete todos los campos requeridos","Advertencia",{timeOut:3e3,positionClass:"toast-top-right"}),this.markFormGroupTouched()}markFormGroupTouched(){Object.keys(this.editForm.controls).forEach(o=>{this.editForm.get(o)?.markAsTouched()})}open(o){this.modalService.open(o,{windowClass:"modalCusSty",size:"lg"})}ngOnInit(){this.loadClientes(),this.initializeFlatpickr()}loadClientes(){this.loading=!0,this.clienteService.getClientes().subscribe({next:o=>{console.log("Clientes received:",o),this.clientes=o||[],this.dataSource.data=this.mapClientesToDisplay(this.clientes),this.loading=!1},error:o=>{console.error("Error loading clientes:",o),this.clientes=[],this.dataSource.data=[],this.loading=!1}})}mapClientesToDisplay(o){return!o||!Array.isArray(o)?(console.warn("Clientes is not an array:",o),[]):o.map((n,d)=>({id:n.id,No:`#CLT-${String(n.id).padStart(3,"0")}`,name:n.nombre||"Sin nombre",img:n.img||"./assets/images/laritechfarms/2.jpg",email:n.correo||n.email||"",project:n.proyectos||n._count?.proyectos||0,statusText:n.estado||n.activo?"Active":"InActive",status:n.estado||n.activo?"success":"danger"}))}initializeFlatpickr(){this.flatpickrOptions={enableTime:!0,noCalendar:!0,dateFormat:"H:i"},O("#inlinetime",this.flatpickrOptions),this.flatpickrOptions={enableTime:!0,dateFormat:"Y-m-d H:i",defaultDate:"2023-11-07 14:30"},O("#pretime",this.flatpickrOptions)}};a.\u0275fac=function(n){return new(n||a)(D(le),D(Le),D(ie),D(re))},a.\u0275cmp=$({type:a,selectors:[["app-client-list"]],viewQuery:function(n,d){if(n&1&&(V(N,5),V(I,5)),n&2){let p;R(p=q())&&(d.paginator=p.first),R(p=q())&&(d.sort=p.first)}},standalone:!0,features:[G([me]),Q],decls:108,vars:5,consts:[["input",""],["editContent",""],[1,"page-header","d-lg-flex","d-block"],[1,"page-leftheader"],[1,"page-title"],[1,"page-rightheader"],[1,"btn-list","d-flex","gap-1"],["routerLink","/dashboard/client-dashboard/new-client",1,"btn","btn-primary"],[1,"fe","fe-plus","fs-12","my-auto","me-2"],["data-bs-toggle","tooltip","data-bs-placement","top","title","E-mail",1,"btn","btn-light3"],[1,"fe","fe-mail"],["data-bs-placement","top","data-bs-toggle","tooltip","title","Contact",1,"btn","btn-light3"],[1,"fe","fe-phone-call"],["data-bs-placement","top","data-bs-toggle","tooltip","title","Info",1,"btn","btn-primary"],[1,"fe","fe-info"],[1,"row"],[1,"col-xl-12","col-md-12","col-lg-12"],[1,"card","custom-card"],[1,"card-header","d-flex","justify-content-between","border-bottom-0"],[1,"card-title"],[1,"float-end"],["type","text","placeholder","buscar",1,"form-control"],[1,"card-body"],[1,"col-md-12","col-lg-7"],[1,"col-md-6"],[1,"form-group"],[1,"form-label"],[1,"input-group"],[1,"input-group-text","text-muted"],[1,"ri-calendar-line"],["mwlFlatpickr","","type","text","placeholder","DD-MM-YYYY",1,"form-control","choose-date"],[1,"col-md-3"],["data-trigger","","placeholder","Seleccionar Estado",1,"form-control","custom-select","p-0"],["value",""],["value","1"],[1,"col-md-2"],[1,"form-group","mt-2"],["href","javascript:void(0);",1,"btn","btn-primary","d-grid"],[1,"card-body","border-top"],[1,"col-sm-6","mb-1"],[1,"d-flex","align-items-center"],[1,"d-flex","ms-2","mx-2"],["name","quantity","id","select-countries17","placeholder","1","data-trigger","",1,"form-control","wd-150","p-0"],["value","1","selected",""],["value","2"],["value","3"],["value","4"],["type","text","matInput","","placeholder","buscar",1,"form-control",3,"keyup"],[1,"table-responsive"],["mat-table","","matSort","","id","client-list",1,"table","table-vcenter","text-nowrap","table-bordered","border-bottom",3,"dataSource"],["matColumnDef","ID"],["mat-header-cell","","mat-sort-header","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","Name"],["matColumnDef","Email"],["matColumnDef","Projects"],["matColumnDef","Status"],["matColumnDef","Action"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["class","mat-row",4,"matNoDataRow"],["aria-label","Select page of users",3,"pageSizeOptions"],["mat-header-cell","","mat-sort-header",""],["mat-cell",""],["routerLink","/dashboard/client-dashboard/user-profile",1,"d-flex"],[1,"avatar","avatar-md","me-2","avatar-rounded"],["alt","img",3,"src"],[1,"me-3","mt-0","mt-sm-2","d-block"],[1,"mb-1","fs-14"],["mat-header-cell",""],[1,"d-flex"],["routerLink","/dashboard/client-dashboard/view-client","placement","top","ngbTooltip","Ver Cliente",1,"action-btns1"],[1,"fe","fe-eye","text-primary"],["placement","top","ngbTooltip","Editar",1,"action-btns1",3,"click"],[1,"fe","fe-edit-2","text-success"],["placement","top",1,"action-btns1",3,"click","ngbTooltip"],["mat-header-row",""],["mat-row",""],[1,"mat-row"],["colspan","4",1,"mat-cell"],[3,"ngSubmit","formGroup"],[1,"modal-header"],[1,"modal-title"],["type","button","data-bs-dismiss","modal","aria-label","Close",1,"btn-close",3,"click"],[1,"modal-body"],["formControlName","nombre","placeholder","Nombre del cliente",1,"form-control"],[1,"invalid-feedback"],["formControlName","telefono","placeholder","Tel\xE9fono",1,"form-control"],["formControlName","correo","type","email","placeholder","correo@ejemplo.com",1,"form-control"],["formControlName","nit","placeholder","NIT",1,"form-control"],[1,"col-md-12"],["formControlName","direccion","rows","3","placeholder","Direcci\xF3n completa",1,"form-control"],[1,"modal-footer"],["type","button",1,"btn","btn-outline-primary",3,"click"],["type","submit",1,"btn","btn-success",3,"disabled"],["role","status",1,"spinner-border","spinner-border-sm","me-2"]],template:function(n,d){if(n&1){let p=M();i(0,"div",2)(1,"div",3)(2,"div",4),l(3,"Lista de Clientes"),e()(),i(4,"div",5)(5,"div",6)(6,"a",7),s(7,"i",8),l(8,"Agregar Cliente"),e(),i(9,"button",9),s(10,"i",10),e(),i(11,"button",11),s(12,"i",12),e(),i(13,"button",13),s(14,"i",14),e()()()(),i(15,"div",15)(16,"div",16)(17,"div",17)(18,"div",18)(19,"h4",19),l(20,"Resumen de Clientes"),e(),i(21,"div",20),s(22,"input",21),e()(),i(23,"div",22)(24,"div",15)(25,"div",23)(26,"div",15)(27,"div",24)(28,"div",25)(29,"label",26),l(30,"Desde:"),e(),i(31,"div",25)(32,"div",27)(33,"div",28),s(34,"i",29),e(),s(35,"input",30),e()()()(),i(36,"div",24)(37,"div",25)(38,"label",26),l(39,"Hasta:"),e(),i(40,"div",25)(41,"div",27)(42,"div",28),s(43,"i",29),e(),s(44,"input",30),e()()()()()(),i(45,"div",31)(46,"div",25)(47,"label",26),l(48,"Seleccionar Estado:"),e(),i(49,"ng-select",32)(50,"ng-option",33),l(51,"Activo"),e(),i(52,"ng-option",34),l(53,"Inactivo"),e()()()(),i(54,"div",35)(55,"div",36),s(56,"label",26),i(57,"a",37),l(58,"Buscar"),e()()()()(),i(59,"div",38)(60,"div",15)(61,"div",39)(62,"div",40)(63,"span"),l(64,"Mostrar"),e(),i(65,"div",41)(66,"div",25)(67,"ng-select",42)(68,"ng-option",43),l(69,"1"),e(),i(70,"ng-option",44),l(71,"2"),e(),i(72,"ng-option",45),l(73,"3"),e(),i(74,"ng-option",46),l(75,"4"),e()()()(),i(76,"span"),l(77,"entradas"),e()()(),i(78,"div",39)(79,"div",20)(80,"input",47,0),x("keyup",function(u){return g(p),h(d.applyFilter(u))}),e()()()(),i(82,"div",48)(83,"table",49),b(84,50),f(85,Ne,2,0,"th",51)(86,Ie,2,1,"td",52),S(),b(87,53),f(88,Ve,2,0,"th",51)(89,Re,7,2,"td",52),S(),b(90,54),f(91,qe,2,0,"th",51)(92,Ae,2,1,"td",52),S(),b(93,55),f(94,Oe,2,0,"th",51)(95,$e,2,1,"td",52),S(),b(96,56),f(97,Pe,2,0,"th",51)(98,je,3,4,"td",52),S(),b(99,57),f(100,He,2,0,"th",58)(101,ze,8,3,"td",52),S(),f(102,Ge,1,0,"tr",59)(103,Qe,1,0,"tr",60)(104,Ye,3,1,"tr",61),e()(),s(105,"mat-paginator",62),e()()()(),f(106,tt,43,18,"ng-template",null,1,U)}n&2&&(m(83),C("dataSource",d.dataSource),m(19),C("matHeaderRowDef",d.displayedColumns),m(),C("matRowDefColumns",d.displayedColumns),m(2),C("pageSizeOptions",Y(4,Me)))},dependencies:[ke,ue,pe,ce,De,fe,N,I,_e,Ce,ge,xe,he,ve,Ee,be,Se,we,ye,Te,se,de,J,B,ne,Z,K,W,X,ee,te,ae,oe]});let t=a;return t})();export{yt as ClientListComponent};
