import{a as se}from"./chunk-5NXGHONX.js";import"./chunk-USS2N3RB.js";import{c as ae,n as de}from"./chunk-FYZLZUO4.js";import{a as oe,b as le,c as re}from"./chunk-KAKXLQQZ.js";import"./chunk-Q4N2GC3M.js";import{r as ne}from"./chunk-GNT7AIZA.js";import"./chunk-27TGOTIH.js";import{M as te,c as H,ca as ie,e as L,g as J,h as K,m as Q,n as W,p as X,q as Y,w as Z,y as ee}from"./chunk-BJ65GJZA.js";import{Cb as I,Ib as S,Kb as x,Lc as j,Mc as B,Qa as l,Qc as $,Ra as y,Tc as G,Vb as A,Wb as i,Wc as R,Xb as g,Yb as N,Zb as V,db as _,dc as M,fc as D,jb as p,la as T,lb as F,ld as z,nb as C,nc as w,oc as P,od as U,qc as k,rc as O,ua as b,va as E,wb as t,xb as e,yb as u,yc as q}from"./chunk-W3KPMJ6O.js";import"./chunk-REZWHGN7.js";var me=r=>["/dashboard/business-dashboard/lotes/view-lote",r];function ce(r,m){r&1&&(t(0,"tr")(1,"td",49)(2,"div",50)(3,"span",51),i(4,"Cargando..."),e()(),t(5,"div",52),i(6,"Cargando lotes..."),e()()())}function pe(r,m){if(r&1&&(t(0,"tr")(1,"td",53),i(2),e()()),r&2){let o=x();l(2),N(" No se encontraron lotes (Total: ",o.lotes.length,") ")}}function ue(r,m){if(r&1){let o=I();t(0,"tr",39)(1,"th",54),i(2),e(),t(3,"td")(4,"div",27)(5,"div",55),u(6,"i",56),e(),t(7,"div")(8,"div",57)(9,"h6",58),i(10),e()(),t(11,"div",57)(12,"span",59),i(13),e()()()()(),t(14,"td")(15,"span",60),i(16),e()(),t(17,"td")(18,"span",61),i(19),w(20,"number"),e(),t(21,"small",62),i(22),e()(),t(23,"td"),i(24),w(25,"date"),e(),t(26,"td"),i(27),w(28,"date"),e(),t(29,"td")(30,"span",60),i(31),e()(),t(32,"td")(33,"div",63)(34,"a",64),u(35,"i",65),e(),t(36,"a",66),S("click",function(){let a=b(o).$implicit,d=x(),v=A(124);return E(d.edit(v,a))}),u(37,"i",67),e(),t(38,"a",68),S("click",function(){let a=b(o).$implicit,d=x();return E(d.toggleLoteStatus(a))}),u(39,"i"),e()()()()}if(r&2){let o=m.$implicit,n=x();l(2),g(o.id),l(8),g(o.galera),l(3),g(o.tipo),l(2),C(o.tipo==="Ponedoras"?"bg-info":"bg-primary"),l(),g(o.tipo),l(3),g(P(20,20,o.cantidad)),l(3),V("",(o._count==null?null:o._count.movAvesLote)||0," mov. | ",(o._count==null?null:o._count.tickets)||0," tickets"),l(2),g(k(25,22,o.fechaInicio,"dd/MM/yyyy","UTC")),l(3),g(o.fechaFin?k(28,26,o.fechaFin,"dd/MM/yyyy","UTC"):"N/A"),l(3),C(n.getEstadoBadgeClass(o.estado)),l(),g(o.estado),l(3),p("routerLink",D(30,me,o.id)),l(4),C(o.estado==="Activo"?"btn-warning":"btn-success"),p("title",o.estado==="Activo"?"Desactivar":"Activar"),l(),C(o.estado==="Activo"?"fe fe-pause-circle":"fe fe-play-circle")}}function ve(r,m){r&1&&(t(0,"div",94),i(1," El tipo es requerido "),e())}function ge(r,m){r&1&&(t(0,"div",94),i(1," La galera es requerida "),e())}function fe(r,m){r&1&&(t(0,"span"),i(1,"La cantidad es requerida"),e())}function he(r,m){r&1&&(t(0,"span"),i(1,"La cantidad debe ser mayor a 0"),e())}function _e(r,m){if(r&1&&(t(0,"div",94),_(1,fe,2,0,"span",41)(2,he,2,0,"span",41),e()),r&2){let o,n,a=x(2);l(),p("ngIf",(o=a.editForm.get("cantidad"))==null||o.errors==null?null:o.errors.required),l(),p("ngIf",(n=a.editForm.get("cantidad"))==null||n.errors==null?null:n.errors.min)}}function xe(r,m){r&1&&(t(0,"div",94),i(1," La fecha de inicio es requerida "),e())}function be(r,m){r&1&&u(0,"span",95)}function Ee(r,m){if(r&1){let o=I();t(0,"form",69),S("ngSubmit",function(){b(o);let a=x();return E(a.onUpdateLote())}),t(1,"div",70)(2,"h5",71),i(3,"Editar Lote"),e(),t(4,"button",72),S("click",function(){let a=b(o).$implicit;return E(a.dismiss("Cross click"))}),e()(),t(5,"div",73)(6,"div",2)(7,"div",74)(8,"div",75)(9,"label",76),i(10,"Tipo *"),e(),t(11,"ng-select",77)(12,"ng-option",78),i(13,"Ponedoras"),e(),t(14,"ng-option",79),i(15,"Engorde"),e()(),_(16,ve,2,0,"div",80),e()(),t(17,"div",74)(18,"div",75)(19,"label",76),i(20,"Galera *"),e(),u(21,"input",81),_(22,ge,2,0,"div",80),e()(),t(23,"div",74)(24,"div",75)(25,"label",76),i(26,"Cantidad *"),e(),u(27,"input",82),_(28,_e,3,2,"div",80),e()(),t(29,"div",74)(30,"div",75)(31,"label",76),i(32,"Estado *"),e(),t(33,"ng-select",83)(34,"ng-option",84),i(35,"Activo"),e(),t(36,"ng-option",85),i(37,"Inactivo"),e(),t(38,"ng-option",86),i(39,"Desalojado"),e()()()(),t(40,"div",74)(41,"div",75)(42,"label",76),i(43,"Fecha Inicio *"),e(),u(44,"input",87),_(45,xe,2,0,"div",80),e()(),t(46,"div",74)(47,"div",75)(48,"label",76),i(49,"Fecha Fin"),e(),u(50,"input",88),e()(),t(51,"div",22)(52,"div",75)(53,"label",76),i(54,"Observaciones"),e(),u(55,"textarea",89),e()()()(),t(56,"div",90)(57,"button",91),S("click",function(){let a=b(o).$implicit;return E(a.dismiss("cancel"))}),i(58,"Cancelar"),e(),t(59,"button",92),_(60,be,1,0,"span",93),i(61," Actualizar "),e()()()}if(r&2){let o,n,a,d,v,h,c,f,s=x();p("formGroup",s.editForm),l(11),F("is-invalid",((o=s.editForm.get("tipo"))==null?null:o.invalid)&&((o=s.editForm.get("tipo"))==null?null:o.touched)),l(5),p("ngIf",((n=s.editForm.get("tipo"))==null?null:n.invalid)&&((n=s.editForm.get("tipo"))==null?null:n.touched)),l(5),F("is-invalid",((a=s.editForm.get("galera"))==null?null:a.invalid)&&((a=s.editForm.get("galera"))==null?null:a.touched)),l(),p("ngIf",((d=s.editForm.get("galera"))==null?null:d.invalid)&&((d=s.editForm.get("galera"))==null?null:d.touched)),l(5),F("is-invalid",((v=s.editForm.get("cantidad"))==null?null:v.invalid)&&((v=s.editForm.get("cantidad"))==null?null:v.touched)),l(),p("ngIf",((h=s.editForm.get("cantidad"))==null?null:h.invalid)&&((h=s.editForm.get("cantidad"))==null?null:h.touched)),l(16),F("is-invalid",((c=s.editForm.get("fechaInicio"))==null?null:c.invalid)&&((c=s.editForm.get("fechaInicio"))==null?null:c.touched)),l(),p("ngIf",((f=s.editForm.get("fechaInicio"))==null?null:f.invalid)&&((f=s.editForm.get("fechaInicio"))==null?null:f.touched)),l(14),p("disabled",s.loading),l(),p("ngIf",s.loading)}}var Oe=(()=>{let m=class m{constructor(n,a,d,v,h){this.modalService=n,this.lotesService=a,this.fb=d,this.toastr=v,this.cdr=h,this.lotes=[],this.loading=!1,this.selectedLote=null,this.totalLotes=0,this.lotesActivos=0,this.lotesPonedoras=0,this.lotesEngorde=0,this.editForm=this.fb.group({tipo:["",L.required],galera:["",L.required],cantidad:["",[L.required,L.min(1)]],fechaInicio:["",L.required],fechaFin:[""],estado:["Activo"],observaciones:[""]})}applyFilter(n){let a=n.target.value.toLowerCase()}toggleLoteStatus(n){let a=n.estado==="Activo",d=a?"Inactivo":"Activo",v=a?"desactivar":"activar";if(confirm(`\xBFEst\xE1 seguro de que desea ${v} este lote?`)){let h={estado:d};this.lotesService.updateLote(n.id,h).subscribe({next:()=>{this.toastr.success(`Lote ${v}do exitosamente`,"\xC9xito",{timeOut:3e3,positionClass:"toast-top-right"}),this.loadLotes(),this.cdr.detectChanges()},error:c=>{console.error("Error response:",c);let f="Error desconocido";c.error?.message?f=c.error.message:c.error?.error?f=c.error.error:c.message?f=c.message:typeof c.error=="string"&&(f=c.error),this.toastr.error(`Error al ${v} el lote: ${f}`,"Error",{timeOut:3e3,positionClass:"toast-top-right"}),this.cdr.detectChanges()}})}}edit(n,a){this.selectedLote=a,this.editForm.patchValue({tipo:a.tipo,galera:a.galera,cantidad:a.cantidad,fechaInicio:this.formatDateForInput(a.fechaInicio),fechaFin:this.formatDateForInput(a.fechaFin||""),estado:a.estado,observaciones:a.observaciones}),this.modalService.open(n,{windowClass:"modalCusSty modal-lg"})}onUpdateLote(){if(this.editForm.valid&&this.selectedLote){this.loading=!0;let n=this.editForm.value;this.lotesService.updateLote(this.selectedLote.id,n).subscribe({next:a=>{this.toastr.success("Lote actualizado exitosamente","\xC9xito",{timeOut:3e3,positionClass:"toast-top-right"}),this.loadLotes(),this.modalService.dismissAll(),this.loading=!1,this.cdr.detectChanges()},error:a=>{this.toastr.error("Error al actualizar el lote: "+(a.error?.message||"Error desconocido"),"Error",{timeOut:3e3,positionClass:"toast-top-right"}),this.loading=!1,this.cdr.detectChanges()}})}else this.toastr.warning("Por favor, complete todos los campos requeridos","Advertencia",{timeOut:3e3,positionClass:"toast-top-right"}),this.markFormGroupTouched()}markFormGroupTouched(){Object.keys(this.editForm.controls).forEach(n=>{this.editForm.get(n)?.markAsTouched()})}open(n){this.modalService.open(n,{windowClass:"modalCusSty",size:"lg"})}ngOnInit(){this.loadLotes()}loadLotes(){this.loading=!0,this.lotesService.getLotes().subscribe({next:n=>{n?.data?.data?this.lotes=n.data.data:n?.data?.items?this.lotes=n.data.items:n?.data&&Array.isArray(n.data)?this.lotes=n.data:Array.isArray(n)?this.lotes=n:this.lotes=[],this.calculateStats(),this.loading=!1,this.cdr.detectChanges()},error:n=>{this.lotes=[],this.loading=!1,this.cdr.detectChanges()}})}calculateStats(){this.totalLotes=this.lotes.length,this.lotesActivos=this.lotes.filter(n=>n.estado==="Activo").length,this.lotesPonedoras=this.lotes.filter(n=>n.tipo==="Ponedoras").length,this.lotesEngorde=this.lotes.filter(n=>n.tipo==="Engorde").length}getEstadoBadgeClass(n){switch(n){case"Activo":return"bg-success";case"Inactivo":return"bg-warning";case"Desalojado":return"bg-danger";default:return"bg-secondary"}}trackByLoteId(n,a){return a.id}formatDateForInput(n){if(!n)return"";if(/^\d{4}-\d{2}-\d{2}$/.test(n))return n;if(n.includes("T"))return n.split("T")[0];let a=new Date(n);return isNaN(a.getTime())?"":a.toISOString().split("T")[0]}};m.\u0275fac=function(a){return new(a||m)(y(te),y(se),y(Z),y(ne),y(q))},m.\u0275cmp=T({type:m,selectors:[["app-lote-list"]],standalone:!0,features:[M],decls:125,vars:14,consts:[["editContent",""],[3,"title","title2","class1","path"],[1,"row"],[1,"col-xl-3","col-lg-6","col-md-6"],[1,"card","custom-card"],[1,"card-body"],[1,"col-7"],[1,"mt-0","text-start"],[1,"fw-medium"],[1,"mb-0","mt-1","text-success"],[1,"col-5"],[1,"icon1","bg-success-transparent","my-auto","float-end"],[1,"las","la-layer-group"],[1,"mb-0","mt-1","text-primary"],[1,"icon1","bg-primary-transparent","my-auto","float-end"],[1,"las","la-check-circle"],[1,"mb-0","mt-1","text-secondary"],[1,"icon1","bg-secondary-transparent","my-auto","float-end"],[1,"las","la-egg"],[1,"mb-0","mt-1","text-danger"],[1,"icon1","bg-danger-transparent","my-auto","float-end"],[1,"las","la-drumstick-bite"],[1,"col-md-12"],[1,"card-header"],[1,"card-title"],[1,"row","mb-2","gap-2","gap-lg-0"],[1,"col-lg-6"],[1,"d-flex","align-items-center"],[1,"d-flex","ms-2","mx-2"],[1,"form-group","mb-0"],["name","quantity","placeholder","10",1,"form-control","wd-150","p-0"],["value","10","selected",""],["value","25"],["value","50"],["value","100"],[1,"float-end"],["type","text","placeholder","Buscar",1,"form-control",3,"keyup"],[1,"table-responsive"],[1,"table","mb-0","text-nowrap","text-md-nowrap","table-bordered","border"],[1,"border-bottom"],["scope","col"],[4,"ngIf"],["class","border-bottom",4,"ngFor","ngForOf","ngForTrackBy"],[1,"mt-4"],[1,"pagination","justify-content-end","mb-0"],[1,"page-item","disabled"],["href","javascript:void(0);",1,"page-link"],[1,"page-item","active"],[1,"page-item"],["colspan","8",1,"text-center","py-4"],["role","status",1,"spinner-border","text-primary"],[1,"visually-hidden"],[1,"mt-2"],["colspan","8",1,"text-center","py-4","text-muted"],["scope","row"],[1,"avatar","me-2","avatar-rounded","bg-primary-transparent"],[1,"fe","fe-layers","fs-16"],[1,"lh-1"],[1,"mb-1"],[1,"fs-12","text-muted"],[1,"badge"],[1,"fw-semibold"],[1,"d-block","text-muted"],[1,"d-flex","gap-2"],["data-bs-toggle","tooltip","title","Ver Lote",1,"btn","btn-primary","btn-icon",3,"routerLink"],[1,"fe","fe-eye"],["data-bs-toggle","tooltip","title","Editar",1,"btn","btn-success","btn-icon",3,"click"],[1,"fe","fe-edit-2"],["data-bs-toggle","tooltip",1,"btn","btn-icon",3,"click","title"],[3,"ngSubmit","formGroup"],[1,"modal-header"],[1,"modal-title"],["type","button","data-bs-dismiss","modal","aria-label","Close",1,"btn-close",3,"click"],[1,"modal-body"],[1,"col-md-6"],[1,"form-group"],[1,"form-label"],["formControlName","tipo","placeholder","Seleccione un tipo",1,"form-control","p-0"],["value","Ponedoras"],["value","Engorde"],["class","invalid-feedback",4,"ngIf"],["formControlName","galera","placeholder","Nombre de la galera",1,"form-control"],["formControlName","cantidad","type","number","placeholder","Cantidad de aves",1,"form-control"],["formControlName","estado","placeholder","Seleccione el estado",1,"form-control","p-0"],["value","Activo"],["value","Inactivo"],["value","Desalojado"],["formControlName","fechaInicio","type","date",1,"form-control"],["formControlName","fechaFin","type","date",1,"form-control"],["formControlName","observaciones","rows","3","placeholder","Observaciones adicionales",1,"form-control"],[1,"modal-footer"],["type","button",1,"btn","btn-outline-primary",3,"click"],["type","submit",1,"btn","btn-success",3,"disabled"],["class","spinner-border spinner-border-sm me-2","role","status",4,"ngIf"],[1,"invalid-feedback"],["role","status",1,"spinner-border","spinner-border-sm","me-2"]],template:function(a,d){if(a&1){let v=I();u(0,"app-hr-dashboard-page-header",1),t(1,"div",2)(2,"div",3)(3,"div",4)(4,"div",5)(5,"div",2)(6,"div",6)(7,"div",7)(8,"span",8),i(9,"Total Lotes"),e(),t(10,"h3",9),i(11),e()()(),t(12,"div",10)(13,"div",11),u(14,"i",12),e()()()()()(),t(15,"div",3)(16,"div",4)(17,"div",5)(18,"div",2)(19,"div",6)(20,"div",7)(21,"span",8),i(22,"Lotes Activos"),e(),t(23,"h3",13),i(24),e()()(),t(25,"div",10)(26,"div",14),u(27,"i",15),e()()()()()(),t(28,"div",3)(29,"div",4)(30,"div",5)(31,"div",2)(32,"div",6)(33,"div",7)(34,"span",8),i(35,"Ponedoras"),e(),t(36,"h3",16),i(37),e()()(),t(38,"div",10)(39,"div",17),u(40,"i",18),e()()()()()(),t(41,"div",3)(42,"div",4)(43,"div",5)(44,"div",2)(45,"div",6)(46,"div",7)(47,"span",8),i(48,"Engorde"),e(),t(49,"h3",19),i(50),e()()(),t(51,"div",10)(52,"div",20),u(53,"i",21),e()()()()()()(),t(54,"div",2)(55,"div",22)(56,"div",4)(57,"div",23)(58,"h3",24),i(59,"Lista de lotes"),e()(),t(60,"div",5)(61,"div",25)(62,"div",26)(63,"div",27)(64,"span"),i(65,"Mostrar"),e(),t(66,"div",28)(67,"div",29)(68,"ng-select",30)(69,"ng-option",31),i(70,"10"),e(),t(71,"ng-option",32),i(72,"25"),e(),t(73,"ng-option",33),i(74,"50"),e(),t(75,"ng-option",34),i(76,"100"),e()()()(),t(77,"span"),i(78,"registros"),e()()(),t(79,"div",26)(80,"div",35)(81,"input",36),S("keyup",function(c){return b(v),E(d.applyFilter(c))}),e()()()(),t(82,"div",37)(83,"table",38)(84,"thead")(85,"tr",39)(86,"th",40),i(87,"No"),e(),t(88,"th",40),i(89,"Galera"),e(),t(90,"th",40),i(91,"Tipo"),e(),t(92,"th",40),i(93,"Cantidad"),e(),t(94,"th",40),i(95,"Fecha Inicio"),e(),t(96,"th",40),i(97,"Fecha Fin"),e(),t(98,"th",40),i(99,"Estado"),e(),t(100,"th",40),i(101,"Acciones"),e()()(),t(102,"tbody"),_(103,ce,7,0,"tr",41)(104,pe,3,1,"tr",41)(105,ue,40,32,"tr",42),e()()(),t(106,"nav",43)(107,"ul",44)(108,"li",45)(109,"a",46),i(110,"Prev"),e()(),t(111,"li",47)(112,"a",46),i(113,"1"),e()(),t(114,"li",48)(115,"a",46),i(116,"2"),e()(),t(117,"li",48)(118,"a",46),i(119,"3"),e()(),t(120,"li",48)(121,"a",46),i(122,"Next"),e()()()()()()()(),_(123,Ee,62,15,"ng-template",null,0,O)}a&2&&(C("btn btn-primary"),p("title","Lotes")("title2","Agregar Nuevo Lote")("class1","")("path","/dashboard/business-dashboard/lotes/new-lote"),l(11),g(d.totalLotes),l(13),g(d.lotesActivos),l(13),g(d.lotesPonedoras),l(13),g(d.lotesEngorde),l(53),p("ngIf",d.loading),l(),p("ngIf",!d.loading&&d.lotes.length===0),l(),p("ngForOf",d.lotes)("ngForTrackBy",d.trackByLoteId))},dependencies:[R,j,B,G,$,de,ae,re,le,oe,U,z,ee,Q,H,W,J,K,X,Y,ie]});let r=m;return r})();export{Oe as LoteListComponent};
