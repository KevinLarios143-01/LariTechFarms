import{a as re}from"./chunk-XSCBZSJQ.js";import{a as le}from"./chunk-5NXGHONX.js";import{a as oe}from"./chunk-RZXLPCDT.js";import"./chunk-USS2N3RB.js";import{a as ee,n as ae}from"./chunk-FYZLZUO4.js";import{a as te,b as ie,c as ne}from"./chunk-KAKXLQQZ.js";import"./chunk-Q4N2GC3M.js";import{r as Z}from"./chunk-GNT7AIZA.js";import"./chunk-27TGOTIH.js";import{c as $,e as m,g as H,h as Q,m as U,n as J,p as K,q as W,w as X,y as Y}from"./chunk-BJ65GJZA.js";import{Ib as I,Kb as P,Mc as O,Qa as r,Qc as q,Ra as u,Tc as z,Wb as a,Wc as j,Xb as h,Yb as E,_b as A,db as p,dc as L,id as G,jb as s,kd as B,la as y,nb as N,nc as T,ob as w,od as R,pc as V,rb as D,ub as _,vb as x,wb as t,xb as e,yb as S,yc as M}from"./chunk-W3KPMJ6O.js";import"./chunk-REZWHGN7.js";var F=(o,c)=>c.id;function de(o,c){if(o&1&&(t(0,"div",3)(1,"div",4)(2,"div",26)(3,"h5",27),a(4,"Informaci\xF3n de la Venta"),e()(),t(5,"div",5)(6,"div",28)(7,"table",29)(8,"tbody")(9,"tr")(10,"td",30),a(11,"ID Venta:"),e(),t(12,"td"),a(13),e()(),t(14,"tr")(15,"td",30),a(16,"Cliente:"),e(),t(17,"td"),a(18),e()(),t(19,"tr")(20,"td",30),a(21,"Fecha:"),e(),t(22,"td"),a(23),T(24,"date"),e()(),t(25,"tr")(26,"td",30),a(27,"Total:"),e(),t(28,"td",31),a(29),T(30,"number"),e()(),t(31,"tr")(32,"td",30),a(33,"Estado:"),e(),t(34,"td")(35,"span"),a(36),e()()(),t(37,"tr")(38,"td",30),a(39,"Observaciones:"),e(),t(40,"td"),a(41),e()(),t(42,"tr")(43,"td",30),a(44,"Usuario:"),e(),t(45,"td"),a(46),e()()()()()()()()),o&2){let d=P();r(13),h(d.selectedVenta.id),r(5),h((d.selectedVenta.cliente==null?null:d.selectedVenta.cliente.nombre)||"#"+d.selectedVenta.idCliente),r(5),h(V(24,10,d.selectedVenta.fecha,"dd/MM/yyyy")),r(6),E("Q",V(30,13,d.selectedVenta.total,"1.2-2"),""),r(6),w("badge bg-",d.selectedVenta.estado==="Completada"?"success":d.selectedVenta.estado==="Pendiente"?"warning":"danger",""),r(),h(d.selectedVenta.estado),r(5),h(d.selectedVenta.observaciones||"N/A"),r(5),h((d.selectedVenta.usuario==null?null:d.selectedVenta.usuario.nombre)||"N/A")}}function ce(o,c){if(o&1&&(t(0,"ng-option",11),a(1),T(2,"number"),e()),o&2){let d=c.$implicit;s("value",d.id),r(),A(" Venta #",d.id," - Cliente #",d.idCliente," - Q",V(2,4,d.total,"1.2-2")," ")}}function se(o,c){o&1&&(t(0,"div",32)(1,"small"),a(2,"Debe seleccionar una venta"),e()())}function me(o,c){if(o&1&&(t(0,"ng-option",11),a(1),e()),o&2){let d=c.$implicit;s("value",d.id),r(),E(" ",d.galera||"Lote #"+d.id," ")}}function ue(o,c){o&1&&(t(0,"div",32)(1,"small"),a(2,"Debe seleccionar un lote"),e()())}function pe(o,c){if(o&1&&(t(0,"ng-option",11),a(1),e()),o&2){let d=c.$implicit;s("value",d.id),r(),E(" ",d.nombre," ")}}function ve(o,c){o&1&&(t(0,"div",32)(1,"small"),a(2,"Debe seleccionar un producto"),e()())}function he(o,c){o&1&&(t(0,"div",32)(1,"small"),a(2,"La cantidad es requerida"),e()())}function fe(o,c){o&1&&(t(0,"div",32)(1,"small"),a(2,"La fecha es requerida"),e()())}function ge(o,c){o&1&&(t(0,"div",32)(1,"small"),a(2,"El estado es requerido"),e()())}function be(o,c){o&1&&S(0,"span",33)}var Ae=(()=>{let c=class c{constructor(i,n,l,v,f,g,b,k){this.fb=i,this.ticketService=n,this.ventaService=l,this.lotesService=v,this.router=f,this.route=g,this.toastr=b,this.cdr=k,this.loading=!1,this.isEditing=!1,this.ticketId=null,this.ventas=[],this.lotes=[],this.productos=[],this.selectedVentaData=null,this.estadosTicket=["Pendiente","Autorizado","Despachado","Cancelado"],this.ticketForm=this.fb.group({idVenta:["",[m.required,m.min(1)]],idLote:["",[m.required,m.min(1)]],idProducto:["",[m.required,m.min(1)]],fecha:["",m.required],cantidad:["",[m.required,m.min(1)]],estado:["Pendiente"],codigoAutorizacion:[""]})}ngOnInit(){let i=new Date().toISOString().split("T")[0];this.ticketForm.patchValue({fecha:i}),this.route.params.subscribe(n=>{n.id&&(this.isEditing=!0,this.ticketId=+n.id,this.loadTicket())}),this.route.queryParams.subscribe(n=>{n.ventaId&&this.ticketForm.patchValue({idVenta:+n.ventaId})}),this.loadVentas(),this.loadLotes(),this.loadProductos(),this.ticketForm.get("idVenta")?.valueChanges.subscribe(n=>{n&&this.onVentaSelected(n)})}loadVentas(){this.ventaService.getVentas().subscribe({next:i=>{let n=i?.data?.data||i?.data||i||[];this.ventas=Array.isArray(n)?n:[]},error:i=>{console.error("Error loading ventas:",i),this.ventas=[]}})}loadLotes(){this.lotesService.getLotes().subscribe({next:i=>{i?.data?.data?this.lotes=i.data.data:i?.data?.items?this.lotes=i.data.items:i?.data&&Array.isArray(i.data)?this.lotes=i.data:Array.isArray(i)?this.lotes=i:this.lotes=[]},error:i=>{console.error("Error loading lotes:",i),this.lotes=[]}})}loadTicket(){this.ticketId&&(this.loading=!0,this.ticketService.getTicketById(this.ticketId).subscribe({next:i=>{let n=i.data;this.ticketForm.patchValue({idVenta:n.idVenta,idLote:n.idLote,idProducto:n.idProducto,fecha:this.formatDateForInput(n.fecha),cantidad:n.cantidad,estado:n.estado,codigoAutorizacion:n.codigoAutorizacion||""}),this.loading=!1,this.cdr.detectChanges()},error:i=>{console.error("Error al cargar ticket:",i),this.toastr.error("Error al cargar el ticket","Error",{timeOut:3e3,positionClass:"toast-top-right"}),this.loading=!1,this.cdr.detectChanges()}}))}onSubmit(){if(this.ticketForm.valid){this.loading=!0;let i=this.ticketForm.value;this.isEditing&&this.ticketId?this.ticketService.updateTicket(this.ticketId,i).subscribe({next:()=>{this.toastr.success("Ticket actualizado exitosamente","\xC9xito",{timeOut:3e3,positionClass:"toast-top-right"}),this.router.navigate(["/dashboard/business-dashboard/ticket-list"]),this.loading=!1,this.cdr.detectChanges()},error:n=>{console.error("Error al actualizar ticket:",n),this.toastr.error("Error al actualizar el ticket","Error",{timeOut:3e3,positionClass:"toast-top-right"}),this.loading=!1,this.cdr.detectChanges()}}):this.ticketService.createTicket(i).subscribe({next:()=>{this.toastr.success("Ticket creado exitosamente","\xC9xito",{timeOut:3e3,positionClass:"toast-top-right"}),this.router.navigate(["/dashboard/business-dashboard/ticket-list"]),this.loading=!1,this.cdr.detectChanges()},error:n=>{console.error("Error al crear ticket:",n),this.toastr.error("Error al crear el ticket","Error",{timeOut:3e3,positionClass:"toast-top-right"}),this.loading=!1,this.cdr.detectChanges()}})}else this.markFormGroupTouched(),this.toastr.warning("Por favor, complete todos los campos requeridos","Advertencia",{timeOut:3e3,positionClass:"toast-top-right"})}onCancel(){this.router.navigate(["/dashboard/business-dashboard/ticket-list"])}loadProductos(){this.productos=[{id:1,nombre:"Huevo Grande",tamanio:"L"},{id:2,nombre:"Huevo Mediano",tamanio:"M"},{id:3,nombre:"Huevo Peque\xF1o",tamanio:"S"}]}formatDateForInput(i){if(!i)return"";if(/^\d{4}-\d{2}-\d{2}$/.test(i))return i;if(i.includes("T"))return i.split("T")[0];let n=new Date(i);return isNaN(n.getTime())?"":n.toISOString().split("T")[0]}onVentaSelected(i){this.ventaService.getVentaById(i).subscribe({next:n=>{this.selectedVentaData=n.data},error:n=>{console.error("Error loading venta details:",n),this.selectedVentaData=null}})}get selectedVenta(){return this.selectedVentaData}markFormGroupTouched(){Object.keys(this.ticketForm.controls).forEach(i=>{this.ticketForm.get(i)?.markAsTouched()})}};c.\u0275fac=function(n){return new(n||c)(u(X),u(oe),u(re),u(le),u(B),u(G),u(Z),u(M))},c.\u0275cmp=y({type:c,selectors:[["app-new-ticket"]],standalone:!0,features:[L],decls:72,vars:16,consts:[[3,"title"],[3,"ngSubmit","formGroup"],[1,"row"],[1,"col-xl-4","col-md-4","col-lg-4"],[1,"card"],[1,"card-body"],[1,"mb-5","fw-semibold"],[1,"col-md-6"],[1,"form-group"],[1,"form-label"],["name","idVenta","placeholder","Seleccione una venta","formControlName","idVenta","bindLabel","displayText","bindValue","id",1,"form-control","p-0","custom-select"],[3,"value"],["class","text-danger",4,"ngIf"],["name","idLote","placeholder","Seleccione un lote","formControlName","idLote","bindLabel","galera","bindValue","id",1,"form-control","p-0","custom-select"],["name","idProducto","placeholder","Seleccione un producto","formControlName","idProducto","bindLabel","nombre","bindValue","id",1,"form-control","p-0","custom-select"],["type","number","placeholder","Ingrese la cantidad","formControlName","cantidad",1,"form-control"],["type","date","formControlName","fecha",1,"form-control"],["name","estado","placeholder","Seleccione el estado","formControlName","estado",1,"form-control","p-0","custom-select"],["value","Pendiente"],["value","Completado"],["value","Cancelado"],["type","text","placeholder","Ingrese el c\xF3digo de autorizaci\xF3n (opcional)","formControlName","codigoAutorizacion",1,"form-control"],[1,"card-footer","text-end"],["type","button",1,"btn","btn-danger","btn-lg","me-2",3,"click","disabled"],["type","submit",1,"btn","btn-success","btn-lg",3,"disabled"],["class","spinner-border spinner-border-sm me-2",4,"ngIf"],[1,"card-header"],[1,"card-title","mb-0"],[1,"table-responsive"],[1,"table","table-borderless"],[1,"fw-semibold"],[1,"text-success","fw-bold"],[1,"text-danger"],[1,"spinner-border","spinner-border-sm","me-2"]],template:function(n,l){if(n&1&&(S(0,"app-page-header",0),t(1,"form",1),I("ngSubmit",function(){return l.onSubmit()}),t(2,"div",2),p(3,de,47,16,"div",3),t(4,"div")(5,"div",4)(6,"div",5)(7,"h4",6),a(8,"Detalles del Ticket:"),e(),t(9,"div",2)(10,"div",7)(11,"div",8)(12,"label",9),a(13,"Seleccionar Venta *"),e(),t(14,"ng-select",10),_(15,ce,3,7,"ng-option",11,F),e(),p(17,se,3,0,"div",12),e()(),t(18,"div",7)(19,"div",8)(20,"label",9),a(21,"Lote *"),e(),t(22,"ng-select",13),_(23,me,2,2,"ng-option",11,F),e(),p(25,ue,3,0,"div",12),e()()(),t(26,"div",2)(27,"div",7)(28,"div",8)(29,"label",9),a(30,"Producto *"),e(),t(31,"ng-select",14),_(32,pe,2,2,"ng-option",11,F),e(),p(34,ve,3,0,"div",12),e()(),t(35,"div",7)(36,"div",8)(37,"label",9),a(38,"Cantidad *"),e(),S(39,"input",15),p(40,he,3,0,"div",12),e()()(),t(41,"div",2)(42,"div",7)(43,"div",8)(44,"label",9),a(45,"Fecha *"),e(),S(46,"input",16),p(47,fe,3,0,"div",12),e()()(),t(48,"div",2)(49,"div",7)(50,"div",8)(51,"label",9),a(52,"Estado *"),e(),t(53,"ng-select",17)(54,"ng-option",18),a(55,"Pendiente"),e(),t(56,"ng-option",19),a(57,"Completado"),e(),t(58,"ng-option",20),a(59,"Cancelado"),e()(),p(60,ge,3,0,"div",12),e()(),t(61,"div",7)(62,"div",8)(63,"label",9),a(64,"C\xF3digo de Autorizaci\xF3n"),e(),S(65,"input",21),e()()()(),t(66,"div",22)(67,"button",23),I("click",function(){return l.onCancel()}),a(68,"Cerrar"),e(),t(69,"button",24),p(70,be,1,0,"span",25),a(71),e()()()()()()),n&2){let v,f,g,b,k,C;s("title","Nuevo Ticket"),r(),s("formGroup",l.ticketForm),r(2),D(l.selectedVenta?3:-1),r(),N(l.selectedVenta?"col-xl-8 col-md-8 col-lg-8":"col-xl-12 col-md-12 col-lg-12"),r(11),x(l.ventas),r(2),s("ngIf",((v=l.ticketForm.get("idVenta"))==null?null:v.invalid)&&((v=l.ticketForm.get("idVenta"))==null?null:v.touched)),r(6),x(l.lotes),r(2),s("ngIf",((f=l.ticketForm.get("idLote"))==null?null:f.invalid)&&((f=l.ticketForm.get("idLote"))==null?null:f.touched)),r(7),x(l.productos),r(2),s("ngIf",((g=l.ticketForm.get("idProducto"))==null?null:g.invalid)&&((g=l.ticketForm.get("idProducto"))==null?null:g.touched)),r(6),s("ngIf",((b=l.ticketForm.get("cantidad"))==null?null:b.invalid)&&((b=l.ticketForm.get("cantidad"))==null?null:b.touched)),r(7),s("ngIf",((k=l.ticketForm.get("fecha"))==null?null:k.invalid)&&((k=l.ticketForm.get("fecha"))==null?null:k.touched)),r(13),s("ngIf",((C=l.ticketForm.get("estado"))==null?null:C.invalid)&&((C=l.ticketForm.get("estado"))==null?null:C.touched)),r(7),s("disabled",l.loading),r(2),s("disabled",l.loading),r(),s("ngIf",l.loading),r(),E(" ",l.loading?"Guardando...":"Guardar"," ")}},dependencies:[j,O,z,q,ae,ee,ne,ie,te,R,Y,U,$,J,H,Q,K,W]});let o=c;return o})();export{Ae as NewTicketComponent};
