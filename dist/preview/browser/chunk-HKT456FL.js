import{a as he}from"./chunk-RV2TP37N.js";import{a as ve}from"./chunk-5G2KFST2.js";import"./chunk-IORNA22M.js";import{c as se,n as pe}from"./chunk-L3BSSDS5.js";import{a as ce,b as me,c as ue}from"./chunk-S5Y45Y7X.js";import"./chunk-TZ522SJ7.js";import{r as de}from"./chunk-P6RHK3TE.js";import"./chunk-LAI4YRFV.js";import{N as ee,O as te,P as ie,Q as oe,R as re,T as ne,U as ae,c as $,ca as le,e as C,g as z,h as W,m as Z,n as J,p as K,q as Q,u as U,w as X,y as Y}from"./chunk-I6FKYEZO.js";import{$b as B,Cb as w,Ib as L,Kb as v,Qa as l,Ra as u,Vb as k,Wb as a,Wc as A,Xb as _,Yb as x,_b as M,ac as V,bc as D,db as f,dc as R,id as G,jb as c,kd as O,la as H,lb as I,ld as P,od as q,rb as b,tb as T,ua as S,ub as F,va as E,vb as y,wb as t,xb as o,yb as g,yc as j}from"./chunk-W3KPMJ6O.js";import"./chunk-REZWHGN7.js";var fe=(n,s)=>s.id;function ge(n,s){n&1&&(t(0,"div",35)(1,"div",37)(2,"span",38),a(3,"Cargando..."),o()()())}function _e(n,s){if(n&1&&(t(0,"ng-option",46),a(1),o()),n&2){let r=s.$implicit;c("value",r.id),l(),M(" ",r.galera," - ",r.tipo," (",r.cantidad," aves) ")}}function be(n,s){if(n&1&&(t(0,"div",47),a(1),o()),n&2){let r=v(3);l(),x(" ",r.getFieldError("idLote")," ")}}function xe(n,s){if(n&1&&(t(0,"div",49),a(1),o()),n&2){let r=v(3);l(),x(" ",r.getFieldError("fecha")," ")}}function Ce(n,s){if(n&1&&(t(0,"div",49),a(1),o()),n&2){let r=v(3);l(),x(" ",r.getFieldError("cantidadHuevos")," ")}}function Se(n,s){if(n&1&&(t(0,"ng-option",46),a(1),o()),n&2){let r=s.$implicit;c("value",r),l(),_(r)}}function Ee(n,s){if(n&1){let r=w();t(0,"form",39),L("ngSubmit",function(){S(r);let e=v(2);return E(e.onSubmit())}),t(1,"h4",40),a(2,"Informaci\xF3n del Control"),o(),t(3,"div",41)(4,"div",2)(5,"div",42)(6,"label",43),a(7,"Lote *"),o()(),t(8,"div",44)(9,"ng-select",45),F(10,_e,2,4,"ng-option",46,fe),o(),f(12,be,2,1,"div",47),o()()(),t(13,"div",41)(14,"div",2)(15,"div",42)(16,"label",43),a(17,"Fecha *"),o()(),t(18,"div",44),g(19,"input",48),f(20,xe,2,1,"div",49),o()()(),t(21,"div",41)(22,"div",2)(23,"div",42)(24,"label",43),a(25,"Cantidad de Huevos *"),o()(),t(26,"div",44),g(27,"input",50),f(28,Ce,2,1,"div",49),o()()(),t(29,"div",41)(30,"div",2)(31,"div",42)(32,"label",43),a(33,"Calidad"),o()(),t(34,"div",44)(35,"ng-select",51),F(36,Se,2,2,"ng-option",46,T),o()()()()()}if(n&2){let r=v(2);c("formGroup",r.controlForm),l(9),I("is-invalid",r.isFieldInvalid("idLote")),c("disabled",r.isEditMode),l(),y(r.lotes),l(2),b(r.isFieldInvalid("idLote")?12:-1),l(7),I("is-invalid",r.isFieldInvalid("fecha")),l(),b(r.isFieldInvalid("fecha")?20:-1),l(7),I("is-invalid",r.isFieldInvalid("cantidadHuevos")),l(),b(r.isFieldInvalid("cantidadHuevos")?28:-1),l(7),c("clearable",!0),l(),y(r.calidades)}}function Ie(n,s){if(n&1&&(t(0,"div",33)(1,"div",34),f(2,ge,4,0,"div",35)(3,Ee,38,12,"form",36),o()()),n&2){let r=v();l(2),b(r.isLoading?2:3)}}var Ge=(()=>{let s=class s{constructor(i,e,d,p,h,m,N){this.fb=i,this.huevosService=e,this.lotesService=d,this.route=p,this.router=h,this.cdr=m,this.toastr=N,this.lotes=[],this.calidades=["Excelente","Buena","Regular","Mala"],this.isLoading=!1,this.isEditMode=!1,this.controlId=null,this.active=1,this.controlForm=this.fb.group({idLote:["",C.required],fecha:["",C.required],cantidadHuevos:["",[C.required,C.min(1)]],calidad:[""]})}ngOnInit(){this.loadLotes(),this.checkEditMode()}checkEditMode(){let i=this.route.snapshot.paramMap.get("id");if(i)this.isEditMode=!0,this.controlId=parseInt(i),this.loadControl();else{let e=new Date().toISOString().split("T")[0];this.controlForm.patchValue({fecha:e})}}loadLotes(){this.lotesService.getLotes().subscribe({next:i=>{this.lotes=i.data.data.filter(e=>e.tipo==="Ponedoras"&&e.estado==="Activo"),this.cdr.detectChanges()},error:i=>{this.toastr.error("Error al cargar lotes","Error",{progressBar:!0,closeButton:!0})}})}loadControl(){this.controlId&&(this.isLoading=!0,this.huevosService.getControlById(this.controlId).subscribe({next:i=>{let e=i.data;this.controlForm.patchValue({idLote:e.idLote,fecha:this.formatDateForInput(e.fecha),cantidadHuevos:e.cantidadHuevos,calidad:e.calidad||""}),this.isLoading=!1,this.cdr.detectChanges()},error:i=>{this.toastr.error("Error al cargar control","Error",{progressBar:!0,closeButton:!0}),this.isLoading=!1,this.router.navigate(["../list"],{relativeTo:this.route})}}))}onSubmit(){if(this.controlForm.valid){this.isLoading=!0;let i=this.controlForm.value;if(this.isEditMode&&this.controlId){let e={cantidadHuevos:i.cantidadHuevos,calidad:i.calidad||void 0};this.huevosService.updateControl(this.controlId,e).subscribe({next:d=>{this.toastr.success("Control actualizado exitosamente","\xC9xito",{progressBar:!0,closeButton:!0}),this.router.navigate(["../list"],{relativeTo:this.route})},error:d=>{this.toastr.error("Error al actualizar control","Error",{progressBar:!0,closeButton:!0}),this.isLoading=!1,this.cdr.detectChanges()}})}else{let e={idLote:parseInt(i.idLote),fecha:i.fecha,cantidadHuevos:i.cantidadHuevos,calidad:i.calidad||void 0};this.huevosService.createControl(e).subscribe({next:d=>{this.toastr.success("Control creado exitosamente","\xC9xito",{progressBar:!0,closeButton:!0}),this.router.navigate(["../list"],{relativeTo:this.route})},error:d=>{this.toastr.error("Error al crear control","Error",{progressBar:!0,closeButton:!0}),this.isLoading=!1,this.cdr.detectChanges()}})}}else this.markFormGroupTouched()}markFormGroupTouched(){Object.keys(this.controlForm.controls).forEach(i=>{this.controlForm.get(i)?.markAsTouched()})}formatDateForInput(i){return i?new Date(i+"T00:00:00.000Z").toISOString().split("T")[0]:""}isFieldInvalid(i){let e=this.controlForm.get(i);return!!(e&&e.invalid&&(e.dirty||e.touched))}getFieldError(i){let e=this.controlForm.get(i);if(e?.errors){if(e.errors.required)return`${i} es requerido`;if(e.errors.min)return`${i} debe ser mayor a 0`}return""}getLoteNombre(){let i=this.controlForm.get("idLote")?.value;if(!i)return"";let e=this.lotes.find(d=>d.id==i);return e?`${e.galera} - ${e.tipo}`:""}};s.\u0275fac=function(e){return new(e||s)(u(X),u(he),u(ve),u(G),u(O),u(j),u(de))},s.\u0275cmp=H({type:s,selectors:[["app-new-huevo"]],standalone:!0,features:[R],decls:54,vars:10,consts:[["nav","ngbNav"],[3,"title"],[1,"row"],[1,"col-xxl-3","col-xl-4","col-md-12","col-lg-12"],[1,"card","box-widget","widget-user","custom-card"],[1,"card-body","text-center"],[1,"widget-user-image","mx-auto","text-center"],[1,"fas","fa-egg","fa-5x","text-warning"],[1,"pro-user","mt-3"],[1,"pro-user-username","text-dark","mb-1","fs-16"],[1,"pro-user-desc","text-muted","fs-12"],[1,"card-footer","p-0"],[1,"col-4","text-center","py-3","border-end"],[1,"fs-12","fw-semibold","mb-3"],[1,"mb-2"],[1,"fs-18","text-primary"],[1,"fs-12","mb-0"],[1,"col-4","py-3","text-center","border-end"],[1,"fs-12","text-info"],[1,"col-4","text-center","py-3"],[1,"fs-12","text-success"],[1,"col-xxl-9","col-xl-8","col-md-12","col-lg-12"],[1,"tab-menu-heading","hremp-tabs","p-0","border-0"],[1,"tabs-menu1"],["ngbNav","",1,"panel-tabs",3,"activeIdChange","activeId"],[3,"ngbNavItem"],["ngbNavLink",""],["ngbNavContent",""],[1,"panel-body","tabs-menu-body","hremp-tabs1","p-0"],[1,"tab-content",3,"ngbNavOutlet"],[1,"panel-footer","text-end"],["type","button",1,"me-2","btn","btn-primary",3,"click","disabled"],["type","button","routerLink","../list",1,"btn","btn-danger"],["id","tab1"],[1,"card-body"],[1,"text-center"],[3,"formGroup"],["role","status",1,"spinner-border"],[1,"visually-hidden"],[3,"ngSubmit","formGroup"],[1,"mb-4","font-weight-bold"],[1,"form-group"],[1,"col-md-3"],[1,"form-label","mb-0","mt-2"],[1,"col-md-9"],["formControlName","idLote","placeholder","Seleccionar lote",1,"form-control","custom-select","p-0",3,"disabled"],[3,"value"],[1,"invalid-feedback","d-block"],["type","date","formControlName","fecha",1,"form-control"],[1,"invalid-feedback"],["type","number","formControlName","cantidadHuevos","placeholder","Ingrese la cantidad","min","1",1,"form-control"],["formControlName","calidad","placeholder","Seleccionar calidad",1,"form-control","custom-select","p-0",3,"clearable"]],template:function(e,d){if(e&1){let p=w();g(0,"app-hr-dashboard-page-header",1),t(1,"div",2)(2,"div",3)(3,"div",4)(4,"div",5)(5,"div",6),g(6,"i",7),o(),t(7,"div",8)(8,"h5",9),a(9,"Control de Huevos"),o(),t(10,"h6",10),a(11),o()()(),t(12,"div",11)(13,"div",2)(14,"div",12)(15,"h5",13),a(16,"Cantidad"),o(),t(17,"h5",14)(18,"span",15),a(19),o()(),t(20,"h5",16),a(21,"Huevos"),o()(),t(22,"div",17)(23,"h5",13),a(24,"Fecha"),o(),t(25,"h5",14)(26,"span",18),a(27),o()(),t(28,"h5",16),a(29,"Registro"),o()(),t(30,"div",19)(31,"h5",13),a(32,"Lote"),o(),t(33,"h5",14)(34,"span",20),a(35),o()(),t(36,"h5",16),a(37,"Asignado"),o()()()()()(),t(38,"div",21)(39,"div",22)(40,"div",23)(41,"ul",24,0),D("activeIdChange",function(m){return S(p),V(d.active,m)||(d.active=m),E(m)}),t(43,"li",25)(44,"a",26),a(45,"Control de Huevos"),o(),f(46,Ie,4,1,"ng-template",27),o()()()(),t(47,"div",28),g(48,"div",29),t(49,"div",30)(50,"button",31),L("click",function(){return S(p),E(d.onSubmit())}),a(51),o(),t(52,"button",32),a(53," Cancelar "),o()()()()()}if(e&2){let p,h,m,N=k(42);c("title",d.isEditMode?"Editar Control":"Agregar Control"),l(11),_(((p=d.controlForm.get("calidad"))==null?null:p.value)||"Sin calidad"),l(8),_(((h=d.controlForm.get("cantidadHuevos"))==null?null:h.value)||"0"),l(8),_(((m=d.controlForm.get("fecha"))==null?null:m.value)||"Sin fecha"),l(8),_(d.getLoteNombre()||"Sin lote"),l(6),B("activeId",d.active),l(2),c("ngbNavItem",1),l(5),c("ngbNavOutlet",N),l(2),c("disabled",d.controlForm.invalid||d.isLoading),l(),x(" ",d.isEditMode?"Actualizar":"Guardar"," ")}},dependencies:[A,q,P,Y,Z,$,J,z,W,U,K,Q,ue,me,ce,le,ee,oe,ie,te,ne,re,ae,pe,se]});let n=s;return n})();export{Ge as NewHuevoComponent};
