import{a as _e}from"./chunk-ARNF3ISK.js";import"./chunk-IORNA22M.js";import{g as ce,h as pe,j as ve,n as fe}from"./chunk-FG6B37U2.js";import{a as de,b as me,c as se}from"./chunk-S5Y45Y7X.js";import{Aa as ue}from"./chunk-35J6RYA3.js";import{r as oe}from"./chunk-P6RHK3TE.js";import{a as M,b as le,c as re,d as ae}from"./chunk-LAI4YRFV.js";import{M as te,_ as ie,c as B,ca as ne,e as C,g as U,h as J,m as K,p as W,q as X,w as Z,y as ee}from"./chunk-I6FKYEZO.js";import{Cb as N,Ib as S,Kb as g,Ob as $,Qa as a,Qb as I,Ra as E,Rb as A,Sb as D,Vb as R,Wb as n,Xb as w,Yb as L,cc as z,db as v,dc as G,jb as k,la as V,lb as x,ld as Y,ob as q,od as H,pb as O,rb as f,rc as Q,ua as h,ub as j,va as b,vb as P,wb as t,xb as e,yb as s}from"./chunk-W3KPMJ6O.js";import"./chunk-REZWHGN7.js";var ge=(l,d)=>d.id;function Ce(l,d){l&1&&(t(0,"div",46)(1,"div",48)(2,"span",49),n(3,"Cargando..."),e()()())}function he(l,d){l&1&&(t(0,"tr")(1,"td",51)(2,"div",52),s(3,"i",53),t(4,"p"),n(5,"No hay clientes disponibles"),e()()()())}function be(l,d){if(l&1){let r=N();t(0,"tr")(1,"td"),n(2),e(),t(3,"td")(4,"div",39)(5,"span",54),s(6,"i",55),e(),t(7,"div")(8,"h6",56),n(9),e(),t(10,"span",57),n(11),e()()()(),t(12,"td"),n(13),e(),t(14,"td"),n(15),e(),t(16,"td")(17,"span"),n(18),e()(),t(19,"td")(20,"div",58)(21,"a",59),s(22,"i",60),e(),t(23,"a",61),S("click",function(){let i=h(r).$implicit,c=g(3),p=R(85);return b(c.edit(p,i))}),s(24,"i",62),e(),t(25,"a",63),S("click",function(){let i=h(r).$implicit,c=g(3);return b(c.toggleClienteStatus(i))}),s(26,"i"),e()()()()}if(l&2){let r=d.$implicit;a(2),L("#CL-",r.id.toString().padStart(3,"0"),""),a(7),w(r.nombre),a(2),L("Cliente #",r.id,""),a(2),w(r.telefono||"N/A"),a(2),w(r.direccion||"N/A"),a(2),q("badge bg-",r.activo?"success":"danger","-transparent"),a(),L(" ",r.activo?"Activo":"Inactivo"," "),a(3),$("routerLink","/dashboard/client-dashboard/view-client/",r.id,""),a(4),k("ngbTooltip",r.activo?"Desactivar":"Activar"),a(),O("fe fe-",r.activo?"user-x":"user-check"," text-",r.activo?"danger":"success","")}}function xe(l,d){if(l&1&&j(0,be,27,16,"tr",null,ge),l&2){let r=g(2);P(r.clientes)}}function Se(l,d){if(l&1&&(t(0,"div",47)(1,"table",50)(2,"thead")(3,"tr")(4,"th"),n(5,"#ID"),e(),t(6,"th"),n(7,"Nombre"),e(),t(8,"th"),n(9,"Tel\xE9fono"),e(),t(10,"th"),n(11,"Direcci\xF3n"),e(),t(12,"th"),n(13,"Estado"),e(),t(14,"th"),n(15,"Acciones"),e()()(),t(16,"tbody"),v(17,he,6,0,"tr")(18,xe,2,0),e()()()),l&2){let r=g();a(17),f(r.clientes.length===0?17:18)}}function Ee(l,d){l&1&&(t(0,"div",70),n(1," El nombre es requerido "),e())}function Fe(l,d){l&1&&(t(0,"div",70),n(1," El tel\xE9fono es requerido "),e())}function ye(l,d){l&1&&(t(0,"span"),n(1,"El correo es requerido"),e())}function Te(l,d){l&1&&(t(0,"span"),n(1,"Ingrese un correo v\xE1lido"),e())}function ke(l,d){if(l&1&&(t(0,"div",70),v(1,ye,2,0,"span")(2,Te,2,0,"span"),e()),l&2){let r,o,i=g(2);a(),f(!((r=i.editForm.get("correo"))==null||r.errors==null)&&r.errors.required?1:-1),a(),f(!((o=i.editForm.get("correo"))==null||o.errors==null)&&o.errors.email?2:-1)}}function we(l,d){l&1&&(t(0,"div",70),n(1," El NIT es requerido "),e())}function Le(l,d){l&1&&(t(0,"div",70),n(1," La direcci\xF3n es requerida "),e())}function Ne(l,d){l&1&&s(0,"span",79)}function Ie(l,d){if(l&1){let r=N();t(0,"form",64),S("ngSubmit",function(){h(r);let i=g();return b(i.onUpdateCliente())}),t(1,"div",65)(2,"h5",66),n(3,"Editar Cliente"),e(),t(4,"button",67),S("click",function(){let i=h(r).$implicit;return b(i.dismiss("Cross click"))}),e()(),t(5,"div",68)(6,"div",14)(7,"div",23)(8,"div",24)(9,"label",25),n(10,"Nombre *"),e(),s(11,"input",69),v(12,Ee,2,0,"div",70),e()(),t(13,"div",23)(14,"div",24)(15,"label",25),n(16,"Tel\xE9fono *"),e(),s(17,"input",71),v(18,Fe,2,0,"div",70),e()(),t(19,"div",23)(20,"div",24)(21,"label",25),n(22,"Correo Electr\xF3nico *"),e(),s(23,"input",72),v(24,ke,3,2,"div",70),e()(),t(25,"div",23)(26,"div",24)(27,"label",25),n(28,"NIT *"),e(),s(29,"input",73),v(30,we,2,0,"div",70),e()(),t(31,"div",74)(32,"div",24)(33,"label",25),n(34,"Direcci\xF3n *"),e(),s(35,"textarea",75),v(36,Le,2,0,"div",70),e()()()(),t(37,"div",76)(38,"button",77),S("click",function(){let i=h(r).$implicit;return b(i.dismiss("cancel"))}),n(39,"Cancelar"),e(),t(40,"button",78),v(41,Ne,1,0,"span",79),n(42," Actualizar "),e()()()}if(l&2){let r,o,i,c,p,u,_,F,y,T,m=g();k("formGroup",m.editForm),a(11),x("is-invalid",((r=m.editForm.get("nombre"))==null?null:r.invalid)&&((r=m.editForm.get("nombre"))==null?null:r.touched)),a(),f((o=m.editForm.get("nombre"))!=null&&o.invalid&&((o=m.editForm.get("nombre"))!=null&&o.touched)?12:-1),a(5),x("is-invalid",((i=m.editForm.get("telefono"))==null?null:i.invalid)&&((i=m.editForm.get("telefono"))==null?null:i.touched)),a(),f((c=m.editForm.get("telefono"))!=null&&c.invalid&&((c=m.editForm.get("telefono"))!=null&&c.touched)?18:-1),a(5),x("is-invalid",((p=m.editForm.get("correo"))==null?null:p.invalid)&&((p=m.editForm.get("correo"))==null?null:p.touched)),a(),f((u=m.editForm.get("correo"))!=null&&u.invalid&&((u=m.editForm.get("correo"))!=null&&u.touched)?24:-1),a(5),x("is-invalid",((_=m.editForm.get("nit"))==null?null:_.invalid)&&((_=m.editForm.get("nit"))==null?null:_.touched)),a(),f((F=m.editForm.get("nit"))!=null&&F.invalid&&((F=m.editForm.get("nit"))!=null&&F.touched)?30:-1),a(5),x("is-invalid",((y=m.editForm.get("direccion"))==null?null:y.invalid)&&((y=m.editForm.get("direccion"))==null?null:y.touched)),a(),f((T=m.editForm.get("direccion"))!=null&&T.invalid&&((T=m.editForm.get("direccion"))!=null&&T.touched)?36:-1),a(4),k("disabled",m.loading),a(),f(m.loading?41:-1)}}var We=(()=>{let d=class d{constructor(o,i,c,p){this.modalService=o,this.clienteService=i,this.fb=c,this.toastr=p,this.displayedColumns=["ID","Name","Email","Projects","Status","Action"],this.clientes=[],this.filteredClientes=[],this.loading=!1,this.selectedCliente=null,this.inlineDatePicker=!1,this.flatpickrOptions={inline:!0},this.dataSource=new ue([]),this.editForm=this.fb.group({nombre:["",C.required],telefono:["",C.required],correo:["",[C.required,C.email]],direccion:["",C.required],nit:["",C.required]})}ngAfterViewInit(){this.dataSource.paginator=this.paginator,this.dataSource.sort=this.sort}applyFilter(o){let i=o.target.value;this.dataSource.filter=i.trim().toLowerCase(),this.dataSource.paginator&&this.dataSource.paginator.firstPage()}toggleClienteStatus(o){let i=o.activo,c=i?"desactivar":"activar";confirm(`\xBFEst\xE1 seguro de que desea ${c} este cliente?`)&&(i?this.clienteService.deactivateCliente(o.id):this.clienteService.activateCliente(o.id)).subscribe({next:()=>{this.toastr.success(`Cliente ${c}do exitosamente`,"\xC9xito",{timeOut:3e3,positionClass:"toast-top-right"}),this.loadClientes()},error:u=>{console.error("Error response:",u);let _="Error desconocido";u.error?.message?_=u.error.message:u.error?.error?_=u.error.error:u.message?_=u.message:typeof u.error=="string"&&(_=u.error),this.toastr.error(`Error al ${c} el cliente: ${_}`,"Error",{timeOut:3e3,positionClass:"toast-top-right"})}})}edit(o,i){this.selectedCliente=i,this.editForm.patchValue({nombre:i.nombre,telefono:i.telefono,correo:i.correo,direccion:i.direccion,nit:i.nit}),this.modalService.open(o,{windowClass:"modalCusSty modal-lg"})}onUpdateCliente(){if(this.editForm.valid&&this.selectedCliente){this.loading=!0;let o=this.editForm.value;this.clienteService.updateCliente(this.selectedCliente.id,o).subscribe({next:i=>{this.toastr.success("Cliente actualizado exitosamente","\xC9xito",{timeOut:3e3,positionClass:"toast-top-right"}),this.loadClientes(),this.modalService.dismissAll(),this.loading=!1},error:i=>{this.toastr.error("Error al actualizar el cliente: "+(i.error?.message||"Error desconocido"),"Error",{timeOut:3e3,positionClass:"toast-top-right"}),this.loading=!1}})}else this.toastr.warning("Por favor, complete todos los campos requeridos","Advertencia",{timeOut:3e3,positionClass:"toast-top-right"}),this.markFormGroupTouched()}markFormGroupTouched(){Object.keys(this.editForm.controls).forEach(o=>{this.editForm.get(o)?.markAsTouched()})}open(o){this.modalService.open(o,{windowClass:"modalCusSty",size:"lg"})}ngOnInit(){this.loadClientes(),this.initializeFlatpickr()}loadClientes(){this.loading=!0,this.clienteService.getClientes().subscribe({next:o=>{let i=o?.data?.data||o?.data||o||[];this.clientes=Array.isArray(i)?i:[],this.filteredClientes=[...this.clientes],this.loading=!1},error:o=>{console.error("Error loading clientes:",o),this.clientes=[],this.filteredClientes=[],this.loading=!1}})}mapClientesToDisplay(o){return!o||!Array.isArray(o)?(console.warn("Clientes is not an array:",o),[]):o.map((i,c)=>({id:i.id,No:`#CLT-${String(i.id).padStart(3,"0")}`,name:i.nombre||"Sin nombre",img:i.img||"./assets/images/laritechfarms/2.jpg",email:i.correo||i.email||"",project:i.proyectos||i._count?.proyectos||0,statusText:i.estado||i.activo?"Active":"InActive",status:i.estado||i.activo?"success":"danger"}))}initializeFlatpickr(){this.flatpickrOptions={enableTime:!0,noCalendar:!0,dateFormat:"H:i"},M("#inlinetime",this.flatpickrOptions),this.flatpickrOptions={enableTime:!0,dateFormat:"Y-m-d H:i",defaultDate:"2023-11-07 14:30"},M("#pretime",this.flatpickrOptions)}};d.\u0275fac=function(i){return new(i||d)(E(te),E(_e),E(Z),E(oe))},d.\u0275cmp=V({type:d,selectors:[["app-client-list"]],viewQuery:function(i,c){if(i&1&&(I(ce,5),I(pe,5)),i&2){let p;A(p=D())&&(c.paginator=p.first),A(p=D())&&(c.sort=p.first)}},standalone:!0,features:[z([le]),G],decls:86,vars:1,consts:[["editContent",""],[1,"page-header","d-lg-flex","d-block"],[1,"page-leftheader"],[1,"page-title"],[1,"page-rightheader"],[1,"btn-list","d-flex","gap-1"],["routerLink","/dashboard/client-dashboard/new-client",1,"btn","btn-primary"],[1,"fe","fe-plus","fs-12","my-auto","me-2"],["data-bs-toggle","tooltip","data-bs-placement","top","title","E-mail",1,"btn","btn-light3"],[1,"fe","fe-mail"],["data-bs-placement","top","data-bs-toggle","tooltip","title","Contact",1,"btn","btn-light3"],[1,"fe","fe-phone-call"],["data-bs-placement","top","data-bs-toggle","tooltip","title","Info",1,"btn","btn-primary"],[1,"fe","fe-info"],[1,"row"],[1,"col-xl-12","col-md-12","col-lg-12"],[1,"card","custom-card"],[1,"card-header","d-flex","justify-content-between","border-bottom-0"],[1,"card-title"],[1,"float-end"],["type","text","placeholder","buscar",1,"form-control"],[1,"card-body"],[1,"col-md-12","col-lg-7"],[1,"col-md-6"],[1,"form-group"],[1,"form-label"],[1,"input-group"],[1,"input-group-text","text-muted"],[1,"ri-calendar-line"],["mwlFlatpickr","","type","text","placeholder","DD-MM-YYYY",1,"form-control","choose-date"],[1,"col-md-3"],["data-trigger","","placeholder","Seleccionar Estado",1,"form-control","custom-select","p-0"],["value",""],["value","1"],[1,"col-md-2"],[1,"form-group","mt-2"],["href","javascript:void(0);",1,"btn","btn-primary","d-grid"],[1,"card-body","border-top"],[1,"col-sm-6","mb-1"],[1,"d-flex","align-items-center"],[1,"d-flex","ms-2","mx-2"],["name","quantity","placeholder","10",1,"form-control","wd-150","p-0"],["value","10"],["value","25"],["value","50"],["value","100"],[1,"text-center","py-4"],[1,"table-responsive"],["role","status",1,"spinner-border"],[1,"visually-hidden"],[1,"table","table-vcenter","text-nowrap","table-bordered","border-bottom"],["colspan","6",1,"text-center","py-4"],[1,"text-muted"],[1,"fe","fe-inbox","fs-24","mb-2"],[1,"avatar","avatar-md","me-2","avatar-rounded","bg-primary-transparent"],[1,"fe","fe-user"],[1,"mb-1","fs-14"],[1,"fs-12","text-muted"],[1,"d-flex"],["placement","top","ngbTooltip","Ver Cliente",1,"action-btns1",3,"routerLink"],[1,"fe","fe-eye","text-primary"],["placement","top","ngbTooltip","Editar",1,"action-btns1",3,"click"],[1,"fe","fe-edit-2","text-success"],["placement","top",1,"action-btns1",3,"click","ngbTooltip"],[3,"ngSubmit","formGroup"],[1,"modal-header"],[1,"modal-title"],["type","button","data-bs-dismiss","modal","aria-label","Close",1,"btn-close",3,"click"],[1,"modal-body"],["formControlName","nombre","placeholder","Nombre del cliente",1,"form-control"],[1,"invalid-feedback"],["formControlName","telefono","placeholder","Tel\xE9fono",1,"form-control"],["formControlName","correo","type","email","placeholder","correo@ejemplo.com",1,"form-control"],["formControlName","nit","placeholder","NIT",1,"form-control"],[1,"col-md-12"],["formControlName","direccion","rows","3","placeholder","Direcci\xF3n completa",1,"form-control"],[1,"modal-footer"],["type","button",1,"btn","btn-outline-primary",3,"click"],["type","submit",1,"btn","btn-success",3,"disabled"],["role","status",1,"spinner-border","spinner-border-sm","me-2"]],template:function(i,c){i&1&&(t(0,"div",1)(1,"div",2)(2,"div",3),n(3,"Lista de Clientes"),e()(),t(4,"div",4)(5,"div",5)(6,"a",6),s(7,"i",7),n(8,"Agregar Cliente"),e(),t(9,"button",8),s(10,"i",9),e(),t(11,"button",10),s(12,"i",11),e(),t(13,"button",12),s(14,"i",13),e()()()(),t(15,"div",14)(16,"div",15)(17,"div",16)(18,"div",17)(19,"h4",18),n(20,"Resumen de Clientes"),e(),t(21,"div",19),s(22,"input",20),e()(),t(23,"div",21)(24,"div",14)(25,"div",22)(26,"div",14)(27,"div",23)(28,"div",24)(29,"label",25),n(30,"Desde:"),e(),t(31,"div",24)(32,"div",26)(33,"div",27),s(34,"i",28),e(),s(35,"input",29),e()()()(),t(36,"div",23)(37,"div",24)(38,"label",25),n(39,"Hasta:"),e(),t(40,"div",24)(41,"div",26)(42,"div",27),s(43,"i",28),e(),s(44,"input",29),e()()()()()(),t(45,"div",30)(46,"div",24)(47,"label",25),n(48,"Seleccionar Estado:"),e(),n(49,"per "),t(50,"ng-select",31)(51,"ng-option",32),n(52,"Activo"),e(),t(53,"ng-option",33),n(54,"Inactivo"),e()()()(),t(55,"div",34)(56,"div",35),s(57,"label",25),t(58,"a",36),n(59,"Buscar"),e()()()()(),t(60,"div",37)(61,"div",14)(62,"div",38)(63,"div",39)(64,"span"),n(65,"Mostrar"),e(),t(66,"div",40)(67,"div",24)(68,"ng-select",41)(69,"ng-option",42),n(70,"10"),e(),t(71,"ng-option",43),n(72,"25"),e(),t(73,"ng-option",44),n(74,"50"),e(),t(75,"ng-option",45),n(76,"100"),e()()()(),t(77,"span"),n(78,"entradas"),e()()(),t(79,"div",38)(80,"div",19),s(81,"input",20),e()()(),v(82,Ce,4,0,"div",46)(83,Se,19,1,"div",47),e()()()(),v(84,Ie,43,18,"ng-template",null,0,Q)),i&2&&(a(82),f(c.loading?82:83))},dependencies:[fe,se,me,de,ve,ae,re,H,Y,ee,K,B,U,J,W,X,ne,ie]});let l=d;return l})();export{We as ClientListComponent};
