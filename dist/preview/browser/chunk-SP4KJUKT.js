import{a as se}from"./chunk-C7LS3LED.js";import{a as me}from"./chunk-55ZRRGER.js";import{a as T}from"./chunk-IORNA22M.js";import{a as re,n as ce}from"./chunk-USSGZFX3.js";import{a as ae,b as le,c as de}from"./chunk-XG7TRELF.js";import"./chunk-2CYZEA6T.js";import{r as ie}from"./chunk-3DATYCE5.js";import{b as ne,d as oe}from"./chunk-EMEDTLE5.js";import{c as Q,e as p,g as J,h as K,m as W,n as X,p as Y,q as Z,w as ee,y as te}from"./chunk-XRHNCSTF.js";import{$c as y,Ib as N,Kb as L,Lc as A,Mc as G,Qa as a,Qc as U,Ra as u,Tc as B,Wb as i,Wc as $,Xb as f,Yb as k,_b as O,cc as M,db as s,dc as q,ea as C,ha as F,id as z,jb as m,kd as R,la as w,nb as P,nc as V,ob as D,od as H,pc as I,r as _,rb as j,wb as t,xb as e,yb as E}from"./chunk-AZAYKVK3.js";import"./chunk-REZWHGN7.js";var ue=(()=>{let o=class o{constructor(r){this.http=r,this.apiUrl=`${T.apiUrl}/v1/lotes`}getLotes(){return this.http.get(this.apiUrl).pipe(_(r=>r.data.data||[]))}};o.\u0275fac=function(c){return new(c||o)(F(y))},o.\u0275prov=C({token:o,factory:o.\u0275fac,providedIn:"root"});let n=o;return n})();var ve=(()=>{let o=class o{constructor(r){this.http=r,this.apiUrl=`${T.apiUrl}/v1/productos`}getProductos(){return this.http.get(this.apiUrl).pipe(_(r=>r.data.data||[]))}};o.\u0275fac=function(c){return new(c||o)(F(y))},o.\u0275prov=C({token:o,factory:o.\u0275fac,providedIn:"root"});let n=o;return n})();function be(n,o){if(n&1&&(t(0,"div",3)(1,"div",4)(2,"div",26)(3,"h5",27),i(4,"Informaci\xF3n de la Venta"),e()(),t(5,"div",5)(6,"div",28)(7,"table",29)(8,"tbody")(9,"tr")(10,"td",30),i(11,"ID Venta:"),e(),t(12,"td"),i(13),e()(),t(14,"tr")(15,"td",30),i(16,"Cliente:"),e(),t(17,"td"),i(18),e()(),t(19,"tr")(20,"td",30),i(21,"Fecha:"),e(),t(22,"td"),i(23),V(24,"date"),e()(),t(25,"tr")(26,"td",30),i(27,"Total:"),e(),t(28,"td",31),i(29),V(30,"number"),e()(),t(31,"tr")(32,"td",30),i(33,"Estado:"),e(),t(34,"td")(35,"span"),i(36),e()()(),t(37,"tr")(38,"td",30),i(39,"Observaciones:"),e(),t(40,"td"),i(41),e()(),t(42,"tr")(43,"td",30),i(44,"Usuario:"),e(),t(45,"td"),i(46),e()()()()()()()()),n&2){let d=L();a(13),f(d.selectedVenta.id),a(5),f((d.selectedVenta.cliente==null?null:d.selectedVenta.cliente.nombre)||"#"+d.selectedVenta.idCliente),a(5),f(I(24,10,d.selectedVenta.fecha,"dd/MM/yyyy")),a(6),k("Q",I(30,13,d.selectedVenta.total,"1.2-2"),""),a(6),D("badge bg-",d.selectedVenta.estado==="Completada"?"success":d.selectedVenta.estado==="Pendiente"?"warning":"danger",""),a(),f(d.selectedVenta.estado),a(5),f(d.selectedVenta.observaciones||"N/A"),a(5),f((d.selectedVenta.usuario==null?null:d.selectedVenta.usuario.nombre)||"N/A")}}function Se(n,o){if(n&1&&(t(0,"ng-option",32),i(1),V(2,"number"),e()),n&2){let d=o.$implicit;m("value",d.id),a(),O(" Venta #",d.id," - Cliente #",d.idCliente," - Q",I(2,4,d.total,"1.2-2")," ")}}function Ee(n,o){n&1&&(t(0,"div",33)(1,"small"),i(2,"Debe seleccionar una venta"),e()())}function ke(n,o){if(n&1&&(t(0,"ng-option",32),i(1),e()),n&2){let d=o.$implicit;m("value",d.id),a(),k(" ",d.galera," ")}}function xe(n,o){n&1&&(t(0,"div",33)(1,"small"),i(2,"Debe seleccionar un lote"),e()())}function _e(n,o){if(n&1&&(t(0,"ng-option",32),i(1),e()),n&2){let d=o.$implicit;m("value",d.id),a(),k(" ",d.nombre," ")}}function Ce(n,o){n&1&&(t(0,"div",33)(1,"small"),i(2,"Debe seleccionar un producto"),e()())}function Fe(n,o){n&1&&(t(0,"div",33)(1,"small"),i(2,"La cantidad es requerida"),e()())}function Ve(n,o){n&1&&(t(0,"div",33)(1,"small"),i(2,"La fecha es requerida"),e()())}function Ie(n,o){n&1&&(t(0,"div",33)(1,"small"),i(2,"El estado es requerido"),e()())}function ye(n,o){n&1&&E(0,"span",34)}var Je=(()=>{let o=class o{constructor(r,c,l,v,g,h,b,S){this.fb=r,this.ticketService=c,this.ventaService=l,this.loteService=v,this.productoService=g,this.router=h,this.route=b,this.toastr=S,this.loading=!1,this.ventas=[],this.lotes=[],this.productos=[],this.selectedVentaData=null,this.ticketForm=this.fb.group({idVenta:["",[p.required,p.min(1)]],idLote:["",[p.required,p.min(1)]],idProducto:["",[p.required,p.min(1)]],fecha:["",p.required],cantidad:["",[p.required,p.min(1)]],estado:["Pendiente",p.required],codigoAutorizacion:[""]})}ngOnInit(){let r=new Date().toISOString().split("T")[0];this.ticketForm.patchValue({fecha:r}),this.loadVentas(),this.loadLotes(),this.loadProductos(),this.ticketForm.get("idVenta")?.valueChanges.subscribe(c=>{c&&this.onVentaSelected(c)}),this.route.queryParams.subscribe(c=>{c.ventaId&&this.ticketForm.patchValue({idVenta:+c.ventaId})})}loadVentas(){this.ventaService.getVentas().subscribe({next:r=>{this.ventas=r||[]},error:r=>{console.error("Error loading ventas:",r),this.ventas=[]}})}loadLotes(){this.loteService.getLotes().subscribe({next:r=>{this.lotes=r||[]},error:r=>{console.error("Error loading lotes:",r),this.lotes=[]}})}loadProductos(){this.productoService.getProductos().subscribe({next:r=>{this.productos=r||[]},error:r=>{console.error("Error loading productos:",r),this.productos=[]}})}onSubmit(){if(this.ticketForm.valid){this.loading=!0;let r=this.ticketForm.value;this.ticketService.createTicket(r).subscribe({next:()=>{this.toastr.success("Ticket creado exitosamente","\xC9xito",{timeOut:3e3,positionClass:"toast-top-right"}),this.router.navigate(["/dashboard/business-dashboard/ticket-list"])},error:c=>{this.toastr.error("Error al crear el ticket: "+(c.error?.message||"Error desconocido"),"Error",{timeOut:3e3,positionClass:"toast-top-right"}),this.loading=!1}})}else this.toastr.warning("Por favor, complete todos los campos requeridos","Advertencia",{timeOut:3e3,positionClass:"toast-top-right"}),this.markFormGroupTouched()}onCancel(){this.router.navigate(["/dashboard/business-dashboard/ticket-list"])}onVentaSelected(r){this.ventaService.getVentaById(r).subscribe({next:c=>{this.selectedVentaData=c.data},error:c=>{console.error("Error loading venta details:",c),this.selectedVentaData=null}})}get selectedVenta(){return this.selectedVentaData}markFormGroupTouched(){Object.keys(this.ticketForm.controls).forEach(r=>{this.ticketForm.get(r)?.markAsTouched()})}};o.\u0275fac=function(c){return new(c||o)(u(ee),u(me),u(se),u(ue),u(ve),u(R),u(z),u(ie))},o.\u0275cmp=w({type:o,selectors:[["app-new-ticket"]],standalone:!0,features:[M([ne]),q],decls:69,vars:19,consts:[[3,"title"],[3,"ngSubmit","formGroup"],[1,"row"],[1,"col-xl-4","col-md-4","col-lg-4"],[1,"card"],[1,"card-body"],[1,"mb-5","fw-semibold"],[1,"col-md-6"],[1,"form-group"],[1,"form-label"],["name","idVenta","placeholder","Seleccione una venta","formControlName","idVenta","bindLabel","displayText","bindValue","id",1,"form-control","p-0","custom-select"],[3,"value",4,"ngFor","ngForOf"],["class","text-danger",4,"ngIf"],["name","idLote","placeholder","Seleccione un lote","formControlName","idLote","bindLabel","galera","bindValue","id",1,"form-control","p-0","custom-select"],["name","idProducto","placeholder","Seleccione un producto","formControlName","idProducto","bindLabel","nombre","bindValue","id",1,"form-control","p-0","custom-select"],["type","number","placeholder","Ingrese la cantidad","formControlName","cantidad",1,"form-control"],["type","date","formControlName","fecha",1,"form-control"],["name","estado","placeholder","Seleccione el estado","formControlName","estado",1,"form-control","p-0","custom-select"],["value","Pendiente"],["value","Completado"],["value","Cancelado"],["type","text","placeholder","Ingrese el c\xF3digo de autorizaci\xF3n (opcional)","formControlName","codigoAutorizacion",1,"form-control"],[1,"card-footer","text-end"],["type","button",1,"btn","btn-danger","btn-lg","me-2",3,"click","disabled"],["type","submit",1,"btn","btn-success","btn-lg",3,"disabled"],["class","spinner-border spinner-border-sm me-2",4,"ngIf"],[1,"card-header"],[1,"card-title","mb-0"],[1,"table-responsive"],[1,"table","table-borderless"],[1,"fw-semibold"],[1,"text-success","fw-bold"],[3,"value"],[1,"text-danger"],[1,"spinner-border","spinner-border-sm","me-2"]],template:function(c,l){if(c&1&&(E(0,"app-page-header",0),t(1,"form",1),N("ngSubmit",function(){return l.onSubmit()}),t(2,"div",2),s(3,be,47,16,"div",3),t(4,"div")(5,"div",4)(6,"div",5)(7,"h4",6),i(8,"Detalles del Ticket:"),e(),t(9,"div",2)(10,"div",7)(11,"div",8)(12,"label",9),i(13,"Seleccionar Venta *"),e(),t(14,"ng-select",10),s(15,Se,3,7,"ng-option",11),e(),s(16,Ee,3,0,"div",12),e()(),t(17,"div",7)(18,"div",8)(19,"label",9),i(20,"Lote *"),e(),t(21,"ng-select",13),s(22,ke,2,2,"ng-option",11),e(),s(23,xe,3,0,"div",12),e()()(),t(24,"div",2)(25,"div",7)(26,"div",8)(27,"label",9),i(28,"Producto *"),e(),t(29,"ng-select",14),s(30,_e,2,2,"ng-option",11),e(),s(31,Ce,3,0,"div",12),e()(),t(32,"div",7)(33,"div",8)(34,"label",9),i(35,"Cantidad *"),e(),E(36,"input",15),s(37,Fe,3,0,"div",12),e()()(),t(38,"div",2)(39,"div",7)(40,"div",8)(41,"label",9),i(42,"Fecha *"),e(),E(43,"input",16),s(44,Ve,3,0,"div",12),e()()(),t(45,"div",2)(46,"div",7)(47,"div",8)(48,"label",9),i(49,"Estado *"),e(),t(50,"ng-select",17)(51,"ng-option",18),i(52,"Pendiente"),e(),t(53,"ng-option",19),i(54,"Completado"),e(),t(55,"ng-option",20),i(56,"Cancelado"),e()(),s(57,Ie,3,0,"div",12),e()(),t(58,"div",7)(59,"div",8)(60,"label",9),i(61,"C\xF3digo de Autorizaci\xF3n"),e(),E(62,"input",21),e()()()(),t(63,"div",22)(64,"button",23),N("click",function(){return l.onCancel()}),i(65,"Cerrar"),e(),t(66,"button",24),s(67,ye,1,0,"span",25),i(68),e()()()()()()),c&2){let v,g,h,b,S,x;m("title","Nuevo Ticket"),a(),m("formGroup",l.ticketForm),a(2),j(l.selectedVenta?3:-1),a(),P(l.selectedVenta?"col-xl-8 col-md-8 col-lg-8":"col-xl-12 col-md-12 col-lg-12"),a(11),m("ngForOf",l.ventas),a(),m("ngIf",((v=l.ticketForm.get("idVenta"))==null?null:v.invalid)&&((v=l.ticketForm.get("idVenta"))==null?null:v.touched)),a(6),m("ngForOf",l.lotes),a(),m("ngIf",((g=l.ticketForm.get("idLote"))==null?null:g.invalid)&&((g=l.ticketForm.get("idLote"))==null?null:g.touched)),a(7),m("ngForOf",l.productos),a(),m("ngIf",((h=l.ticketForm.get("idProducto"))==null?null:h.invalid)&&((h=l.ticketForm.get("idProducto"))==null?null:h.touched)),a(6),m("ngIf",((b=l.ticketForm.get("cantidad"))==null?null:b.invalid)&&((b=l.ticketForm.get("cantidad"))==null?null:b.touched)),a(7),m("ngIf",((S=l.ticketForm.get("fecha"))==null?null:S.invalid)&&((S=l.ticketForm.get("fecha"))==null?null:S.touched)),a(13),m("ngIf",((x=l.ticketForm.get("estado"))==null?null:x.invalid)&&((x=l.ticketForm.get("estado"))==null?null:x.touched)),a(7),m("disabled",l.loading),a(2),m("disabled",l.loading),a(),m("ngIf",l.loading),a(),k(" ",l.loading?"Guardando...":"Guardar"," ")}},dependencies:[$,A,G,B,U,ce,re,de,le,ae,oe,H,te,W,Q,X,J,K,Y,Z]});let n=o;return n})();export{Je as NewTicketComponent};
