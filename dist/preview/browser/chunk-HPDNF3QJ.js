import{a as Z}from"./chunk-DKVPDNA5.js";import{a as Y}from"./chunk-5NXGHONX.js";import"./chunk-USS2N3RB.js";import{c as K,n as X}from"./chunk-FYZLZUO4.js";import{a as Q,b as U,c as W}from"./chunk-KAKXLQQZ.js";import"./chunk-Q4N2GC3M.js";import{r as J}from"./chunk-GNT7AIZA.js";import"./chunk-27TGOTIH.js";import{c as q,e as g,g as D,h as O,m as V,n as G,p as P,q as R,u as z,w as B,y as $}from"./chunk-BJ65GJZA.js";import{Ib as E,Kb as I,Lc as x,Mc as A,Qa as a,Ra as p,Wb as s,Wc as w,Xb as H,Yb as N,Zb as L,db as u,dc as T,id as k,jb as d,kd as M,la as y,lb as S,nb as F,od as j,wb as n,xb as r,yb as h}from"./chunk-W3KPMJ6O.js";import"./chunk-REZWHGN7.js";function ee(i,l){if(i&1&&(n(0,"ng-option",25),s(1),r()),i&2){let c=l.$implicit;d("value",c.id),a(),L("",c.galera," - ",c.tipo,"")}}function te(i,l){i&1&&(n(0,"div",26),s(1," El lote es requerido "),r())}function oe(i,l){i&1&&(n(0,"div",26),s(1," La fecha es requerida "),r())}function ie(i,l){i&1&&(n(0,"span"),s(1,"La cantidad es requerida"),r())}function re(i,l){i&1&&(n(0,"span"),s(1,"La cantidad debe ser mayor a 0"),r())}function ae(i,l){if(i&1&&(n(0,"div",26),u(1,ie,2,0,"span",27)(2,re,2,0,"span",27),r()),i&2){let c,e,o=I();a(),d("ngIf",(c=o.controlForm.get("cantidadHuevos"))==null||c.errors==null?null:c.errors.required),a(),d("ngIf",(e=o.controlForm.get("cantidadHuevos"))==null||e.errors==null?null:e.errors.min)}}function ne(i,l){if(i&1&&(n(0,"ng-option",25),s(1),r()),i&2){let c=l.$implicit;d("value",c),a(),H(c)}}function le(i,l){i&1&&h(0,"span",28)}var Ee=(()=>{let l=class l{constructor(e,o,t,m,v,f){this.fb=e,this.huevosService=o,this.lotesService=t,this.router=m,this.route=v,this.toastr=f,this.loading=!1,this.isEditing=!1,this.controlId=null,this.lotes=[],this.calidades=["Excelente","Buena","Regular","Mala"],this.controlForm=this.fb.group({idLote:["",g.required],fecha:["",g.required],cantidadHuevos:["",[g.required,g.min(1)]],calidad:[""]})}ngOnInit(){this.loadLotes(),this.route.params.subscribe(e=>{e.id&&(this.isEditing=!0,this.controlId=+e.id,this.loadControl())})}loadLotes(){this.lotesService.getLotes().subscribe({next:e=>{let o=[];e?.data?.data&&Array.isArray(e.data.data)?o=e.data.data:e?.data?.items&&Array.isArray(e.data.items)?o=e.data.items:e?.data&&Array.isArray(e.data)?o=e.data:Array.isArray(e)&&(o=e),this.lotes=o.filter(t=>t.tipo==="Ponedoras"&&t.estado==="Activo")},error:e=>{console.error("Error al cargar lotes:",e)}})}loadControl(){this.controlId&&(this.loading=!0,this.huevosService.getControlById(this.controlId).subscribe({next:e=>{let o=e.data;this.controlForm.patchValue({idLote:o.idLote,fecha:o.fecha.split("T")[0],cantidadHuevos:o.cantidadHuevos,calidad:o.calidad}),this.loading=!1},error:e=>{console.error("Error al cargar control:",e),this.toastr.error("Error al cargar el control","Error"),this.loading=!1}}))}onSubmit(){if(this.controlForm.valid){this.loading=!0;let e=this.controlForm.value;if(this.isEditing&&this.controlId){let o={cantidadHuevos:e.cantidadHuevos,calidad:e.calidad};this.huevosService.updateControl(this.controlId,o).subscribe({next:()=>{this.toastr.success("Control actualizado exitosamente","\xC9xito"),this.router.navigate(["/dashboard/production-dashboard/huevos"]),this.loading=!1},error:t=>{console.error("Error al actualizar control:",t),this.toastr.error("Error al actualizar el control","Error"),this.loading=!1}})}else{let o=e;this.huevosService.createControl(o).subscribe({next:()=>{this.toastr.success("Control creado exitosamente","\xC9xito"),this.router.navigate(["/dashboard/production-dashboard/huevos"]),this.loading=!1},error:t=>{console.error("Error al crear control:",t),this.toastr.error("Error al crear el control","Error"),this.loading=!1}})}}else this.markFormGroupTouched(),this.toastr.warning("Por favor, complete todos los campos requeridos","Advertencia")}onCancel(){this.router.navigate(["/dashboard/production-dashboard/huevos"])}markFormGroupTouched(){Object.keys(this.controlForm.controls).forEach(e=>{this.controlForm.get(e)?.markAsTouched()})}};l.\u0275fac=function(o){return new(o||l)(p(B),p(Z),p(Y),p(M),p(k),p(J))},l.\u0275cmp=y({type:l,selectors:[["app-new-huevo"]],standalone:!0,features:[T],decls:44,vars:22,consts:[[3,"title","title2","class1","path"],[1,"row"],[1,"col-xl-12"],[1,"card","custom-card"],[1,"card-header"],[1,"card-title"],[1,"card-body"],[3,"ngSubmit","formGroup"],[1,"col-md-6"],[1,"form-group","mb-3"],["for","idLote",1,"form-label"],["formControlName","idLote","placeholder","Seleccione el lote",1,"form-control","p-0"],[3,"value",4,"ngFor","ngForOf"],["class","invalid-feedback d-block",4,"ngIf"],["for","fecha",1,"form-label"],["type","date","formControlName","fecha",1,"form-control"],["for","cantidadHuevos",1,"form-label"],["type","number","formControlName","cantidadHuevos","placeholder","Cantidad de huevos","min","1",1,"form-control"],["for","calidad",1,"form-label"],["formControlName","calidad","placeholder","Seleccione la calidad",1,"form-control","p-0"],[1,"col-md-12"],[1,"form-group","d-flex","gap-2","justify-content-end"],["type","button",1,"btn","btn-secondary",3,"click","disabled"],["type","submit",1,"btn","btn-primary",3,"disabled"],["class","spinner-border spinner-border-sm me-2","role","status",4,"ngIf"],[3,"value"],[1,"invalid-feedback","d-block"],[4,"ngIf"],["role","status",1,"spinner-border","spinner-border-sm","me-2"]],template:function(o,t){if(o&1&&(h(0,"app-hr-dashboard-page-header",0),n(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4)(5,"h3",5),s(6,"Informaci\xF3n del Control"),r()(),n(7,"div",6)(8,"form",7),E("ngSubmit",function(){return t.onSubmit()}),n(9,"div",1)(10,"div",8)(11,"div",9)(12,"label",10),s(13,"Lote *"),r(),n(14,"ng-select",11),u(15,ee,2,3,"ng-option",12),r(),u(16,te,2,0,"div",13),r()(),n(17,"div",8)(18,"div",9)(19,"label",14),s(20,"Fecha *"),r(),h(21,"input",15),u(22,oe,2,0,"div",13),r()()(),n(23,"div",1)(24,"div",8)(25,"div",9)(26,"label",16),s(27,"Cantidad de Huevos *"),r(),h(28,"input",17),u(29,ae,3,2,"div",13),r()(),n(30,"div",8)(31,"div",9)(32,"label",18),s(33,"Calidad"),r(),n(34,"ng-select",19),u(35,ne,2,2,"ng-option",12),r()()()(),n(36,"div",1)(37,"div",20)(38,"div",21)(39,"button",22),E("click",function(){return t.onCancel()}),s(40," Cancelar "),r(),n(41,"button",23),u(42,le,1,0,"span",24),s(43),r()()()()()()()()()),o&2){let m,v,f,b,_,C;F("btn btn-secondary"),d("title",t.isEditing?"Editar Control":"Nuevo Control")("title2","Volver a Lista")("class1","")("path","/dashboard/production-dashboard/huevos"),a(8),d("formGroup",t.controlForm),a(6),S("is-invalid",((m=t.controlForm.get("idLote"))==null?null:m.invalid)&&((m=t.controlForm.get("idLote"))==null?null:m.touched)),a(),d("ngForOf",t.lotes),a(),d("ngIf",((v=t.controlForm.get("idLote"))==null?null:v.invalid)&&((v=t.controlForm.get("idLote"))==null?null:v.touched)),a(5),S("is-invalid",((f=t.controlForm.get("fecha"))==null?null:f.invalid)&&((f=t.controlForm.get("fecha"))==null?null:f.touched)),a(),d("ngIf",((b=t.controlForm.get("fecha"))==null?null:b.invalid)&&((b=t.controlForm.get("fecha"))==null?null:b.touched)),a(6),S("is-invalid",((_=t.controlForm.get("cantidadHuevos"))==null?null:_.invalid)&&((_=t.controlForm.get("cantidadHuevos"))==null?null:_.touched)),a(),d("ngIf",((C=t.controlForm.get("cantidadHuevos"))==null?null:C.invalid)&&((C=t.controlForm.get("cantidadHuevos"))==null?null:C.touched)),a(6),d("ngForOf",t.calidades),a(4),d("disabled",t.loading),a(2),d("disabled",t.loading||t.controlForm.invalid),a(),d("ngIf",t.loading),a(),N(" ",t.isEditing?"Actualizar":"Crear"," Control ")}},dependencies:[w,x,A,X,K,W,U,Q,j,$,V,q,G,D,O,z,P,R]});let i=l;return i})();export{Ee as NewHuevoComponent};
