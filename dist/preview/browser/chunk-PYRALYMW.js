import{a as $}from"./chunk-RV2TP37N.js";import{a as Y}from"./chunk-5G2KFST2.js";import"./chunk-IORNA22M.js";import{c as z,n as X}from"./chunk-L3BSSDS5.js";import{a as J,b as K,c as Q}from"./chunk-S5Y45Y7X.js";import"./chunk-TZ522SJ7.js";import{r as Z}from"./chunk-P6RHK3TE.js";import"./chunk-LAI4YRFV.js";import{c as O,g as U,l as q,x as G}from"./chunk-I6FKYEZO.js";import{$b as _,Cb as I,Ib as u,Kb as S,Qa as l,Qc as R,Ra as f,Wb as n,Wc as j,Xb as g,Yb as T,Zb as k,ac as C,bc as v,db as b,dc as W,fc as M,jb as h,la as w,ld as V,nb as L,nc as D,od as A,qc as N,rb as E,tb as B,ua as F,ub as x,va as H,vb as y,wb as e,xb as t,yb as p,yc as P}from"./chunk-W3KPMJ6O.js";import"./chunk-REZWHGN7.js";var ee=(o,d)=>d.id,te=o=>["../view",o],ie=o=>["../edit",o];function ne(o,d){if(o&1&&(e(0,"ng-option",14),n(1),t()),o&2){let a=d.$implicit;h("value",a.id.toString()),l(),g(a.galera)}}function re(o,d){if(o&1&&(e(0,"ng-option",14),n(1),t()),o&2){let a=d.$implicit;h("value",a),l(),g(a)}}function oe(o,d){o&1&&(e(0,"div",31)(1,"div",33)(2,"span",34),n(3,"Cargando..."),t()()())}function ae(o,d){o&1&&(e(0,"tr")(1,"td",36)(2,"div",37),p(3,"i",38),e(4,"p"),n(5,"No hay controles disponibles"),t()()()())}function le(o,d){if(o&1){let a=I();e(0,"tr")(1,"td"),n(2),t(),e(3,"td"),n(4),D(5,"date"),t(),e(6,"td")(7,"div",24)(8,"span",39),p(9,"i",40),t(),e(10,"div")(11,"h6",41),n(12),t(),e(13,"span",42),n(14),t()()()(),e(15,"td",43),n(16),t(),e(17,"td")(18,"span",44),n(19),t()(),e(20,"td"),n(21),t(),e(22,"td")(23,"div",45)(24,"a",46),p(25,"i",47),t(),e(26,"a",48),p(27,"i",49),t(),e(28,"a",50),u("click",function(){let m=F(a).$implicit,i=S(3);return H(i.deleteControl(m.id))}),p(29,"i",51),t()()()()}if(o&2){let a=d.$implicit,r=S(3);l(2),T("#CH-",a.id.toString().padStart(3,"0"),""),l(2),g(N(5,12,a.fecha,"dd/MM/yyyy","UTC")),l(8),g(a.lote==null?null:a.lote.galera),l(2),g(a.lote==null?null:a.lote.tipo),l(2),g(a.cantidadHuevos),l(2),L("bg-"+r.getCalidadBadgeColor(a.calidad)+"-transparent"),l(),T(" ",a.calidad||"Sin especificar"," "),l(2),k("",a.usuario==null?null:a.usuario.nombre," ",a.usuario==null?null:a.usuario.apellido,""),l(3),h("routerLink",M(16,te,a.id)),l(2),h("routerLink",M(18,ie,a.id))}}function se(o,d){if(o&1&&x(0,le,30,20,"tr",null,ee),o&2){let a=S(2);y(a.filteredControles)}}function de(o,d){if(o&1&&(e(0,"div",32)(1,"table",35)(2,"thead")(3,"tr")(4,"th"),n(5,"#ID"),t(),e(6,"th"),n(7,"Fecha"),t(),e(8,"th"),n(9,"Lote/Galera"),t(),e(10,"th"),n(11,"Cantidad Huevos"),t(),e(12,"th"),n(13,"Calidad"),t(),e(14,"th"),n(15,"Usuario"),t(),e(16,"th"),n(17,"Acciones"),t()()(),e(18,"tbody"),b(19,ae,6,0,"tr")(20,se,2,0),t()()()),o&2){let a=S();l(19),E(a.filteredControles.length===0?19:20)}}var Le=(()=>{let d=class d{constructor(r,m,i,c){this.huevosService=r,this.lotesService=m,this.cdr=i,this.toastr=c,this.controles=[],this.filteredControles=[],this.lotes=[],this.isLoading=!1,this.searchTerm="",this.selectedLote="",this.selectedCalidad="",this.selectedFecha="",this.calidades=["Excelente","Buena","Regular","Mala"]}ngOnInit(){this.loadControles(),this.loadLotes()}loadControles(){this.isLoading=!0,this.huevosService.getControles().subscribe({next:r=>{this.controles=r.data.items,this.filteredControles=[...this.controles],this.isLoading=!1,this.cdr.detectChanges()},error:r=>{this.toastr.error("Error al cargar controles de huevos","Error",{progressBar:!0,closeButton:!0}),this.isLoading=!1,this.cdr.detectChanges()}})}loadLotes(){this.lotesService.getLotes().subscribe({next:r=>{this.lotes=r.data.data.filter(m=>m.tipo==="Ponedoras"&&m.estado==="Activo"),this.cdr.detectChanges()},error:r=>{console.error("Error al cargar lotes:",r)}})}applyFilters(){this.filteredControles=this.controles.filter(r=>{let m=!this.searchTerm||r.lote?.galera.toLowerCase().includes(this.searchTerm.toLowerCase())||r.usuario?.nombre.toLowerCase().includes(this.searchTerm.toLowerCase())||r.usuario?.apellido.toLowerCase().includes(this.searchTerm.toLowerCase()),i=!this.selectedLote||r.idLote.toString()===this.selectedLote,c=!this.selectedCalidad||r.calidad===this.selectedCalidad,s=!this.selectedFecha||new Date(r.fecha).toDateString()===new Date(this.selectedFecha).toDateString();return m&&i&&c&&s}),this.cdr.detectChanges()}deleteControl(r){confirm("\xBFEst\xE1 seguro de eliminar este control?")&&this.huevosService.deleteControl(r).subscribe({next:()=>{this.toastr.success("Control eliminado exitosamente","\xC9xito",{progressBar:!0,closeButton:!0}),this.loadControles()},error:()=>{this.toastr.error("Error al eliminar control","Error",{progressBar:!0,closeButton:!0})}})}formatDateForInput(r){return r?new Date(r+"T00:00:00.000Z").toISOString().split("T")[0]:""}getCalidadClass(r){switch(r){case"Excelente":return"text-success";case"Buena":return"text-info";case"Regular":return"text-warning";case"Mala":return"text-danger";default:return"text-muted"}}getCalidadBadgeColor(r){switch(r){case"Excelente":return"success";case"Buena":return"info";case"Regular":return"warning";case"Mala":return"danger";default:return"secondary"}}clearFilters(){this.searchTerm="",this.selectedLote="",this.selectedCalidad="",this.selectedFecha="",this.filteredControles=[...this.controles],this.cdr.detectChanges()}};d.\u0275fac=function(m){return new(m||d)(f($),f(Y),f(P),f(Z))},d.\u0275cmp=w({type:d,selectors:[["app-huevo-list"]],standalone:!0,features:[W],decls:66,vars:14,consts:[[3,"title","title2","class1","path"],[1,"row"],[1,"col-xl-12","col-md-12","col-lg-12"],[1,"card","custom-card"],[1,"card-header","d-flex","justify-content-between","border-bottom-0"],[1,"card-title"],[1,"float-end"],["type","text","placeholder","buscar",1,"form-control",3,"ngModelChange","input","ngModel"],[1,"card-body"],[1,"col-md-12","col-lg-7"],[1,"col-md-4"],[1,"form-group"],[1,"form-label"],["placeholder","Filtrar por lote",1,"form-control","p-0",3,"ngModelChange","change","ngModel","clearable"],[3,"value"],["placeholder","Filtrar por calidad",1,"form-control","p-0",3,"ngModelChange","change","ngModel","clearable"],["type","date","placeholder","Filtrar por fecha",1,"form-control",3,"ngModelChange","change","ngModel"],[1,"col-md-2"],[1,"form-group","mt-2"],[1,"btn","btn-primary","d-grid",3,"click"],[1,"col-md-3"],[1,"btn","btn-outline-secondary","d-grid",3,"click"],[1,"card-body","border-top"],[1,"col-sm-6","mb-1"],[1,"d-flex","align-items-center"],[1,"d-flex","ms-2","mx-2"],["name","quantity","placeholder","10",1,"form-control","wd-150","p-0"],["value","10"],["value","25"],["value","50"],["value","100"],[1,"text-center","py-4"],[1,"table-responsive"],["role","status",1,"spinner-border"],[1,"visually-hidden"],[1,"table","table-vcenter","text-nowrap","table-bordered","border-bottom"],["colspan","7",1,"text-center","py-4"],[1,"text-muted"],[1,"fe","fe-inbox","fs-24","mb-2"],[1,"avatar","avatar-md","me-2","avatar-rounded","bg-primary-transparent"],[1,"fe","fe-layers"],[1,"mb-1","fs-14"],[1,"fs-12","text-muted"],[1,"fw-bold","text-primary"],[1,"badge"],[1,"d-flex"],["placement","top","ngbTooltip","Ver Control",1,"action-btns1",3,"routerLink"],[1,"fe","fe-eye","text-primary"],["placement","top","ngbTooltip","Editar",1,"action-btns1",3,"routerLink"],[1,"fe","fe-edit-2","text-success"],["placement","top","ngbTooltip","Eliminar",1,"action-btns1",3,"click"],[1,"fe","fe-trash","text-danger"]],template:function(m,i){m&1&&(p(0,"app-hr-dashboard-page-header",0),e(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4)(5,"h4",5),n(6,"Resumen de Control de Huevos"),t(),e(7,"div",6)(8,"input",7),v("ngModelChange",function(s){return C(i.searchTerm,s)||(i.searchTerm=s),s}),u("input",function(){return i.applyFilters()}),t()()(),e(9,"div",8)(10,"div",1)(11,"div",9)(12,"div",1)(13,"div",10)(14,"div",11)(15,"label",12),n(16,"Lote:"),t(),e(17,"ng-select",13),v("ngModelChange",function(s){return C(i.selectedLote,s)||(i.selectedLote=s),s}),u("change",function(){return i.applyFilters()}),x(18,ne,2,2,"ng-option",14,ee),t()()(),e(20,"div",10)(21,"div",11)(22,"label",12),n(23,"Calidad:"),t(),e(24,"ng-select",15),v("ngModelChange",function(s){return C(i.selectedCalidad,s)||(i.selectedCalidad=s),s}),u("change",function(){return i.applyFilters()}),x(25,re,2,2,"ng-option",14,B),t()()(),e(27,"div",10)(28,"div",11)(29,"label",12),n(30,"Fecha:"),t(),e(31,"input",16),v("ngModelChange",function(s){return C(i.selectedFecha,s)||(i.selectedFecha=s),s}),u("change",function(){return i.applyFilters()}),t()()()()(),e(32,"div",17)(33,"div",18),p(34,"label",12),e(35,"button",19),u("click",function(){return i.applyFilters()}),n(36,"Buscar"),t()()(),e(37,"div",20)(38,"div",18),p(39,"label",12),e(40,"button",21),u("click",function(){return i.clearFilters()}),n(41,"Limpiar"),t()()()()(),e(42,"div",22)(43,"div",1)(44,"div",23)(45,"div",24)(46,"span"),n(47,"Mostrar"),t(),e(48,"div",25)(49,"div",11)(50,"ng-select",26)(51,"ng-option",27),n(52,"10"),t(),e(53,"ng-option",28),n(54,"25"),t(),e(55,"ng-option",29),n(56,"50"),t(),e(57,"ng-option",30),n(58,"100"),t()()()(),e(59,"span"),n(60,"entradas"),t()()(),e(61,"div",23)(62,"div",6)(63,"input",7),v("ngModelChange",function(s){return C(i.searchTerm,s)||(i.searchTerm=s),s}),u("input",function(){return i.applyFilters()}),t()()()(),b(64,oe,4,0,"div",31)(65,de,21,1,"div",32),t()()()()),m&2&&(L("btn btn-primary"),h("title","Control de Huevos")("title2","Nuevo Control")("class1","")("path","../new"),l(8),_("ngModel",i.searchTerm),l(9),_("ngModel",i.selectedLote),h("clearable",!0),l(),y(i.lotes),l(6),_("ngModel",i.selectedCalidad),h("clearable",!0),l(),y(i.calidades),l(6),_("ngModel",i.selectedFecha),l(32),_("ngModel",i.searchTerm),l(),E(i.isLoading?64:65))},dependencies:[X,z,j,R,A,V,G,O,U,q,Q,K,J]});let o=d;return o})();export{Le as HuevoListComponent};
