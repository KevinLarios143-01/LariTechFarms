import{a as L}from"./chunk-LPDJMIYN.js";import{a as R}from"./chunk-ARNF3ISK.js";import"./chunk-IORNA22M.js";import{n as z}from"./chunk-FG6B37U2.js";import{a as M,b as A,c as G}from"./chunk-S5Y45Y7X.js";import"./chunk-35J6RYA3.js";import{r as j}from"./chunk-P6RHK3TE.js";import"./chunk-LAI4YRFV.js";import{c as I,e as v,g as w,h as V,m as O,n as P,p as B,q as D,w as k,y as q}from"./chunk-I6FKYEZO.js";import{Ib as f,Kb as E,Qa as s,Ra as m,Wb as o,Xb as x,Yb as C,db as u,dc as F,id as y,jb as g,kd as T,la as b,rb as p,ub as S,vb as _,wb as n,xb as e,yb as h,yc as N}from"./chunk-W3KPMJ6O.js";import"./chunk-REZWHGN7.js";var K=(a,r)=>r.id;function Q(a,r){a&1&&(n(0,"div",14)(1,"div",19)(2,"span",20),o(3,"Cargando..."),e()()())}function U(a,r){if(a&1&&(n(0,"ng-option",25),o(1),e()),a&2){let c=r.$implicit;g("value",c.id),s(),C(" ",c.nombre," ")}}function W(a,r){a&1&&(n(0,"div",26)(1,"small"),o(2,"Debe seleccionar un cliente"),e()())}function X(a,r){a&1&&(n(0,"div",26)(1,"small"),o(2,"La fecha es requerida"),e()())}function Y(a,r){a&1&&(n(0,"div",26)(1,"small"),o(2,"El total es requerido"),e()())}function Z(a,r){a&1&&(n(0,"div",26)(1,"small"),o(2,"El estado es requerido"),e()())}function ee(a,r){if(a&1&&(n(0,"div",8)(1,"div",21)(2,"div",22)(3,"label",23),o(4,"Cliente *"),e(),n(5,"ng-select",24),S(6,U,2,2,"ng-option",25,K),e(),u(8,W,3,0,"div",26),e()(),n(9,"div",21)(10,"div",22)(11,"label",23),o(12,"Fecha *"),e(),h(13,"input",27),u(14,X,3,0,"div",26),e()(),n(15,"div",21)(16,"div",22)(17,"label",23),o(18,"Total *"),e(),h(19,"input",28),u(20,Y,3,0,"div",26),e()(),n(21,"div",21)(22,"div",22)(23,"label",23),o(24,"M\xE9todo de Pago"),e(),n(25,"ng-select",29)(26,"ng-option",30),o(27,"Efectivo"),e(),n(28,"ng-option",31),o(29,"Tarjeta"),e(),n(30,"ng-option",32),o(31,"Transferencia"),e(),n(32,"ng-option",33),o(33,"Cheque"),e()()()(),n(34,"div",21)(35,"div",22)(36,"label",23),o(37,"Estado *"),e(),n(38,"ng-select",34)(39,"ng-option",35),o(40,"Pendiente"),e(),n(41,"ng-option",36),o(42,"Completada"),e(),n(43,"ng-option",37),o(44,"Cancelada"),e()(),u(45,Z,3,0,"div",26),e()(),n(46,"div",38)(47,"div",22)(48,"label",23),o(49,"Observaciones"),e(),h(50,"textarea",39),e()()()),a&2){let c,i,t,l,d=E();s(6),_(d.clientes),s(2),p((c=d.ventaForm.get("idCliente"))!=null&&c.invalid&&((c=d.ventaForm.get("idCliente"))!=null&&c.touched)?8:-1),s(6),p((i=d.ventaForm.get("fecha"))!=null&&i.invalid&&((i=d.ventaForm.get("fecha"))!=null&&i.touched)?14:-1),s(6),p((t=d.ventaForm.get("total"))!=null&&t.invalid&&((t=d.ventaForm.get("total"))!=null&&t.touched)?20:-1),s(25),p((l=d.ventaForm.get("estado"))!=null&&l.invalid&&((l=d.ventaForm.get("estado"))!=null&&l.touched)?45:-1)}}function te(a,r){a&1&&h(0,"span",18)}var ue=(()=>{let r=class r{constructor(i,t,l,d,$,H,J){this.fb=i,this.ventaService=t,this.clienteService=l,this.router=d,this.route=$,this.toastr=H,this.cdr=J,this.loading=!1,this.isEditing=!1,this.ventaId=null,this.clientes=[],this.ventaForm=this.fb.group({idCliente:["",[v.required,v.min(1)]],fecha:["",v.required],total:["",[v.required,v.min(0)]],metodoPago:[""],estado:["Pendiente",v.required],observaciones:[""]})}ngOnInit(){let i=new Date().toISOString().split("T")[0];this.ventaForm.patchValue({fecha:i}),this.route.queryParams.subscribe(t=>{t.id&&t.mode==="edit"&&(this.isEditing=!0,this.ventaId=+t.id,this.loadVenta())}),this.loadClientes()}loadVenta(){this.ventaId&&(this.loading=!0,this.ventaService.getVentaById(this.ventaId).subscribe({next:i=>{let t=i.data;this.ventaForm.patchValue({idCliente:t.idCliente,fecha:this.formatDateForInput(t.fecha),total:t.total,metodoPago:t.metodoPago,estado:t.estado,observaciones:t.observaciones}),this.loading=!1,this.cdr.detectChanges()},error:i=>{console.error("Error loading venta:",i),this.toastr.error("Error al cargar la venta","Error",{timeOut:3e3,positionClass:"toast-top-right",progressBar:!0,closeButton:!0}),this.loading=!1,this.cdr.detectChanges()}}))}onSubmit(){if(this.ventaForm.valid){this.loading=!0;let i=this.ventaForm.value;this.isEditing&&this.ventaId?this.ventaService.updateVenta(this.ventaId,i).subscribe({next:()=>{this.toastr.success("Venta actualizada exitosamente","\xC9xito",{timeOut:3e3,positionClass:"toast-top-right",progressBar:!0,closeButton:!0}),this.router.navigate(["/dashboard/business-dashboard/sell-list"]),this.loading=!1},error:t=>{this.toastr.error("Error al actualizar la venta: "+(t.error?.message||"Error desconocido"),"Error",{timeOut:5e3,positionClass:"toast-top-right",progressBar:!0,closeButton:!0}),this.loading=!1}}):this.ventaService.createVenta(i).subscribe({next:()=>{this.toastr.success("Venta creada exitosamente","\xC9xito",{timeOut:3e3,positionClass:"toast-top-right",progressBar:!0,closeButton:!0}),this.router.navigate(["/dashboard/business-dashboard/sell-list"]),this.loading=!1},error:t=>{this.toastr.error("Error al crear la venta: "+(t.error?.message||"Error desconocido"),"Error",{timeOut:5e3,positionClass:"toast-top-right",progressBar:!0,closeButton:!0}),this.loading=!1}})}else this.markFormGroupTouched(),this.toastr.warning("Por favor, complete todos los campos requeridos","Advertencia",{timeOut:3e3,positionClass:"toast-top-right",progressBar:!0,closeButton:!0})}onCancel(){this.router.navigate(["/dashboard/business-dashboard/sell-list"])}formatDateForInput(i){return i?new Date(i).toISOString().split("T")[0]:""}loadClientes(){this.clienteService.getClientes().subscribe({next:i=>{let t=i?.data?.data||i?.data||i||[];this.clientes=Array.isArray(t)?t:[]},error:i=>{console.error("Error loading clientes:",i),this.clientes=[]}})}markFormGroupTouched(){Object.keys(this.ventaForm.controls).forEach(i=>{this.ventaForm.get(i)?.markAsTouched()})}};r.\u0275fac=function(t){return new(t||r)(m(k),m(L),m(R),m(T),m(y),m(j),m(N))},r.\u0275cmp=b({type:r,selectors:[["app-new-sell"]],standalone:!0,features:[F],decls:25,vars:7,consts:[[1,"page-header","d-lg-flex","d-block"],[1,"page-leftheader"],[1,"page-title"],[1,"page-rightheader"],[1,"btn-list","d-flex","gap-1"],[1,"btn","btn-outline-primary",3,"click"],[1,"fe","fe-arrow-left","fs-12","my-auto","me-2"],[3,"ngSubmit","formGroup"],[1,"row"],[1,"col-xl-12"],[1,"card","custom-card"],[1,"card-header"],[1,"card-title"],[1,"card-body"],[1,"text-center","py-4"],[1,"card-footer","text-end"],["type","button",1,"btn","btn-outline-secondary","me-2",3,"click","disabled"],["type","submit",1,"btn","btn-primary",3,"disabled"],[1,"spinner-border","spinner-border-sm","me-2"],["role","status",1,"spinner-border"],[1,"visually-hidden"],[1,"col-md-6"],[1,"form-group"],[1,"form-label"],["formControlName","idCliente","bindLabel","nombre","bindValue","id","placeholder","Seleccionar cliente"],[3,"value"],[1,"text-danger"],["formControlName","fecha","type","date",1,"form-control"],["formControlName","total","type","number","step","0.01","placeholder","Total de la venta",1,"form-control"],["formControlName","metodoPago","placeholder","Seleccionar m\xE9todo de pago"],["value","Efectivo"],["value","Tarjeta"],["value","Transferencia"],["value","Cheque"],["formControlName","estado","placeholder","Seleccionar estado"],["value","Pendiente"],["value","Completada"],["value","Cancelada"],[1,"col-md-12"],["formControlName","observaciones","rows","3","placeholder","Observaciones adicionales (opcional)",1,"form-control"]],template:function(t,l){t&1&&(n(0,"div",0)(1,"div",1)(2,"div",2),o(3),e()(),n(4,"div",3)(5,"div",4)(6,"button",5),f("click",function(){return l.onCancel()}),h(7,"i",6),o(8,"Volver "),e()()()(),n(9,"form",7),f("ngSubmit",function(){return l.onSubmit()}),n(10,"div",8)(11,"div",9)(12,"div",10)(13,"div",11)(14,"h4",12),o(15,"Informaci\xF3n de la Venta"),e()(),n(16,"div",13),u(17,Q,4,0,"div",14)(18,ee,51,4,"div",8),e(),n(19,"div",15)(20,"button",16),f("click",function(){return l.onCancel()}),o(21," Cancelar "),e(),n(22,"button",17),u(23,te,1,0,"span",18),o(24),e()()()()()()),t&2&&(s(3),x(l.isEditing?"Editar Venta":"Nueva Venta"),s(6),g("formGroup",l.ventaForm),s(8),p(l.loading?17:18),s(3),g("disabled",l.loading),s(2),g("disabled",l.loading),s(),p(l.loading?23:-1),s(),C(" ",l.isEditing?"Actualizar":"Crear"," Venta "))},dependencies:[z,G,A,M,q,O,I,P,w,V,B,D],styles:[".card-title[_ngcontent-%COMP%]{color:#495057;font-weight:600}.form-group[_ngcontent-%COMP%]{margin-bottom:1rem}.text-danger[_ngcontent-%COMP%]   small[_ngcontent-%COMP%]{font-size:.875rem}"]});let a=r;return a})();export{ue as NewSellComponent};
