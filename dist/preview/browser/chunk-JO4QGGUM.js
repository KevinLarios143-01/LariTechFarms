import{a as De}from"./chunk-55ZRRGER.js";import"./chunk-IORNA22M.js";import{f as ue,g as F,h as D,i as fe,j as ye,n as Fe}from"./chunk-USSGZFX3.js";import{a as se,b as ce,c as pe}from"./chunk-XG7TRELF.js";import{Aa as we,oa as _e,pa as he,qa as ge,ra as Ce,sa as ve,ta as Te,ua as ke,va as xe,wa as be,xa as Se,ya as Ee}from"./chunk-2CYZEA6T.js";import{r as le}from"./chunk-3DATYCE5.js";import{b as re,c as de,d as me}from"./chunk-EMEDTLE5.js";import{M as ne,_ as oe,c as U,ca as ae,e as E,g as K,h as J,m as W,n as X,p as Z,q as ee,w as te,y as ie}from"./chunk-XRHNCSTF.js";import{Ab as x,Cb as y,Ib as g,Kb as T,Ob as q,Qa as d,Qb as M,Qc as j,Ra as S,Rb as V,Sb as A,Vb as N,Wb as o,Xb as b,Yb as I,cc as H,db as f,dc as P,ec as $,jb as C,la as R,lb as w,ld as Q,nc as O,ob as z,od as B,pc as G,rb as v,rc as Y,ua as _,va as h,wb as t,xb as e,yb as p,zb as k}from"./chunk-AZAYKVK3.js";import"./chunk-REZWHGN7.js";var Le=()=>[8,10,25,100];function Me(i,l){i&1&&(t(0,"div",55)(1,"div",58)(2,"span",59),o(3,"Cargando..."),e()(),t(4,"p",60),o(5,"Cargando tickets..."),e()())}function Ve(i,l){i&1&&(t(0,"th",73),o(1,"#ID"),e())}function Ae(i,l){if(i&1&&(t(0,"td",74),o(1),e()),i&2){let r=l.$implicit;d(),b(r.No)}}function Ne(i,l){i&1&&(t(0,"th",73),o(1,"C\xF3digo"),e())}function Ie(i,l){if(i&1&&(t(0,"td",74)(1,"div",46)(2,"span",75),p(3,"i",76),e(),t(4,"div")(5,"h6",77),o(6),e(),t(7,"span",78),o(8),e()()()()),i&2){let r=l.$implicit;d(6),b(r.codigo),d(2),I("Ticket #",r.id,"")}}function Re(i,l){i&1&&(t(0,"th",73),o(1,"Fecha"),e())}function ze(i,l){if(i&1&&(t(0,"td",74),o(1),O(2,"date"),e()),i&2){let r=l.$implicit;d(),b(G(2,1,r.fecha,"dd/MM/yyyy"))}}function qe(i,l){i&1&&(t(0,"th",73),o(1,"Cantidad"),e())}function He(i,l){if(i&1&&(t(0,"td",74),o(1),e()),i&2){let r=l.$implicit;d(),b(r.cantidad)}}function Pe(i,l){i&1&&(t(0,"th",73),o(1,"Estado"),e())}function $e(i,l){if(i&1&&(t(0,"td",74)(1,"span"),o(2),e()()),i&2){let r=l.$implicit;d(),z("badge bg-",r.status,"-transparent"),d(),b(r.statusText)}}function Oe(i,l){i&1&&(t(0,"th",79),o(1,"Acciones"),e())}function Ge(i,l){if(i&1){let r=y();t(0,"td",74)(1,"div",80)(2,"a",81),p(3,"i",82),e(),t(4,"a",83),g("click",function(){let n=_(r).$implicit,m=T(2),s=N(95);return h(m.edit(s,n))}),p(5,"i",84),e(),t(6,"a",85),g("click",function(){let n=_(r).$implicit,m=T(2);return h(m.deleteTicket(n.id))}),p(7,"i",86),e()()()}if(i&2){let r=l.$implicit;d(2),q("routerLink","/dashboard/business-dashboard/view-ticket/",r.id,"")}}function Ye(i,l){i&1&&p(0,"tr",87)}function je(i,l){i&1&&p(0,"tr",88)}function Qe(i,l){if(i&1&&(t(0,"tr",89)(1,"td",90),o(2),e()()),i&2){T(2);let r=N(89);d(2),I('No hay datos que coincidan con el filtro "',r.value,'"')}}function Be(i,l){if(i&1&&(t(0,"table",56),k(1,61),f(2,Ve,2,0,"th",62)(3,Ae,2,1,"td",63),x(),k(4,64),f(5,Ne,2,0,"th",62)(6,Ie,9,2,"td",63),x(),k(7,65),f(8,Re,2,0,"th",62)(9,ze,3,4,"td",63),x(),k(10,66),f(11,qe,2,0,"th",62)(12,He,2,1,"td",63),x(),k(13,67),f(14,Pe,2,0,"th",62)(15,$e,3,4,"td",63),x(),k(16,68),f(17,Oe,2,0,"th",69)(18,Ge,8,2,"td",63),x(),f(19,Ye,1,0,"tr",70)(20,je,1,0,"tr",71)(21,Qe,3,1,"tr",72),e()),i&2){let r=T();C("dataSource",r.dataSource),d(19),C("matHeaderRowDef",r.displayedColumns),d(),C("matRowDefColumns",r.displayedColumns)}}function Ue(i,l){i&1&&(t(0,"div",100),o(1," El estado es requerido "),e())}function Ke(i,l){i&1&&(t(0,"span"),o(1,"La cantidad es requerida"),e())}function Je(i,l){i&1&&(t(0,"span"),o(1,"La cantidad debe ser mayor a 0"),e())}function We(i,l){if(i&1&&(t(0,"div",100),f(1,Ke,2,0,"span")(2,Je,2,0,"span"),e()),i&2){let r,a,n=T(2);d(),v(!((r=n.editForm.get("cantidad"))==null||r.errors==null)&&r.errors.required?1:-1),d(),v(!((a=n.editForm.get("cantidad"))==null||a.errors==null)&&a.errors.min?2:-1)}}function Xe(i,l){i&1&&(t(0,"div",100),o(1," El c\xF3digo de autorizaci\xF3n es requerido "),e())}function Ze(i,l){i&1&&p(0,"span",107)}function et(i,l){if(i&1){let r=y();t(0,"form",91),g("ngSubmit",function(){_(r);let n=T();return h(n.onUpdateTicket())}),t(1,"div",92)(2,"h5",93),o(3,"Editar Ticket"),e(),t(4,"button",94),g("click",function(){let n=_(r).$implicit;return h(n.dismiss("Cross click"))}),e()(),t(5,"div",95)(6,"div",15)(7,"div",25)(8,"div",26)(9,"label",27),o(10,"Estado *"),e(),t(11,"ng-select",96)(12,"ng-option",97),o(13,"Pendiente"),e(),t(14,"ng-option",98),o(15,"Completado"),e(),t(16,"ng-option",99),o(17,"Cancelado"),e()(),f(18,Ue,2,0,"div",100),e()(),t(19,"div",25)(20,"div",26)(21,"label",27),o(22,"Cantidad *"),e(),p(23,"input",101),f(24,We,3,2,"div",100),e()(),t(25,"div",102)(26,"div",26)(27,"label",27),o(28,"C\xF3digo de Autorizaci\xF3n *"),e(),p(29,"input",103),f(30,Xe,2,0,"div",100),e()()()(),t(31,"div",104)(32,"button",105),g("click",function(){let n=_(r).$implicit;return h(n.dismiss("cancel"))}),o(33,"Cancelar"),e(),t(34,"button",106),f(35,Ze,1,0,"span",107),o(36," Actualizar "),e()()()}if(i&2){let r,a,n,m,s,u,c=T();C("formGroup",c.editForm),d(11),w("is-invalid",((r=c.editForm.get("estado"))==null?null:r.invalid)&&((r=c.editForm.get("estado"))==null?null:r.touched)),d(7),v((a=c.editForm.get("estado"))!=null&&a.invalid&&((a=c.editForm.get("estado"))!=null&&a.touched)?18:-1),d(5),w("is-invalid",((n=c.editForm.get("cantidad"))==null?null:n.invalid)&&((n=c.editForm.get("cantidad"))==null?null:n.touched)),d(),v((m=c.editForm.get("cantidad"))!=null&&m.invalid&&((m=c.editForm.get("cantidad"))!=null&&m.touched)?24:-1),d(5),w("is-invalid",((s=c.editForm.get("codigoAutorizacion"))==null?null:s.invalid)&&((s=c.editForm.get("codigoAutorizacion"))==null?null:s.touched)),d(),v((u=c.editForm.get("codigoAutorizacion"))!=null&&u.invalid&&((u=c.editForm.get("codigoAutorizacion"))!=null&&u.touched)?30:-1),d(4),C("disabled",c.loading),d(),v(c.loading?35:-1)}}var St=(()=>{let l=class l{constructor(a,n,m,s){this.modalService=a,this.ticketService=n,this.fb=m,this.toastr=s,this.displayedColumns=["ID","Codigo","Fecha","Cantidad","Estado","Action"],this.tickets=[],this.filteredTickets=[],this.loading=!1,this.selectedTicket=null,this.dataSource=new we([]),this.editForm=this.fb.group({estado:["",E.required],codigoAutorizacion:["",E.required],cantidad:["",[E.required,E.min(1)]]}),this.filterForm=this.fb.group({fechaDesde:[""],fechaHasta:[""],estado:[""]})}ngOnInit(){this.loadTickets()}ngAfterViewInit(){this.dataSource.paginator=this.paginator,this.dataSource.sort=this.sort}applyFilter(a){let n=a.target.value;this.dataSource.filter=n.trim().toLowerCase(),this.dataSource.paginator&&this.dataSource.paginator.firstPage()}edit(a,n){this.selectedTicket=this.tickets.find(m=>m.id===n.id)||null,this.selectedTicket&&this.editForm.patchValue({estado:this.selectedTicket.estado,codigoAutorizacion:this.selectedTicket.codigoAutorizacion,cantidad:this.selectedTicket.cantidad}),this.modalService.open(a,{windowClass:"modalCusSty modal-lg"})}onUpdateTicket(){if(this.editForm.valid&&this.selectedTicket){this.loading=!0;let a=this.editForm.value;this.ticketService.updateTicket(this.selectedTicket.id,a).subscribe({next:()=>{this.toastr.success("Ticket actualizado exitosamente","\xC9xito",{timeOut:3e3,positionClass:"toast-top-right"}),this.loadTickets(),this.modalService.dismissAll(),this.loading=!1},error:n=>{this.toastr.error("Error al actualizar el ticket: "+(n.error?.message||"Error desconocido"),"Error",{timeOut:3e3,positionClass:"toast-top-right"}),this.loading=!1}})}else this.toastr.warning("Por favor, complete todos los campos requeridos","Advertencia",{timeOut:3e3,positionClass:"toast-top-right"}),this.markFormGroupTouched()}deleteTicket(a){confirm("\xBFEst\xE1 seguro de que desea eliminar este ticket?")&&this.ticketService.deleteTicket(a).subscribe({next:()=>{this.toastr.success("Ticket eliminado exitosamente","\xC9xito",{timeOut:3e3,positionClass:"toast-top-right"}),this.loadTickets()},error:n=>{this.toastr.error("Error al eliminar el ticket: "+(n.error?.message||"Error desconocido"),"Error",{timeOut:3e3,positionClass:"toast-top-right"})}})}markFormGroupTouched(){Object.keys(this.editForm.controls).forEach(a=>{this.editForm.get(a)?.markAsTouched()})}loadTickets(){this.loading=!0,this.ticketService.getTickets().subscribe({next:a=>{console.log("Tickets loaded:",a),this.tickets=a||[],this.filteredTickets=[...this.tickets],this.dataSource.data=this.mapTicketsToDisplay(this.filteredTickets),this.loading=!1},error:a=>{console.error("Error loading tickets:",a),this.toastr.error("Error al cargar los tickets","Error"),this.tickets=[],this.dataSource.data=[],this.loading=!1}})}mapTicketsToDisplay(a){return!a||!Array.isArray(a)?[]:a.map(n=>({id:n.id,No:`#TK-${String(n.id).padStart(3,"0")}`,codigo:n.codigoAutorizacion,fecha:n.fecha,cantidad:n.cantidad,estado:n.estado,statusText:n.estado,status:this.getStatusClass(n.estado)}))}applyFilters(){let{fechaDesde:a,fechaHasta:n,estado:m}=this.filterForm.value;this.filteredTickets=this.tickets.filter(s=>{let u=!0;if(a){let c=new Date(s.fecha),L=new Date(a);u=u&&c>=L}if(n){let c=new Date(s.fecha),L=new Date(n);u=u&&c<=L}return m&&(u=u&&s.estado.toLowerCase()===m.toLowerCase()),u}),this.dataSource.data=this.mapTicketsToDisplay(this.filteredTickets)}clearFilters(){this.filterForm.reset(),this.filteredTickets=[...this.tickets],this.dataSource.data=this.mapTicketsToDisplay(this.filteredTickets)}getStatusClass(a){switch(a.toLowerCase()){case"completado":return"success";case"pendiente":return"warning";case"cancelado":return"danger";default:return"secondary"}}};l.\u0275fac=function(n){return new(n||l)(S(ne),S(De),S(te),S(le))},l.\u0275cmp=R({type:l,selectors:[["app-ticket-list"]],viewQuery:function(n,m){if(n&1&&(M(F,5),M(D,5)),n&2){let s;V(s=A())&&(m.paginator=s.first),V(s=A())&&(m.sort=s.first)}},standalone:!0,features:[H([re]),P],decls:96,vars:4,consts:[["input",""],["editContent",""],[1,"page-header","d-lg-flex","d-block"],[1,"page-leftheader"],[1,"page-title"],[1,"page-rightheader"],[1,"btn-list","d-flex","gap-1"],["routerLink","/dashboard/business-dashboard/new-ticket",1,"btn","btn-primary"],[1,"fe","fe-plus","fs-12","my-auto","me-2"],["data-bs-toggle","tooltip","data-bs-placement","top","title","E-mail",1,"btn","btn-light3"],[1,"fe","fe-mail"],["data-bs-placement","top","data-bs-toggle","tooltip","title","Contact",1,"btn","btn-light3"],[1,"fe","fe-phone-call"],["data-bs-placement","top","data-bs-toggle","tooltip","title","Info",1,"btn","btn-primary"],[1,"fe","fe-info"],[1,"row"],[1,"col-xl-12","col-md-12","col-lg-12"],[1,"card","custom-card"],[1,"card-header","d-flex","justify-content-between","border-bottom-0"],[1,"card-title"],[1,"float-end"],["type","text","placeholder","buscar",1,"form-control"],[1,"card-body"],[3,"formGroup"],[1,"col-md-12","col-lg-7"],[1,"col-md-6"],[1,"form-group"],[1,"form-label"],[1,"input-group"],[1,"input-group-text","text-muted"],[1,"ri-calendar-line"],["mwlFlatpickr","","type","text","placeholder","DD-MM-YYYY","formControlName","fechaDesde",1,"form-control","choose-date"],["mwlFlatpickr","","type","text","placeholder","DD-MM-YYYY","formControlName","fechaHasta",1,"form-control","choose-date"],[1,"col-md-3"],["formControlName","estado","placeholder","Seleccionar Estado",1,"form-control","custom-select","p-0"],["value",""],["value","pendiente"],["value","completado"],["value","cancelado"],[1,"col-md-2"],[1,"form-group","mt-2"],[1,"d-flex","gap-2"],["type","button",1,"btn","btn-primary",3,"click"],["type","button",1,"btn","btn-light",3,"click"],[1,"card-body","border-top"],[1,"col-sm-6","mb-1"],[1,"d-flex","align-items-center"],[1,"d-flex","ms-2","mx-2"],["name","quantity","placeholder","10","data-trigger","",1,"form-control","wd-150","p-0"],["value","10","selected",""],["value","25"],["value","50"],["value","100"],["type","text","matInput","","placeholder","buscar",1,"form-control",3,"keyup"],[1,"table-responsive"],[1,"text-center","p-4"],["mat-table","","matSort","",1,"table","table-vcenter","text-nowrap","table-bordered","border-bottom",3,"dataSource"],["aria-label","Select page of tickets",3,"pageSizeOptions"],["role","status",1,"spinner-border"],[1,"visually-hidden"],[1,"mt-2"],["matColumnDef","ID"],["mat-header-cell","","mat-sort-header","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","Codigo"],["matColumnDef","Fecha"],["matColumnDef","Cantidad"],["matColumnDef","Estado"],["matColumnDef","Action"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["class","mat-row",4,"matNoDataRow"],["mat-header-cell","","mat-sort-header",""],["mat-cell",""],[1,"avatar","avatar-md","me-2","avatar-rounded","bg-primary-transparent"],[1,"fe","fe-file-text"],[1,"mb-1","fs-14"],[1,"fs-12","text-muted"],["mat-header-cell",""],[1,"d-flex"],["placement","top","ngbTooltip","Ver Ticket",1,"action-btns1",3,"routerLink"],[1,"fe","fe-eye","text-primary"],["placement","top","ngbTooltip","Editar",1,"action-btns1",3,"click"],[1,"fe","fe-edit-2","text-success"],["placement","top","ngbTooltip","Eliminar",1,"action-btns1",3,"click"],[1,"fe","fe-trash-2","text-danger"],["mat-header-row",""],["mat-row",""],[1,"mat-row"],["colspan","6",1,"mat-cell"],[3,"ngSubmit","formGroup"],[1,"modal-header"],[1,"modal-title"],["type","button","data-bs-dismiss","modal","aria-label","Close",1,"btn-close",3,"click"],[1,"modal-body"],["formControlName","estado","placeholder","Seleccionar estado",1,"form-control"],["value","Pendiente"],["value","Completado"],["value","Cancelado"],[1,"invalid-feedback"],["formControlName","cantidad","type","number","placeholder","Cantidad",1,"form-control"],[1,"col-md-12"],["formControlName","codigoAutorizacion","placeholder","C\xF3digo de autorizaci\xF3n",1,"form-control"],[1,"modal-footer"],["type","button",1,"btn","btn-outline-primary",3,"click"],["type","submit",1,"btn","btn-success",3,"disabled"],["role","status",1,"spinner-border","spinner-border-sm","me-2"]],template:function(n,m){if(n&1){let s=y();t(0,"div",2)(1,"div",3)(2,"div",4),o(3,"Lista de Tickets"),e()(),t(4,"div",5)(5,"div",6)(6,"a",7),p(7,"i",8),o(8,"Agregar Ticket "),e(),t(9,"button",9),p(10,"i",10),e(),t(11,"button",11),p(12,"i",12),e(),t(13,"button",13),p(14,"i",14),e()()()(),t(15,"div",15)(16,"div",16)(17,"div",17)(18,"div",18)(19,"h4",19),o(20,"Resumen de Tickets"),e(),t(21,"div",20),p(22,"input",21),e()(),t(23,"div",22)(24,"form",23)(25,"div",15)(26,"div",24)(27,"div",15)(28,"div",25)(29,"div",26)(30,"label",27),o(31,"Desde:"),e(),t(32,"div",26)(33,"div",28)(34,"div",29),p(35,"i",30),e(),p(36,"input",31),e()()()(),t(37,"div",25)(38,"div",26)(39,"label",27),o(40,"Hasta:"),e(),t(41,"div",26)(42,"div",28)(43,"div",29),p(44,"i",30),e(),p(45,"input",32),e()()()()()(),t(46,"div",33)(47,"div",26)(48,"label",27),o(49,"Seleccionar Estado:"),e(),t(50,"ng-select",34)(51,"ng-option",35),o(52,"Todos"),e(),t(53,"ng-option",36),o(54,"Pendiente"),e(),t(55,"ng-option",37),o(56,"Completado"),e(),t(57,"ng-option",38),o(58,"Cancelado"),e()()()(),t(59,"div",39)(60,"div",40),p(61,"label",27),t(62,"div",41)(63,"button",42),g("click",function(){return _(s),h(m.applyFilters())}),o(64,"Buscar"),e(),t(65,"button",43),g("click",function(){return _(s),h(m.clearFilters())}),o(66,"Limpiar"),e()()()()()()(),t(67,"div",44)(68,"div",15)(69,"div",45)(70,"div",46)(71,"span"),o(72,"Mostrar"),e(),t(73,"div",47)(74,"div",26)(75,"ng-select",48)(76,"ng-option",49),o(77,"10"),e(),t(78,"ng-option",50),o(79,"25"),e(),t(80,"ng-option",51),o(81,"50"),e(),t(82,"ng-option",52),o(83,"100"),e()()()(),t(84,"span"),o(85,"entradas"),e()()(),t(86,"div",45)(87,"div",20)(88,"input",53,0),g("keyup",function(c){return _(s),h(m.applyFilter(c))}),e()()()(),t(90,"div",54),f(91,Me,6,0,"div",55)(92,Be,22,3,"table",56),e(),p(93,"mat-paginator",57),e()()()(),f(94,et,37,12,"ng-template",null,1,Y)}n&2&&(d(24),C("formGroup",m.filterForm),d(67),v(m.loading?91:92),d(2),C("pageSizeOptions",$(3,Le)))},dependencies:[Fe,pe,ce,se,ye,ue,F,D,fe,_e,ge,ke,Ce,he,xe,ve,Te,be,Se,Ee,me,de,B,Q,ie,W,U,X,K,J,Z,ee,ae,oe,j]});let i=l;return i})();export{St as TicketListComponent};
