import{a as ke}from"./chunk-C7LS3LED.js";import"./chunk-IORNA22M.js";import{f as fe,g as D,h as F,i as he,j as De,n as Fe}from"./chunk-USSGZFX3.js";import{a as ce,b as pe,c as ue}from"./chunk-XG7TRELF.js";import{Aa as Te,oa as _e,pa as Se,qa as ve,ra as ge,sa as Ce,ta as be,ua as xe,va as Ee,wa as we,xa as Ve,ya as ye}from"./chunk-2CYZEA6T.js";import{r as re}from"./chunk-3DATYCE5.js";import{b as me,c as de,d as se}from"./chunk-EMEDTLE5.js";import{M as ae,_ as le,c as J,ca as oe,e as b,g as K,h as W,m as X,n as Z,p as ee,q as te,w as ie,y as ne}from"./chunk-XRHNCSTF.js";import{Ab as g,Cb as y,Ib as _,Kb as C,Ob as $,Qa as c,Qb as L,Qc as j,Ra as x,Rb as M,Sb as I,Tc as Q,Vb as N,Wb as a,Xb as V,Yb as T,cc as P,db as p,dc as O,ec as G,jb as S,kd as z,la as A,ld as B,nc as R,ob as H,od as U,pc as q,rb as E,rc as Y,ua as f,va as h,wb as t,xb as e,yb as s,zb as v}from"./chunk-AZAYKVK3.js";import"./chunk-REZWHGN7.js";var Le=()=>[8,10,25,100];function Me(i,o){i&1&&(t(0,"th",69),a(1,"#ID"),e())}function Ie(i,o){if(i&1&&(t(0,"td",70),a(1),e()),i&2){let r=o.$implicit;c(),V(r.No)}}function Ne(i,o){i&1&&(t(0,"th",69),a(1,"Cliente"),e())}function Re(i,o){if(i&1&&(t(0,"td",70)(1,"div",46)(2,"span",71),s(3,"i",72),e(),t(4,"div")(5,"h6",73),a(6),e(),t(7,"span",74),a(8),e()()()()),i&2){let r=o.$implicit;c(6),V(r.cliente),c(2),T("Venta #",r.id,"")}}function qe(i,o){i&1&&(t(0,"th",69),a(1,"Fecha"),e())}function Ae(i,o){if(i&1&&(t(0,"td",70),a(1),R(2,"date"),e()),i&2){let r=o.$implicit;c(),V(q(2,1,r.fecha,"dd/MM/yyyy"))}}function He(i,o){i&1&&(t(0,"th",69),a(1,"Total"),e())}function $e(i,o){if(i&1&&(t(0,"td",70),a(1),R(2,"number"),e()),i&2){let r=o.$implicit;c(),T("Q",q(2,1,r.total,"1.2-2"),"")}}function Pe(i,o){i&1&&(t(0,"th",69),a(1,"Estado"),e())}function Oe(i,o){if(i&1&&(t(0,"td",70)(1,"span"),a(2),e()()),i&2){let r=o.$implicit;c(),H("badge bg-",r.status,"-transparent"),c(),V(r.statusText)}}function Ge(i,o){i&1&&(t(0,"th",75),a(1,"Acciones"),e())}function Ye(i,o){if(i&1){let r=y();t(0,"td",70)(1,"div",76)(2,"a",77),s(3,"i",78),e(),t(4,"a",79),_("click",function(){let n=f(r).$implicit,m=C();return h(m.generateTicket(n.id))}),s(5,"i",80),e(),t(6,"a",81),_("click",function(){let n=f(r).$implicit,m=C(),d=N(115);return h(m.edit(d,n))}),s(7,"i",82),e(),t(8,"a",83),_("click",function(){let n=f(r).$implicit,m=C();return h(m.deleteVenta(n.id))}),s(9,"i",84),e()()()}if(i&2){let r=o.$implicit;c(2),$("routerLink","/dashboard/business-dashboard/view-sell/",r.id,"")}}function je(i,o){i&1&&s(0,"tr",85)}function Qe(i,o){i&1&&s(0,"tr",86)}function ze(i,o){if(i&1&&(t(0,"tr",87)(1,"td",88),a(2),e()()),i&2){C();let r=N(89);c(2),T('No hay datos que coincidan con el filtro "',r.value,'"')}}function Be(i,o){i&1&&(t(0,"div",95)(1,"small"),a(2,"El ID del cliente es requerido"),e()())}function Ue(i,o){i&1&&(t(0,"div",95)(1,"small"),a(2,"La fecha es requerida"),e()())}function Je(i,o){i&1&&(t(0,"div",95)(1,"small"),a(2,"El total es requerido"),e()())}function Ke(i,o){i&1&&(t(0,"div",95)(1,"small"),a(2,"El estado es requerido"),e()())}function We(i,o){i&1&&s(0,"span",105)}function Xe(i,o){if(i&1){let r=y();t(0,"form",89),_("ngSubmit",function(){f(r);let n=C();return h(n.onUpdateVenta())}),t(1,"div",90)(2,"h5",91),a(3,"Editar Venta"),e(),t(4,"button",92),_("click",function(){let n=f(r).$implicit;return h(n.dismiss("Cross click"))}),e()(),t(5,"div",93)(6,"div",15)(7,"div",25)(8,"div",26)(9,"label",27),a(10,"ID Cliente *"),e(),s(11,"input",94),p(12,Be,3,0,"div",95),e()(),t(13,"div",25)(14,"div",26)(15,"label",27),a(16,"Fecha *"),e(),s(17,"input",96),p(18,Ue,3,0,"div",95),e()(),t(19,"div",25)(20,"div",26)(21,"label",27),a(22,"Total *"),e(),s(23,"input",97),p(24,Je,3,0,"div",95),e()(),t(25,"div",25)(26,"div",26)(27,"label",27),a(28,"Estado *"),e(),t(29,"ng-select",98)(30,"ng-option",99),a(31,"Pendiente"),e(),t(32,"ng-option",100),a(33,"Completada"),e(),t(34,"ng-option",101),a(35,"Cancelada"),e()(),p(36,Ke,3,0,"div",95),e()()()(),t(37,"div",102)(38,"button",103),_("click",function(){let n=f(r).$implicit;return h(n.dismiss("cancel"))}),a(39,"Cancelar"),e(),t(40,"button",104),p(41,We,1,0,"span",105),a(42," Actualizar "),e()()()}if(i&2){let r,l,n,m,d=C();S("formGroup",d.editForm),c(12),E((r=d.editForm.get("idCliente"))!=null&&r.invalid&&((r=d.editForm.get("idCliente"))!=null&&r.touched)?12:-1),c(6),E((l=d.editForm.get("fecha"))!=null&&l.invalid&&((l=d.editForm.get("fecha"))!=null&&l.touched)?18:-1),c(6),E((n=d.editForm.get("total"))!=null&&n.invalid&&((n=d.editForm.get("total"))!=null&&n.touched)?24:-1),c(12),E((m=d.editForm.get("estado"))!=null&&m.invalid&&((m=d.editForm.get("estado"))!=null&&m.touched)?36:-1),c(4),S("disabled",d.loading),c(),E(d.loading?41:-1)}}var xt=(()=>{let o=class o{constructor(l,n,m,d,u){this.modalService=l,this.ventaService=n,this.fb=m,this.toastr=d,this.router=u,this.displayedColumns=["ID","Cliente","Fecha","Total","Estado","Action"],this.ventas=[],this.filteredVentas=[],this.loading=!1,this.selectedVenta=null,this.dataSource=new Te([]),this.editForm=this.fb.group({idCliente:["",[b.required,b.min(1)]],fecha:["",b.required],total:["",[b.required,b.min(0)]],estado:["",b.required]}),this.filterForm=this.fb.group({fechaDesde:[""],fechaHasta:[""],estado:[""]})}ngOnInit(){this.loadVentas()}ngAfterViewInit(){this.dataSource.paginator=this.paginator,this.dataSource.sort=this.sort}applyFilter(l){let n=l.target.value;this.dataSource.filter=n.trim().toLowerCase(),this.dataSource.paginator&&this.dataSource.paginator.firstPage()}edit(l,n){this.selectedVenta=this.ventas.find(m=>m.id===n.id)||null,this.selectedVenta&&this.editForm.patchValue({idCliente:this.selectedVenta.idCliente,fecha:this.selectedVenta.fecha.split("T")[0],total:this.selectedVenta.total,estado:this.selectedVenta.estado}),this.modalService.open(l,{windowClass:"modalCusSty modal-lg"})}onUpdateVenta(){if(this.editForm.valid&&this.selectedVenta){this.loading=!0;let l=this.editForm.value;this.ventaService.updateVenta(this.selectedVenta.id,l).subscribe({next:()=>{this.toastr.success("Venta actualizada exitosamente","\xC9xito",{timeOut:3e3,positionClass:"toast-top-right"}),this.loadVentas(),this.modalService.dismissAll(),this.loading=!1},error:n=>{this.toastr.error("Error al actualizar la venta: "+(n.error?.message||"Error desconocido"),"Error",{timeOut:3e3,positionClass:"toast-top-right"}),this.loading=!1}})}else this.toastr.warning("Por favor, complete todos los campos requeridos","Advertencia",{timeOut:3e3,positionClass:"toast-top-right"}),this.markFormGroupTouched()}deleteVenta(l){confirm("\xBFEst\xE1 seguro de que desea eliminar esta venta?")&&this.ventaService.deleteVenta(l).subscribe({next:()=>{this.toastr.success("Venta eliminada exitosamente","\xC9xito",{timeOut:3e3,positionClass:"toast-top-right"}),this.loadVentas()},error:n=>{this.toastr.error("Error al eliminar la venta: "+(n.error?.message||"Error desconocido"),"Error",{timeOut:3e3,positionClass:"toast-top-right"})}})}markFormGroupTouched(){Object.keys(this.editForm.controls).forEach(l=>{this.editForm.get(l)?.markAsTouched()})}loadVentas(){this.loading=!0,this.ventaService.getVentas().subscribe({next:l=>{this.ventas=l||[],this.filteredVentas=[...this.ventas],this.dataSource.data=this.mapVentasToDisplay(this.filteredVentas),this.loading=!1},error:l=>{console.error("Error loading ventas:",l),this.ventas=[],this.dataSource.data=[],this.loading=!1}})}mapVentasToDisplay(l){return!l||!Array.isArray(l)?[]:l.map(n=>({id:n.id,No:`#VT-${String(n.id).padStart(3,"0")}`,cliente:`Cliente #${n.idCliente}`,fecha:n.fecha,total:n.total,estado:n.estado,statusText:n.estado,status:this.getStatusClass(n.estado)}))}generateTicket(l){this.router.navigate(["/dashboard/business-dashboard/new-ticket"],{queryParams:{ventaId:l}})}applyFilters(){let{fechaDesde:l,fechaHasta:n,estado:m}=this.filterForm.value;this.filteredVentas=this.ventas.filter(d=>{let u=!0;if(l){let w=new Date(d.fecha),k=new Date(l);u=u&&w>=k}if(n){let w=new Date(d.fecha),k=new Date(n);u=u&&w<=k}return m&&(u=u&&d.estado.toLowerCase()===m.toLowerCase()),u}),this.dataSource.data=this.mapVentasToDisplay(this.filteredVentas)}clearFilters(){this.filterForm.reset(),this.filteredVentas=[...this.ventas],this.dataSource.data=this.mapVentasToDisplay(this.filteredVentas)}getStatusClass(l){switch(l.toLowerCase()){case"completada":return"success";case"pendiente":return"warning";case"cancelada":return"danger";default:return"secondary"}}};o.\u0275fac=function(n){return new(n||o)(x(ae),x(ke),x(ie),x(re),x(z))},o.\u0275cmp=A({type:o,selectors:[["app-sell-list"]],viewQuery:function(n,m){if(n&1&&(L(D,5),L(F,5)),n&2){let d;M(d=I())&&(m.paginator=d.first),M(d=I())&&(m.sort=d.first)}},standalone:!0,features:[P([me]),O],decls:116,vars:6,consts:[["input",""],["editContent",""],[1,"page-header","d-lg-flex","d-block"],[1,"page-leftheader"],[1,"page-title"],[1,"page-rightheader"],[1,"btn-list","d-flex","gap-1"],["routerLink","/dashboard/business-dashboard/new-sell",1,"btn","btn-primary"],[1,"fe","fe-plus","fs-12","my-auto","me-2"],["data-bs-toggle","tooltip","data-bs-placement","top","title","E-mail",1,"btn","btn-light3"],[1,"fe","fe-mail"],["data-bs-placement","top","data-bs-toggle","tooltip","title","Contact",1,"btn","btn-light3"],[1,"fe","fe-phone-call"],["data-bs-placement","top","data-bs-toggle","tooltip","title","Info",1,"btn","btn-primary"],[1,"fe","fe-info"],[1,"row"],[1,"col-xl-12","col-md-12","col-lg-12"],[1,"card","custom-card"],[1,"card-header","d-flex","justify-content-between","border-bottom-0"],[1,"card-title"],[1,"float-end"],["type","text","placeholder","buscar",1,"form-control"],[1,"card-body"],[3,"formGroup"],[1,"col-md-12","col-lg-7"],[1,"col-md-6"],[1,"form-group"],[1,"form-label"],[1,"input-group"],[1,"input-group-text","text-muted"],[1,"ri-calendar-line"],["mwlFlatpickr","","type","text","placeholder","DD-MM-YYYY","formControlName","fechaDesde",1,"form-control","choose-date"],["mwlFlatpickr","","type","text","placeholder","DD-MM-YYYY","formControlName","fechaHasta",1,"form-control","choose-date"],[1,"col-md-3"],["formControlName","estado","placeholder","Seleccionar Estado",1,"form-control","custom-select","p-0"],["value",""],["value","pendiente"],["value","completada"],["value","cancelada"],[1,"col-md-2"],[1,"form-group","mt-2"],[1,"d-flex","gap-2"],["type","button",1,"btn","btn-primary",3,"click"],["type","button",1,"btn","btn-light",3,"click"],[1,"card-body","border-top"],[1,"col-sm-6","mb-1"],[1,"d-flex","align-items-center"],[1,"d-flex","ms-2","mx-2"],["name","quantity","placeholder","10","data-trigger","",1,"form-control","wd-150","p-0"],["value","10","selected",""],["value","25"],["value","50"],["value","100"],["type","text","matInput","","placeholder","buscar",1,"form-control",3,"keyup"],[1,"table-responsive"],["mat-table","","matSort","",1,"table","table-vcenter","text-nowrap","table-bordered","border-bottom",3,"dataSource"],["matColumnDef","ID"],["mat-header-cell","","mat-sort-header","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","Cliente"],["matColumnDef","Fecha"],["matColumnDef","Total"],["matColumnDef","Estado"],["matColumnDef","Action"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["class","mat-row",4,"matNoDataRow"],["aria-label","Select page of sells",3,"pageSizeOptions"],["mat-header-cell","","mat-sort-header",""],["mat-cell",""],[1,"avatar","avatar-md","me-2","avatar-rounded","bg-success-transparent"],[1,"fe","fe-user"],[1,"mb-1","fs-14"],[1,"fs-12","text-muted"],["mat-header-cell",""],[1,"d-flex"],["placement","top","ngbTooltip","Ver Venta",1,"action-btns1",3,"routerLink"],[1,"fe","fe-eye","text-primary"],["placement","top","ngbTooltip","Generar Ticket",1,"action-btns1",3,"click"],[1,"fe","fe-file-plus","text-info"],["placement","top","ngbTooltip","Editar",1,"action-btns1",3,"click"],[1,"fe","fe-edit-2","text-success"],["placement","top","ngbTooltip","Eliminar",1,"action-btns1",3,"click"],[1,"fe","fe-trash-2","text-danger"],["mat-header-row",""],["mat-row",""],[1,"mat-row"],["colspan","6",1,"mat-cell"],[3,"ngSubmit","formGroup"],[1,"modal-header"],[1,"modal-title"],["type","button","data-bs-dismiss","modal","aria-label","Close",1,"btn-close",3,"click"],[1,"modal-body"],["formControlName","idCliente","type","number","placeholder","ID del cliente",1,"form-control"],[1,"text-danger"],["formControlName","fecha","type","date",1,"form-control"],["formControlName","total","type","number","step","0.01","placeholder","Total de la venta",1,"form-control"],["formControlName","estado","placeholder","Seleccionar estado",1,"form-control"],["value","Pendiente"],["value","Completada"],["value","Cancelada"],[1,"modal-footer"],["type","button",1,"btn","btn-outline-primary",3,"click"],["type","submit",1,"btn","btn-success",3,"disabled"],[1,"spinner-border","spinner-border-sm","me-2"]],template:function(n,m){if(n&1){let d=y();t(0,"div",2)(1,"div",3)(2,"div",4),a(3,"Lista de Ventas"),e()(),t(4,"div",5)(5,"div",6)(6,"a",7),s(7,"i",8),a(8,"Agregar Venta "),e(),t(9,"button",9),s(10,"i",10),e(),t(11,"button",11),s(12,"i",12),e(),t(13,"button",13),s(14,"i",14),e()()()(),t(15,"div",15)(16,"div",16)(17,"div",17)(18,"div",18)(19,"h4",19),a(20,"Resumen de Ventas"),e(),t(21,"div",20),s(22,"input",21),e()(),t(23,"div",22)(24,"form",23)(25,"div",15)(26,"div",24)(27,"div",15)(28,"div",25)(29,"div",26)(30,"label",27),a(31,"Desde:"),e(),t(32,"div",26)(33,"div",28)(34,"div",29),s(35,"i",30),e(),s(36,"input",31),e()()()(),t(37,"div",25)(38,"div",26)(39,"label",27),a(40,"Hasta:"),e(),t(41,"div",26)(42,"div",28)(43,"div",29),s(44,"i",30),e(),s(45,"input",32),e()()()()()(),t(46,"div",33)(47,"div",26)(48,"label",27),a(49,"Seleccionar Estado:"),e(),t(50,"ng-select",34)(51,"ng-option",35),a(52,"Todos"),e(),t(53,"ng-option",36),a(54,"Pendiente"),e(),t(55,"ng-option",37),a(56,"Completada"),e(),t(57,"ng-option",38),a(58,"Cancelada"),e()()()(),t(59,"div",39)(60,"div",40),s(61,"label",27),t(62,"div",41)(63,"button",42),_("click",function(){return f(d),h(m.applyFilters())}),a(64,"Buscar"),e(),t(65,"button",43),_("click",function(){return f(d),h(m.clearFilters())}),a(66,"Limpiar"),e()()()()()()(),t(67,"div",44)(68,"div",15)(69,"div",45)(70,"div",46)(71,"span"),a(72,"Mostrar"),e(),t(73,"div",47)(74,"div",26)(75,"ng-select",48)(76,"ng-option",49),a(77,"10"),e(),t(78,"ng-option",50),a(79,"25"),e(),t(80,"ng-option",51),a(81,"50"),e(),t(82,"ng-option",52),a(83,"100"),e()()()(),t(84,"span"),a(85,"entradas"),e()()(),t(86,"div",45)(87,"div",20)(88,"input",53,0),_("keyup",function(w){return f(d),h(m.applyFilter(w))}),e()()()(),t(90,"div",54)(91,"table",55),v(92,56),p(93,Me,2,0,"th",57)(94,Ie,2,1,"td",58),g(),v(95,59),p(96,Ne,2,0,"th",57)(97,Re,9,2,"td",58),g(),v(98,60),p(99,qe,2,0,"th",57)(100,Ae,3,4,"td",58),g(),v(101,61),p(102,He,2,0,"th",57)(103,$e,3,4,"td",58),g(),v(104,62),p(105,Pe,2,0,"th",57)(106,Oe,3,4,"td",58),g(),v(107,63),p(108,Ge,2,0,"th",64)(109,Ye,10,2,"td",58),g(),p(110,je,1,0,"tr",65)(111,Qe,1,0,"tr",66)(112,ze,3,1,"tr",67),e()(),s(113,"mat-paginator",68),e()()()(),p(114,Xe,43,7,"ng-template",null,1,Y)}n&2&&(c(24),S("formGroup",m.filterForm),c(67),S("dataSource",m.dataSource),c(19),S("matHeaderRowDef",m.displayedColumns),c(),S("matRowDefColumns",m.displayedColumns),c(2),S("pageSizeOptions",G(5,Le)))},dependencies:[Fe,ue,pe,ce,De,fe,D,F,he,_e,ve,xe,ge,Se,Ee,Ce,be,we,Ve,ye,se,de,U,B,ne,X,J,Z,K,W,ee,te,oe,le,j,Q]});let i=o;return i})();export{xt as SellListComponent};
