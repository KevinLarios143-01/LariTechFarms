import{a as ee}from"./chunk-5G2KFST2.js";import"./chunk-IORNA22M.js";import{c as Q,n as Z}from"./chunk-FG6B37U2.js";import{a as U,b as W,c as X}from"./chunk-S5Y45Y7X.js";import"./chunk-35J6RYA3.js";import{r as K}from"./chunk-P6RHK3TE.js";import"./chunk-LAI4YRFV.js";import{c as A,e as v,g as G,h as V,m as z,n as R,p as $,q as B,u as H,w as Y,y as J}from"./chunk-I6FKYEZO.js";import{Ib as S,Kb as O,Lc as M,Mc as P,Qa as a,Ra as f,Wb as l,Wc as k,Xb as y,Yb as w,db as c,dc as x,id as D,jb as s,kd as q,la as L,lb as b,nb as N,od as j,wb as n,xb as t,yb as u,yc as T}from"./chunk-W3KPMJ6O.js";import"./chunk-REZWHGN7.js";function te(r,d){if(r&1&&(n(0,"ng-option",31),l(1),t()),r&2){let m=d.$implicit;s("value",m),a(),y(m)}}function oe(r,d){r&1&&(n(0,"div",32),l(1," El tipo es requerido "),t())}function ie(r,d){r&1&&(n(0,"div",32),l(1," La galera es requerida "),t())}function re(r,d){r&1&&(n(0,"span"),l(1,"La cantidad es requerida"),t())}function ne(r,d){r&1&&(n(0,"span"),l(1,"La cantidad debe ser mayor a 0"),t())}function ae(r,d){if(r&1&&(n(0,"div",32),c(1,re,2,0,"span",33)(2,ne,2,0,"span",33),t()),r&2){let m,o,i=O();a(),s("ngIf",(m=i.loteForm.get("cantidad"))==null||m.errors==null?null:m.errors.required),a(),s("ngIf",(o=i.loteForm.get("cantidad"))==null||o.errors==null?null:o.errors.min)}}function le(r,d){if(r&1&&(n(0,"ng-option",31),l(1),t()),r&2){let m=d.$implicit;s("value",m),a(),y(m)}}function de(r,d){r&1&&(n(0,"div",32),l(1," La fecha de inicio es requerida "),t())}function se(r,d){r&1&&u(0,"span",34)}var Ie=(()=>{let d=class d{constructor(o,i,e,p,h,g){this.fb=o,this.lotesService=i,this.router=e,this.route=p,this.toastr=h,this.cdr=g,this.loading=!1,this.isEditing=!1,this.loteId=null,this.tiposLote=["Ponedoras","Engorde"],this.estadosLote=["Activo","Inactivo","Desalojado"],this.loteForm=this.fb.group({tipo:["",v.required],galera:["",v.required],cantidad:["",[v.required,v.min(1)]],fechaInicio:["",v.required],fechaFin:[""],estado:["Activo"],observaciones:[""]})}ngOnInit(){this.route.params.subscribe(o=>{o.id&&(this.isEditing=!0,this.loteId=+o.id,this.loadLote())})}loadLote(){this.loteId&&(this.loading=!0,this.lotesService.getLoteById(this.loteId).subscribe({next:o=>{let i=o.data;this.loteForm.patchValue({tipo:i.tipo,galera:i.galera,cantidad:i.cantidad,fechaInicio:this.formatDateForInput(i.fechaInicio),fechaFin:this.formatDateForInput(i.fechaFin),estado:i.estado,observaciones:i.observaciones}),this.loading=!1,this.cdr.detectChanges()},error:o=>{console.error("Error al cargar lote:",o),this.toastr.error("Error al cargar el lote","Error",{timeOut:3e3,positionClass:"toast-top-right"}),this.loading=!1,this.cdr.detectChanges()}}))}onSubmit(){if(this.loteForm.valid){this.loading=!0;let o=this.loteForm.value;this.isEditing&&this.loteId?this.lotesService.updateLote(this.loteId,o).subscribe({next:()=>{this.toastr.success("Lote actualizado exitosamente","\xC9xito",{timeOut:3e3,positionClass:"toast-top-right"}),this.router.navigate(["/dashboard/business-dashboard/lotes"]),this.loading=!1,this.cdr.detectChanges()},error:i=>{console.error("Error al actualizar lote:",i),this.toastr.error("Error al actualizar el lote","Error",{timeOut:3e3,positionClass:"toast-top-right"}),this.loading=!1,this.cdr.detectChanges()}}):this.lotesService.createLote(o).subscribe({next:()=>{this.toastr.success("Lote creado exitosamente","\xC9xito",{timeOut:3e3,positionClass:"toast-top-right"}),this.router.navigate(["/dashboard/business-dashboard/lotes"]),this.loading=!1,this.cdr.detectChanges()},error:i=>{console.error("Error al crear lote:",i),this.toastr.error("Error al crear el lote","Error",{timeOut:3e3,positionClass:"toast-top-right"}),this.loading=!1,this.cdr.detectChanges()}})}else this.markFormGroupTouched(),this.toastr.warning("Por favor, complete todos los campos requeridos","Advertencia",{timeOut:3e3,positionClass:"toast-top-right"})}onCancel(){this.router.navigate(["/dashboard/business-dashboard/lotes"])}markFormGroupTouched(){Object.keys(this.loteForm.controls).forEach(o=>{this.loteForm.get(o)?.markAsTouched()})}formatDateForInput(o){if(!o)return"";if(/^\d{4}-\d{2}-\d{2}$/.test(o))return o;if(o.includes("T"))return o.split("T")[0];let i=new Date(o);return isNaN(i.getTime())?"":i.toISOString().split("T")[0]}};d.\u0275fac=function(i){return new(i||d)(f(Y),f(ee),f(q),f(D),f(K),f(T))},d.\u0275cmp=L({type:d,selectors:[["app-new-lote"]],standalone:!0,features:[x],decls:62,vars:25,consts:[[3,"title","title2","class1","path"],[1,"row"],[1,"col-xl-12"],[1,"card","custom-card"],[1,"card-header"],[1,"card-title"],[1,"card-body"],[3,"ngSubmit","formGroup"],[1,"col-md-6"],[1,"form-group","mb-3"],["for","tipo",1,"form-label"],["formControlName","tipo","placeholder","Seleccione el tipo",1,"form-control","p-0"],[3,"value",4,"ngFor","ngForOf"],["class","invalid-feedback d-block",4,"ngIf"],["for","galera",1,"form-label"],["type","text","formControlName","galera","placeholder","Ingrese el nombre de la galera",1,"form-control"],["for","cantidad",1,"form-label"],["type","number","formControlName","cantidad","placeholder","Cantidad de aves","min","1",1,"form-control"],["for","estado",1,"form-label"],["formControlName","estado","placeholder","Seleccione el estado",1,"form-control","p-0"],["for","fechaInicio",1,"form-label"],["type","date","formControlName","fechaInicio",1,"form-control"],["for","fechaFin",1,"form-label"],["type","date","formControlName","fechaFin",1,"form-control"],[1,"col-md-12"],["for","observaciones",1,"form-label"],["formControlName","observaciones","rows","4","placeholder","Observaciones adicionales",1,"form-control"],[1,"form-group","d-flex","gap-2","justify-content-end"],["type","button",1,"btn","btn-secondary",3,"click","disabled"],["type","submit",1,"btn","btn-primary",3,"disabled"],["class","spinner-border spinner-border-sm me-2","role","status",4,"ngIf"],[3,"value"],[1,"invalid-feedback","d-block"],[4,"ngIf"],["role","status",1,"spinner-border","spinner-border-sm","me-2"]],template:function(i,e){if(i&1&&(u(0,"app-hr-dashboard-page-header",0),n(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4)(5,"h3",5),l(6,"Informaci\xF3n del Lote"),t()(),n(7,"div",6)(8,"form",7),S("ngSubmit",function(){return e.onSubmit()}),n(9,"div",1)(10,"div",8)(11,"div",9)(12,"label",10),l(13,"Tipo *"),t(),n(14,"ng-select",11),c(15,te,2,2,"ng-option",12),t(),c(16,oe,2,0,"div",13),t()(),n(17,"div",8)(18,"div",9)(19,"label",14),l(20,"Galera *"),t(),u(21,"input",15),c(22,ie,2,0,"div",13),t()()(),n(23,"div",1)(24,"div",8)(25,"div",9)(26,"label",16),l(27,"Cantidad *"),t(),u(28,"input",17),c(29,ae,3,2,"div",13),t()(),n(30,"div",8)(31,"div",9)(32,"label",18),l(33,"Estado *"),t(),n(34,"ng-select",19),c(35,le,2,2,"ng-option",12),t()()()(),n(36,"div",1)(37,"div",8)(38,"div",9)(39,"label",20),l(40,"Fecha de Inicio *"),t(),u(41,"input",21),c(42,de,2,0,"div",13),t()(),n(43,"div",8)(44,"div",9)(45,"label",22),l(46,"Fecha de Fin"),t(),u(47,"input",23),t()()(),n(48,"div",1)(49,"div",24)(50,"div",9)(51,"label",25),l(52,"Observaciones"),t(),u(53,"textarea",26),t()()(),n(54,"div",1)(55,"div",24)(56,"div",27)(57,"button",28),S("click",function(){return e.onCancel()}),l(58," Cancelar "),t(),n(59,"button",29),c(60,se,1,0,"span",30),l(61),t()()()()()()()()()),i&2){let p,h,g,_,C,F,E,I;N("btn btn-secondary"),s("title",e.isEditing?"Editar Lote":"Agregar Lote")("title2","Volver a Lista")("class1","")("path","/dashboard/business-dashboard/lotes"),a(8),s("formGroup",e.loteForm),a(6),b("is-invalid",((p=e.loteForm.get("tipo"))==null?null:p.invalid)&&((p=e.loteForm.get("tipo"))==null?null:p.touched)),a(),s("ngForOf",e.tiposLote),a(),s("ngIf",((h=e.loteForm.get("tipo"))==null?null:h.invalid)&&((h=e.loteForm.get("tipo"))==null?null:h.touched)),a(5),b("is-invalid",((g=e.loteForm.get("galera"))==null?null:g.invalid)&&((g=e.loteForm.get("galera"))==null?null:g.touched)),a(),s("ngIf",((_=e.loteForm.get("galera"))==null?null:_.invalid)&&((_=e.loteForm.get("galera"))==null?null:_.touched)),a(6),b("is-invalid",((C=e.loteForm.get("cantidad"))==null?null:C.invalid)&&((C=e.loteForm.get("cantidad"))==null?null:C.touched)),a(),s("ngIf",((F=e.loteForm.get("cantidad"))==null?null:F.invalid)&&((F=e.loteForm.get("cantidad"))==null?null:F.touched)),a(6),s("ngForOf",e.estadosLote),a(6),b("is-invalid",((E=e.loteForm.get("fechaInicio"))==null?null:E.invalid)&&((E=e.loteForm.get("fechaInicio"))==null?null:E.touched)),a(),s("ngIf",((I=e.loteForm.get("fechaInicio"))==null?null:I.invalid)&&((I=e.loteForm.get("fechaInicio"))==null?null:I.touched)),a(15),s("disabled",e.loading),a(2),s("disabled",e.loading||e.loteForm.invalid),a(),s("ngIf",e.loading),a(),w(" ",e.isEditing?"Actualizar":"Crear"," Lote ")}},dependencies:[k,M,P,Z,Q,X,W,U,j,J,z,A,R,G,V,H,$,B],styles:[".form-control[_ngcontent-%COMP%]{border-radius:.375rem;border:1px solid #ced4da}.form-control[_ngcontent-%COMP%]:focus{border-color:#86b7fe;box-shadow:0 0 0 .25rem #0d6efd40}.form-control.is-invalid[_ngcontent-%COMP%]{border-color:#dc3545}.form-control.is-invalid[_ngcontent-%COMP%]:focus{border-color:#dc3545;box-shadow:0 0 0 .25rem #dc354540}.invalid-feedback[_ngcontent-%COMP%]{display:block;width:100%;margin-top:.25rem;font-size:.875rem;color:#dc3545}.btn[_ngcontent-%COMP%]{border-radius:.375rem;font-weight:500}.btn[_ngcontent-%COMP%]:hover{transform:translateY(-1px);box-shadow:0 .25rem .5rem #0000001a}.spinner-border-sm[_ngcontent-%COMP%]{width:1rem;height:1rem}.custom-card[_ngcontent-%COMP%]{box-shadow:0 .125rem .25rem #00000013;border:1px solid rgba(0,0,0,.125)}"]});let r=d;return r})();export{Ie as NewLoteComponent};
