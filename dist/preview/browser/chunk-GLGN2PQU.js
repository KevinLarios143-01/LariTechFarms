import{a as ee}from"./chunk-5G2KFST2.js";import"./chunk-IORNA22M.js";import{c as U,n as Z}from"./chunk-L3BSSDS5.js";import{a as W,b as X,c as Y}from"./chunk-S5Y45Y7X.js";import"./chunk-TZ522SJ7.js";import{r as Q}from"./chunk-P6RHK3TE.js";import"./chunk-LAI4YRFV.js";import{c as G,e as g,g as P,h as V,m as R,n as z,p as $,q as B,u as H,w as J,y as K}from"./chunk-I6FKYEZO.js";import{Ib as S,Kb as T,Lc as D,Mc as k,Qa as a,Ra as f,Wb as l,Wc as q,Xb as y,Yb as w,db as c,dc as x,id as j,jb as d,kd as A,la as L,lb as b,nb as N,od as M,wb as n,xb as t,yb as u,yc as O}from"./chunk-W3KPMJ6O.js";import"./chunk-REZWHGN7.js";function te(r,s){if(r&1&&(n(0,"ng-option",31),l(1),t()),r&2){let m=s.$implicit;d("value",m),a(),y(m)}}function ie(r,s){r&1&&(n(0,"div",32),l(1," El tipo es requerido "),t())}function oe(r,s){r&1&&(n(0,"div",32),l(1," La galera es requerida "),t())}function re(r,s){r&1&&(n(0,"span"),l(1,"La cantidad es requerida"),t())}function ne(r,s){r&1&&(n(0,"span"),l(1,"La cantidad debe ser mayor a 0"),t())}function ae(r,s){if(r&1&&(n(0,"div",32),c(1,re,2,0,"span",33)(2,ne,2,0,"span",33),t()),r&2){let m,i,o=T();a(),d("ngIf",(m=o.loteForm.get("cantidad"))==null||m.errors==null?null:m.errors.required),a(),d("ngIf",(i=o.loteForm.get("cantidad"))==null||i.errors==null?null:i.errors.min)}}function le(r,s){if(r&1&&(n(0,"ng-option",31),l(1),t()),r&2){let m=s.$implicit;d("value",m),a(),y(m)}}function se(r,s){r&1&&(n(0,"div",32),l(1," La fecha de inicio es requerida "),t())}function de(r,s){r&1&&u(0,"span",34)}var Ie=(()=>{let s=class s{constructor(i,o,e,p,h,v){this.fb=i,this.lotesService=o,this.router=e,this.route=p,this.toastr=h,this.cdr=v,this.loading=!1,this.isEditing=!1,this.loteId=null,this.tiposLote=["Ponedoras","Engorde"],this.estadosLote=["Activo","Inactivo","Desalojado"],this.loteForm=this.fb.group({tipo:["",g.required],galera:["",g.required],cantidad:["",[g.required,g.min(1)]],fechaInicio:["",g.required],fechaFin:[""],estado:["Activo"],observaciones:[""]})}ngOnInit(){this.route.params.subscribe(i=>{i.id&&(this.isEditing=!0,this.loteId=+i.id,this.loadLote())})}loadLote(){this.loteId&&(this.loading=!0,this.lotesService.getLoteById(this.loteId).subscribe({next:i=>{let o=i.data;this.loteForm.patchValue({tipo:o.tipo,galera:o.galera,cantidad:o.cantidad,fechaInicio:this.formatDateForInput(o.fechaInicio),fechaFin:this.formatDateForInput(o.fechaFin),estado:o.estado,observaciones:o.observaciones}),this.loading=!1,this.cdr.detectChanges()},error:i=>{console.error("Error al cargar lote:",i),this.toastr.error("Error al cargar el lote","Error",{timeOut:3e3,positionClass:"toast-top-right"}),this.loading=!1,this.cdr.detectChanges()}}))}onSubmit(){if(this.loteForm.valid){this.loading=!0;let i=this.loteForm.value;this.isEditing&&this.loteId?this.lotesService.updateLote(this.loteId,i).subscribe({next:()=>{this.toastr.success("Lote actualizado exitosamente","\xC9xito",{timeOut:3e3,positionClass:"toast-top-right"}),this.router.navigate(["/dashboard/business-dashboard/lotes"]),this.loading=!1,this.cdr.detectChanges()},error:o=>{console.error("Error al actualizar lote:",o),this.toastr.error("Error al actualizar el lote","Error",{timeOut:3e3,positionClass:"toast-top-right"}),this.loading=!1,this.cdr.detectChanges()}}):this.lotesService.createLote(i).subscribe({next:()=>{this.toastr.success("Lote creado exitosamente","\xC9xito",{timeOut:3e3,positionClass:"toast-top-right"}),this.router.navigate(["/dashboard/business-dashboard/lotes"]),this.loading=!1,this.cdr.detectChanges()},error:o=>{console.error("Error al crear lote:",o),this.toastr.error("Error al crear el lote","Error",{timeOut:3e3,positionClass:"toast-top-right"}),this.loading=!1,this.cdr.detectChanges()}})}else this.markFormGroupTouched(),this.toastr.warning("Por favor, complete todos los campos requeridos","Advertencia",{timeOut:3e3,positionClass:"toast-top-right"})}onCancel(){this.router.navigate(["/dashboard/business-dashboard/lotes"])}markFormGroupTouched(){Object.keys(this.loteForm.controls).forEach(i=>{this.loteForm.get(i)?.markAsTouched()})}formatDateForInput(i){if(!i)return"";if(/^\d{4}-\d{2}-\d{2}$/.test(i))return i;if(i.includes("T"))return i.split("T")[0];let o=new Date(i);return isNaN(o.getTime())?"":o.toISOString().split("T")[0]}};s.\u0275fac=function(o){return new(o||s)(f(J),f(ee),f(A),f(j),f(Q),f(O))},s.\u0275cmp=L({type:s,selectors:[["app-new-lote"]],standalone:!0,features:[x],decls:62,vars:25,consts:[[3,"title","title2","class1","path"],[1,"row"],[1,"col-xl-12"],[1,"card","custom-card"],[1,"card-header"],[1,"card-title"],[1,"card-body"],[3,"ngSubmit","formGroup"],[1,"col-md-6"],[1,"form-group","mb-3"],["for","tipo",1,"form-label"],["formControlName","tipo","placeholder","Seleccione el tipo",1,"form-control","p-0"],[3,"value",4,"ngFor","ngForOf"],["class","invalid-feedback d-block",4,"ngIf"],["for","galera",1,"form-label"],["type","text","formControlName","galera","placeholder","Ingrese el nombre de la galera",1,"form-control"],["for","cantidad",1,"form-label"],["type","number","formControlName","cantidad","placeholder","Cantidad de aves","min","1",1,"form-control"],["for","estado",1,"form-label"],["formControlName","estado","placeholder","Seleccione el estado",1,"form-control","p-0"],["for","fechaInicio",1,"form-label"],["type","date","formControlName","fechaInicio",1,"form-control"],["for","fechaFin",1,"form-label"],["type","date","formControlName","fechaFin",1,"form-control"],[1,"col-md-12"],["for","observaciones",1,"form-label"],["formControlName","observaciones","rows","4","placeholder","Observaciones adicionales",1,"form-control"],[1,"form-group","d-flex","gap-2","justify-content-end"],["type","button",1,"btn","btn-secondary",3,"click","disabled"],["type","submit",1,"btn","btn-primary",3,"disabled"],["class","spinner-border spinner-border-sm me-2","role","status",4,"ngIf"],[3,"value"],[1,"invalid-feedback","d-block"],[4,"ngIf"],["role","status",1,"spinner-border","spinner-border-sm","me-2"]],template:function(o,e){if(o&1&&(u(0,"app-hr-dashboard-page-header",0),n(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4)(5,"h3",5),l(6,"Informaci\xF3n del Lote"),t()(),n(7,"div",6)(8,"form",7),S("ngSubmit",function(){return e.onSubmit()}),n(9,"div",1)(10,"div",8)(11,"div",9)(12,"label",10),l(13,"Tipo *"),t(),n(14,"ng-select",11),c(15,te,2,2,"ng-option",12),t(),c(16,ie,2,0,"div",13),t()(),n(17,"div",8)(18,"div",9)(19,"label",14),l(20,"Galera *"),t(),u(21,"input",15),c(22,oe,2,0,"div",13),t()()(),n(23,"div",1)(24,"div",8)(25,"div",9)(26,"label",16),l(27,"Cantidad *"),t(),u(28,"input",17),c(29,ae,3,2,"div",13),t()(),n(30,"div",8)(31,"div",9)(32,"label",18),l(33,"Estado *"),t(),n(34,"ng-select",19),c(35,le,2,2,"ng-option",12),t()()()(),n(36,"div",1)(37,"div",8)(38,"div",9)(39,"label",20),l(40,"Fecha de Inicio *"),t(),u(41,"input",21),c(42,se,2,0,"div",13),t()(),n(43,"div",8)(44,"div",9)(45,"label",22),l(46,"Fecha de Fin"),t(),u(47,"input",23),t()()(),n(48,"div",1)(49,"div",24)(50,"div",9)(51,"label",25),l(52,"Observaciones"),t(),u(53,"textarea",26),t()()(),n(54,"div",1)(55,"div",24)(56,"div",27)(57,"button",28),S("click",function(){return e.onCancel()}),l(58," Cancelar "),t(),n(59,"button",29),c(60,de,1,0,"span",30),l(61),t()()()()()()()()()),o&2){let p,h,v,_,F,C,E,I;N("btn btn-secondary"),d("title",e.isEditing?"Editar Lote":"Agregar Lote")("title2","Volver a Lista")("class1","")("path","/dashboard/business-dashboard/lotes"),a(8),d("formGroup",e.loteForm),a(6),b("is-invalid",((p=e.loteForm.get("tipo"))==null?null:p.invalid)&&((p=e.loteForm.get("tipo"))==null?null:p.touched)),a(),d("ngForOf",e.tiposLote),a(),d("ngIf",((h=e.loteForm.get("tipo"))==null?null:h.invalid)&&((h=e.loteForm.get("tipo"))==null?null:h.touched)),a(5),b("is-invalid",((v=e.loteForm.get("galera"))==null?null:v.invalid)&&((v=e.loteForm.get("galera"))==null?null:v.touched)),a(),d("ngIf",((_=e.loteForm.get("galera"))==null?null:_.invalid)&&((_=e.loteForm.get("galera"))==null?null:_.touched)),a(6),b("is-invalid",((F=e.loteForm.get("cantidad"))==null?null:F.invalid)&&((F=e.loteForm.get("cantidad"))==null?null:F.touched)),a(),d("ngIf",((C=e.loteForm.get("cantidad"))==null?null:C.invalid)&&((C=e.loteForm.get("cantidad"))==null?null:C.touched)),a(6),d("ngForOf",e.estadosLote),a(6),b("is-invalid",((E=e.loteForm.get("fechaInicio"))==null?null:E.invalid)&&((E=e.loteForm.get("fechaInicio"))==null?null:E.touched)),a(),d("ngIf",((I=e.loteForm.get("fechaInicio"))==null?null:I.invalid)&&((I=e.loteForm.get("fechaInicio"))==null?null:I.touched)),a(15),d("disabled",e.loading),a(2),d("disabled",e.loading||e.loteForm.invalid),a(),d("ngIf",e.loading),a(),w(" ",e.isEditing?"Actualizar":"Crear"," Lote ")}},dependencies:[q,D,k,Z,U,Y,X,W,M,K,R,G,z,P,V,H,$,B]});let r=s;return r})();export{Ie as NewLoteComponent};
