import{a as ce}from"./chunk-LPDJMIYN.js";import"./chunk-IORNA22M.js";import{n as me}from"./chunk-XLGDB24R.js";import{a as re,b as de,c as se}from"./chunk-SNUM6ZIL.js";import"./chunk-HC3PXDFB.js";import{r as ne}from"./chunk-GNT7AIZA.js";import{b as ae,c as le,d as oe}from"./chunk-5ILM3463.js";import{M as ee,_ as te,c as H,ca as ie,e as x,g as z,h as U,m as Q,n as J,p as K,q as W,w as X,y as Z}from"./chunk-MN5F6KP3.js";import{Cb as V,Ib as _,Kb as h,Ob as I,Qa as c,Qc as P,Ra as b,Tc as j,Vb as N,Wb as i,Xb as F,Yb as C,cc as M,db as v,dc as B,jb as E,kd as R,la as k,ld as Y,nc as w,ob as T,od as $,pc as q,qc as A,rb as g,rc as G,ua as u,ub as D,va as f,vb as L,wb as t,xb as e,yb as d,yc as O}from"./chunk-W3KPMJ6O.js";import"./chunk-REZWHGN7.js";var pe=(l,s)=>s.id;function ue(l,s){l&1&&(t(0,"div",52)(1,"div",54)(2,"span",55),i(3,"Cargando..."),e()()())}function fe(l,s){l&1&&(t(0,"tr")(1,"td",57)(2,"div",58),d(3,"i",59),t(4,"p"),i(5,"No hay ventas disponibles"),e()()()())}function ve(l,s){if(l&1){let o=V();t(0,"tr")(1,"td"),i(2),e(),t(3,"td")(4,"div",45)(5,"span",60),d(6,"i",61),e(),t(7,"div")(8,"h6",62),i(9),e(),t(10,"span",63),i(11),e()()()(),t(12,"td"),i(13),w(14,"date"),e(),t(15,"td"),i(16),w(17,"number"),e(),t(18,"td")(19,"span"),i(20),e()(),t(21,"td")(22,"div",64)(23,"a",65),d(24,"i",66),e(),t(25,"a",67),_("click",function(){let a=u(o).$implicit,m=h(3);return f(m.generateTicket(a.id))}),d(26,"i",68),e(),t(27,"a",69),_("click",function(){let a=u(o).$implicit,m=h(3),r=N(92);return f(m.edit(r,a))}),d(28,"i",70),e(),t(29,"a",71),_("click",function(){let a=u(o).$implicit,m=h(3);return f(m.deleteVenta(a.id))}),d(30,"i",72),e()()()()}if(l&2){let o=s.$implicit,n=h(3);c(2),C("#VT-",o.id.toString().padStart(3,"0"),""),c(7),C("Cliente #",o.idCliente,""),c(2),C("Venta #",o.id,""),c(2),F(A(14,11,o.fecha,"dd/MM/yyyy","UTC")),c(3),C("Q",q(17,15,o.total,"1.2-2"),""),c(3),T("badge bg-",n.getStatusClass(o.estado),"-transparent"),c(),F(o.estado),c(3),I("routerLink","/dashboard/business-dashboard/view-sell/",o.id,"")}}function _e(l,s){if(l&1&&D(0,ve,31,18,"tr",null,pe),l&2){let o=h(2);L(o.filteredVentas)}}function he(l,s){if(l&1&&(t(0,"div",53)(1,"table",56)(2,"thead")(3,"tr")(4,"th"),i(5,"#ID"),e(),t(6,"th"),i(7,"Cliente"),e(),t(8,"th"),i(9,"Fecha"),e(),t(10,"th"),i(11,"Total"),e(),t(12,"th"),i(13,"Estado"),e(),t(14,"th"),i(15,"Acciones"),e()()(),t(16,"tbody"),v(17,fe,6,0,"tr")(18,_e,2,0),e()()()),l&2){let o=h();c(17),g(o.filteredVentas.length===0?17:18)}}function ge(l,s){l&1&&(t(0,"div",79)(1,"small"),i(2,"El ID del cliente es requerido"),e()())}function be(l,s){l&1&&(t(0,"div",79)(1,"small"),i(2,"La fecha es requerida"),e()())}function xe(l,s){l&1&&(t(0,"div",79)(1,"small"),i(2,"El total es requerido"),e()())}function Se(l,s){l&1&&(t(0,"div",79)(1,"small"),i(2,"El estado es requerido"),e()())}function Ce(l,s){l&1&&d(0,"span",89)}function Ee(l,s){if(l&1){let o=V();t(0,"form",73),_("ngSubmit",function(){u(o);let a=h();return f(a.onUpdateVenta())}),t(1,"div",74)(2,"h5",75),i(3,"Editar Venta"),e(),t(4,"button",76),_("click",function(){let a=u(o).$implicit;return f(a.dismiss("Cross click"))}),e()(),t(5,"div",77)(6,"div",14)(7,"div",24)(8,"div",25)(9,"label",26),i(10,"ID Cliente *"),e(),d(11,"input",78),v(12,ge,3,0,"div",79),e()(),t(13,"div",24)(14,"div",25)(15,"label",26),i(16,"Fecha *"),e(),d(17,"input",80),v(18,be,3,0,"div",79),e()(),t(19,"div",24)(20,"div",25)(21,"label",26),i(22,"Total *"),e(),d(23,"input",81),v(24,xe,3,0,"div",79),e()(),t(25,"div",24)(26,"div",25)(27,"label",26),i(28,"Estado *"),e(),t(29,"ng-select",82)(30,"ng-option",83),i(31,"Pendiente"),e(),t(32,"ng-option",84),i(33,"Completada"),e(),t(34,"ng-option",85),i(35,"Cancelada"),e()(),v(36,Se,3,0,"div",79),e()()()(),t(37,"div",86)(38,"button",87),_("click",function(){let a=u(o).$implicit;return f(a.dismiss("cancel"))}),i(39,"Cancelar"),e(),t(40,"button",88),v(41,Ce,1,0,"span",89),i(42," Actualizar "),e()()()}if(l&2){let o,n,a,m,r=h();E("formGroup",r.editForm),c(12),g((o=r.editForm.get("idCliente"))!=null&&o.invalid&&((o=r.editForm.get("idCliente"))!=null&&o.touched)?12:-1),c(6),g((n=r.editForm.get("fecha"))!=null&&n.invalid&&((n=r.editForm.get("fecha"))!=null&&n.touched)?18:-1),c(6),g((a=r.editForm.get("total"))!=null&&a.invalid&&((a=r.editForm.get("total"))!=null&&a.touched)?24:-1),c(12),g((m=r.editForm.get("estado"))!=null&&m.invalid&&((m=r.editForm.get("estado"))!=null&&m.touched)?36:-1),c(4),E("disabled",r.loading),c(),g(r.loading?41:-1)}}var Oe=(()=>{let s=class s{constructor(n,a,m,r,p,S){this.modalService=n,this.ventaService=a,this.fb=m,this.toastr=r,this.router=p,this.cdr=S,this.ventas=[],this.filteredVentas=[],this.loading=!1,this.selectedVenta=null,this.editForm=this.fb.group({idCliente:["",[x.required,x.min(1)]],fecha:["",x.required],total:["",[x.required,x.min(0)]],estado:["",x.required]}),this.filterForm=this.fb.group({fechaDesde:[""],fechaHasta:[""],estado:[""]})}ngOnInit(){this.loadVentas()}edit(n,a){this.selectedVenta=a,this.editForm.patchValue({idCliente:a.idCliente,fecha:this.formatDateForInput(a.fecha),total:a.total,estado:a.estado}),this.modalService.open(n,{windowClass:"modalCusSty modal-lg"})}onUpdateVenta(){if(this.editForm.valid&&this.selectedVenta){this.loading=!0;let n=this.editForm.value;this.ventaService.updateVenta(this.selectedVenta.id,n).subscribe({next:()=>{this.toastr.success("Venta actualizada exitosamente","\xC9xito",{timeOut:3e3,positionClass:"toast-top-right",progressBar:!0,closeButton:!0}),this.loadVentas(),this.modalService.dismissAll(),this.loading=!1},error:a=>{this.toastr.error("Error al actualizar la venta: "+(a.error?.message||"Error desconocido"),"Error",{timeOut:5e3,positionClass:"toast-top-right",progressBar:!0,closeButton:!0}),this.loading=!1}})}else this.toastr.warning("Por favor, complete todos los campos requeridos","Advertencia",{timeOut:3e3,positionClass:"toast-top-right",progressBar:!0,closeButton:!0}),this.markFormGroupTouched()}deleteVenta(n){confirm("\xBFEst\xE1 seguro de que desea eliminar esta venta?")&&this.ventaService.deleteVenta(n).subscribe({next:()=>{this.toastr.success("Venta eliminada exitosamente","\xC9xito",{timeOut:3e3,positionClass:"toast-top-right",progressBar:!0,closeButton:!0}),this.loadVentas()},error:a=>{this.toastr.error("Error al eliminar la venta: "+(a.error?.message||"Error desconocido"),"Error",{timeOut:5e3,positionClass:"toast-top-right",progressBar:!0,closeButton:!0})}})}markFormGroupTouched(){Object.keys(this.editForm.controls).forEach(n=>{this.editForm.get(n)?.markAsTouched()})}loadVentas(){this.loading=!0,this.ventaService.getVentas().subscribe({next:n=>{console.log("API Response:",n);let a=n?.data?.data||n?.data||n||[];this.ventas=Array.isArray(a)?a:[],this.filteredVentas=[...this.ventas],this.loading=!1,this.cdr.detectChanges()},error:n=>{console.error("Error loading ventas:",n),this.ventas=[],this.filteredVentas=[],this.loading=!1,this.cdr.detectChanges()}})}formatDateForInput(n){return n?new Date(n).toISOString().split("T")[0]:""}generateTicket(n){this.router.navigate(["/dashboard/business-dashboard/new-ticket"],{queryParams:{ventaId:n}})}applyFilters(){let{fechaDesde:n,fechaHasta:a,estado:m}=this.filterForm.value;this.filteredVentas=this.ventas.filter(r=>{let p=!0;if(n){let S=new Date(r.fecha),y=new Date(n);p=p&&S>=y}if(a){let S=new Date(r.fecha),y=new Date(a);p=p&&S<=y}return m&&(p=p&&r.estado.toLowerCase()===m.toLowerCase()),p}),this.cdr.detectChanges()}clearFilters(){this.filterForm.reset(),this.filteredVentas=[...this.ventas],this.cdr.detectChanges()}getStatusClass(n){switch(n.toLowerCase()){case"completada":return"success";case"pendiente":return"warning";case"cancelada":return"danger";default:return"secondary"}}};s.\u0275fac=function(a){return new(a||s)(b(ee),b(ce),b(X),b(ne),b(R),b(O))},s.\u0275cmp=k({type:s,selectors:[["app-sell-list"]],standalone:!0,features:[M([ae]),B],decls:93,vars:2,consts:[["editContent",""],[1,"page-header","d-lg-flex","d-block"],[1,"page-leftheader"],[1,"page-title"],[1,"page-rightheader"],[1,"btn-list","d-flex","gap-1"],["routerLink","/dashboard/business-dashboard/new-sell",1,"btn","btn-primary"],[1,"fe","fe-plus","fs-12","my-auto","me-2"],["data-bs-toggle","tooltip","data-bs-placement","top","title","E-mail",1,"btn","btn-light3"],[1,"fe","fe-mail"],["data-bs-placement","top","data-bs-toggle","tooltip","title","Contact",1,"btn","btn-light3"],[1,"fe","fe-phone-call"],["data-bs-placement","top","data-bs-toggle","tooltip","title","Info",1,"btn","btn-primary"],[1,"fe","fe-info"],[1,"row"],[1,"col-xl-12","col-md-12","col-lg-12"],[1,"card","custom-card"],[1,"card-header","d-flex","justify-content-between","border-bottom-0"],[1,"card-title"],[1,"float-end"],["type","text","placeholder","buscar",1,"form-control"],[1,"card-body"],[3,"formGroup"],[1,"col-md-12","col-lg-7"],[1,"col-md-6"],[1,"form-group"],[1,"form-label"],[1,"input-group"],[1,"input-group-text","text-muted"],[1,"ri-calendar-line"],["mwlFlatpickr","","type","text","placeholder","DD-MM-YYYY","formControlName","fechaDesde",1,"form-control","choose-date"],["mwlFlatpickr","","type","text","placeholder","DD-MM-YYYY","formControlName","fechaHasta",1,"form-control","choose-date"],[1,"col-md-3"],["formControlName","estado","placeholder","Seleccionar Estado",1,"form-control","custom-select","p-0"],["value",""],["value","pendiente"],["value","completada"],["value","cancelada"],[1,"col-md-2"],[1,"form-group","mt-2"],[1,"d-flex","gap-2"],["type","button",1,"btn","btn-primary",3,"click"],["type","button",1,"btn","btn-light",3,"click"],[1,"card-body","border-top"],[1,"col-sm-6","mb-1"],[1,"d-flex","align-items-center"],[1,"d-flex","ms-2","mx-2"],["name","quantity","placeholder","10","data-trigger","",1,"form-control","wd-150","p-0"],["value","10","selected",""],["value","25"],["value","50"],["value","100"],[1,"text-center","py-4"],[1,"table-responsive"],["role","status",1,"spinner-border"],[1,"visually-hidden"],[1,"table","table-vcenter","text-nowrap","table-bordered","border-bottom"],["colspan","6",1,"text-center","py-4"],[1,"text-muted"],[1,"fe","fe-inbox","fs-24","mb-2"],[1,"avatar","avatar-md","me-2","avatar-rounded","bg-success-transparent"],[1,"fe","fe-user"],[1,"mb-1","fs-14"],[1,"fs-12","text-muted"],[1,"d-flex"],["placement","top","ngbTooltip","Ver Venta",1,"action-btns1",3,"routerLink"],[1,"fe","fe-eye","text-primary"],["placement","top","ngbTooltip","Generar Ticket",1,"action-btns1",3,"click"],[1,"fe","fe-file-plus","text-info"],["placement","top","ngbTooltip","Editar",1,"action-btns1",3,"click"],[1,"fe","fe-edit-2","text-success"],["placement","top","ngbTooltip","Eliminar",1,"action-btns1",3,"click"],[1,"fe","fe-trash-2","text-danger"],[3,"ngSubmit","formGroup"],[1,"modal-header"],[1,"modal-title"],["type","button","data-bs-dismiss","modal","aria-label","Close",1,"btn-close",3,"click"],[1,"modal-body"],["formControlName","idCliente","type","number","placeholder","ID del cliente",1,"form-control"],[1,"text-danger"],["formControlName","fecha","type","date",1,"form-control"],["formControlName","total","type","number","step","0.01","placeholder","Total de la venta",1,"form-control"],["formControlName","estado","placeholder","Seleccionar estado",1,"form-control"],["value","Pendiente"],["value","Completada"],["value","Cancelada"],[1,"modal-footer"],["type","button",1,"btn","btn-outline-primary",3,"click"],["type","submit",1,"btn","btn-success",3,"disabled"],[1,"spinner-border","spinner-border-sm","me-2"]],template:function(a,m){if(a&1){let r=V();t(0,"div",1)(1,"div",2)(2,"div",3),i(3,"Lista de Ventas"),e()(),t(4,"div",4)(5,"div",5)(6,"a",6),d(7,"i",7),i(8,"Agregar Venta "),e(),t(9,"button",8),d(10,"i",9),e(),t(11,"button",10),d(12,"i",11),e(),t(13,"button",12),d(14,"i",13),e()()()(),t(15,"div",14)(16,"div",15)(17,"div",16)(18,"div",17)(19,"h4",18),i(20,"Resumen de Ventas"),e(),t(21,"div",19),d(22,"input",20),e()(),t(23,"div",21)(24,"form",22)(25,"div",14)(26,"div",23)(27,"div",14)(28,"div",24)(29,"div",25)(30,"label",26),i(31,"Desde:"),e(),t(32,"div",25)(33,"div",27)(34,"div",28),d(35,"i",29),e(),d(36,"input",30),e()()()(),t(37,"div",24)(38,"div",25)(39,"label",26),i(40,"Hasta:"),e(),t(41,"div",25)(42,"div",27)(43,"div",28),d(44,"i",29),e(),d(45,"input",31),e()()()()()(),t(46,"div",32)(47,"div",25)(48,"label",26),i(49,"Seleccionar Estado:"),e(),t(50,"ng-select",33)(51,"ng-option",34),i(52,"Todos"),e(),t(53,"ng-option",35),i(54,"Pendiente"),e(),t(55,"ng-option",36),i(56,"Completada"),e(),t(57,"ng-option",37),i(58,"Cancelada"),e()()()(),t(59,"div",38)(60,"div",39),d(61,"label",26),t(62,"div",40)(63,"button",41),_("click",function(){return u(r),f(m.applyFilters())}),i(64,"Buscar"),e(),t(65,"button",42),_("click",function(){return u(r),f(m.clearFilters())}),i(66,"Limpiar"),e()()()()()()(),t(67,"div",43)(68,"div",14)(69,"div",44)(70,"div",45)(71,"span"),i(72,"Mostrar"),e(),t(73,"div",46)(74,"div",25)(75,"ng-select",47)(76,"ng-option",48),i(77,"10"),e(),t(78,"ng-option",49),i(79,"25"),e(),t(80,"ng-option",50),i(81,"50"),e(),t(82,"ng-option",51),i(83,"100"),e()()()(),t(84,"span"),i(85,"entradas"),e()()(),t(86,"div",44)(87,"div",19),d(88,"input",20),e()()(),v(89,ue,4,0,"div",52)(90,he,19,1,"div",53),e()()()(),v(91,Ee,43,7,"ng-template",null,0,G)}a&2&&(c(24),E("formGroup",m.filterForm),c(65),g(m.loading?89:90))},dependencies:[me,se,de,re,oe,le,$,Y,Z,Q,H,J,z,U,K,W,ie,te,P,j]});let l=s;return l})();export{Oe as SellListComponent};
