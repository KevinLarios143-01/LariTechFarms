<app-hr-dashboard-page-header [title]="'Detalle del Lote'" [title2]="'Volver a Lista'" [class]="'btn btn-secondary'"
  [class1]="''" [path]="'/dashboard/business-dashboard/lotes'">
</app-hr-dashboard-page-header>

<div class="row" *ngIf="loading">
  <div class="col-12 text-center py-5">
    <div class="spinner-border text-primary" role="status">
      <span class="visually-hidden">Cargando...</span>
    </div>
  </div>
</div>

<div class="row" *ngIf="!loading && lote">
  <div class="col-xl-8">
    <div class="card custom-card">
      <div class="card-header">
        <h4 class="card-title">Información del Lote</h4>
      </div>
      <div class="card-body">
        <div class="row">
          <div class="col-md-6">
            <div class="mb-3">
              <label class="form-label fw-semibold">ID del Lote:</label>
              <p class="mb-0">{{lote.id}}</p>
            </div>
          </div>
          <div class="col-md-6">
            <div class="mb-3">
              <label class="form-label fw-semibold">Estado:</label>
              <p class="mb-0">
                <span class="badge" [class]="getEstadoBadgeClass(lote.estado)">{{lote.estado}}</span>
              </p>
            </div>
          </div>
          <div class="col-md-6">
            <div class="mb-3">
              <label class="form-label fw-semibold">Galera:</label>
              <p class="mb-0">{{lote.galera}}</p>
            </div>
          </div>
          <div class="col-md-6">
            <div class="mb-3">
              <label class="form-label fw-semibold">Tipo:</label>
              <p class="mb-0">
                <span class="badge" [class]="lote.tipo === 'Ponedoras' ? 'bg-info' : 'bg-primary'">{{lote.tipo}}</span>
              </p>
            </div>
          </div>
          <div class="col-md-6">
            <div class="mb-3">
              <label class="form-label fw-semibold">Cantidad:</label>
              <p class="mb-0">{{lote.cantidad | number}} aves</p>
            </div>
          </div>
          <div class="col-md-6">
            <div class="mb-3">
              <label class="form-label fw-semibold">Fecha de Inicio:</label>
              <p class="mb-0">{{lote.fechaInicio | date: 'dd/MM/yyyy'}}</p>
            </div>
          </div>
          <div class="col-md-6">
            <div class="mb-3">
              <label class="form-label fw-semibold">Fecha de Fin:</label>
              <p class="mb-0">{{lote.fechaFin ? (lote.fechaFin | date: 'dd/MM/yyyy') : 'N/A'}}</p>
            </div>
          </div>

          <div class="col-12" *ngIf="lote.observaciones">
            <div class="mb-3">
              <label class="form-label fw-semibold">Observaciones:</label>
              <p class="mb-0">{{lote.observaciones}}</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <div class="col-xl-4">
    <div class="card custom-card">
      <div class="card-header">
        <h4 class="card-title">Estadísticas</h4>
      </div>
      <div class="card-body">
        <div class="row">
          <div class="col-12">
            <div class="mb-3 text-center">
              <div class="avatar avatar-xl bg-primary-transparent mx-auto mb-2">
                <i class="fe fe-layers fs-24"></i>
              </div>
              <h5 class="mb-1">{{lote.galera}}</h5>
              <p class="text-muted mb-0">{{lote.tipo}}</p>
            </div>
          </div>
          <div class="col-6">
            <div class="text-center">
              <h4 class="mb-1 text-success">{{lote._count?.movAvesLote || 0}}</h4>
              <p class="text-muted mb-0 fs-12">Movimientos</p>
            </div>
          </div>
          <div class="col-6">
            <div class="text-center">
              <h4 class="mb-1 text-primary">{{lote._count?.tickets || 0}}</h4>
              <p class="text-muted mb-0 fs-12">Tickets</p>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <div class="card custom-card">
      <div class="card-header">
        <h4 class="card-title">Acciones</h4>
      </div>
      <div class="card-body">
        <div class="d-grid gap-2">
          <button class="btn btn-primary" [routerLink]="['/dashboard/business-dashboard/lotes']">
            <i class="fe fe-list me-2"></i>Volver a Lista
          </button>
          <button class="btn btn-success" (click)="editLote()">
            <i class="fe fe-edit-2 me-2"></i>Editar Lote
          </button>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="row" *ngIf="!loading && !lote">
  <div class="col-12">
    <div class="card custom-card">
      <div class="card-body text-center py-5">
        <i class="fe fe-alert-circle fs-48 text-muted mb-3"></i>
        <h4>Lote no encontrado</h4>
        <p class="text-muted">El lote que buscas no existe o no tienes permisos para verlo.</p>
        <p class="text-muted small">ID buscado: {{loteId}}</p>
        <button class="btn btn-primary" (click)="goBack()">Volver a Lista</button>
        <button class="btn btn-secondary ms-2" (click)="loadLote()">Reintentar</button>
      </div>
    </div>
  </div>
</div>